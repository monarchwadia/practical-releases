(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();var H;function qe(t){return{lang:t?.lang??H?.lang,message:t?.message,abortEarly:t?.abortEarly??H?.abortEarly,abortPipeEarly:t?.abortPipeEarly??H?.abortPipeEarly}}var Pe;function Le(t){return Pe?.get(t)}var Ae;function Oe(t){return Ae?.get(t)}var Ke;function Ne(t,e){return Ke?.get(t)?.get(e)}function X(t){const e=typeof t;return e==="string"?`"${t}"`:e==="number"||e==="bigint"||e==="boolean"?`${t}`:e==="object"||e==="function"?(t&&Object.getPrototypeOf(t)?.constructor?.name)??"null":e}function E(t,e,s,r,n){const o=n&&"input"in n?n.input:s.value,u=n?.expected??t.expects??null,d=n?.received??X(o),a={kind:t.kind,type:t.type,input:o,expected:u,received:d,message:`Invalid ${e}: ${u?`Expected ${u} but r`:"R"}eceived ${d}`,requirement:t.requirement,path:n?.path,issues:n?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},f=t.kind==="schema",y=n?.message??t.message??Ne(t.reference,a.lang)??(f?Oe(a.lang):null)??r.message??Le(a.lang);y!==void 0&&(a.message=typeof y=="function"?y(a):y),f&&(s.typed=!1),s.issues?s.issues.push(a):s.issues=[a]}function q(t){return{version:1,vendor:"valibot",validate(e){return t["~run"]({value:e},qe())}}}function Be(t,e){return Object.hasOwn(t,e)&&e!=="__proto__"&&e!=="prototype"&&e!=="constructor"}function Se(t,e){const s=[...new Set(t)];return s.length>1?`(${s.join(` ${e} `)})`:s[0]??"never"}function Ve(t,e,s){return typeof t.fallback=="function"?t.fallback(e,s):t.fallback}function Z(t,e,s){return typeof t.default=="function"?t.default(e,s):t.default}function x(t,e){return{kind:"schema",type:"array",reference:x,expects:"Array",async:!1,item:t,message:e,get"~standard"(){return q(this)},"~run"(s,r){const n=s.value;if(Array.isArray(n)){s.typed=!0,s.value=[];for(let o=0;o<n.length;o++){const u=n[o],d=this.item["~run"]({value:u},r);if(d.issues){const a={type:"array",origin:"value",input:n,key:o,value:u};for(const f of d.issues)f.path?f.path.unshift(a):f.path=[a],s.issues?.push(f);if(s.issues||(s.issues=d.issues),r.abortEarly){s.typed=!1;break}}d.typed||(s.typed=!1),s.value.push(d.value)}}else E(this,"type",s,r);return s}}}function h(t){return{kind:"schema",type:"boolean",reference:h,expects:"boolean",async:!1,message:t,get"~standard"(){return q(this)},"~run"(e,s){return typeof e.value=="boolean"?e.typed=!0:E(this,"type",e,s),e}}}function l(t,e){return{kind:"schema",type:"literal",reference:l,expects:X(t),async:!1,literal:t,message:e,get"~standard"(){return q(this)},"~run"(s,r){return s.value===this.literal?s.typed=!0:E(this,"type",s,r),s}}}function D(t,e){return{kind:"schema",type:"nullable",reference:D,expects:`(${t.expects} | null)`,async:!1,wrapped:t,default:e,get"~standard"(){return q(this)},"~run"(s,r){return s.value===null&&(this.default!==void 0&&(s.value=Z(this,s,r)),s.value===null)?(s.typed=!0,s):this.wrapped["~run"](s,r)}}}function G(t){return{kind:"schema",type:"number",reference:G,expects:"number",async:!1,message:t,get"~standard"(){return q(this)},"~run"(e,s){return typeof e.value=="number"&&!isNaN(e.value)?e.typed=!0:E(this,"type",e,s),e}}}function p(t,e){return{kind:"schema",type:"object",reference:p,expects:"Object",async:!1,entries:t,message:e,get"~standard"(){return q(this)},"~run"(s,r){const n=s.value;if(n&&typeof n=="object"){s.typed=!0,s.value={};for(const o in this.entries){const u=this.entries[o];if(o in n||(u.type==="exact_optional"||u.type==="optional"||u.type==="nullish")&&u.default!==void 0){const d=o in n?n[o]:Z(u),a=u["~run"]({value:d},r);if(a.issues){const f={type:"object",origin:"value",input:n,key:o,value:d};for(const y of a.issues)y.path?y.path.unshift(f):y.path=[f],s.issues?.push(y);if(s.issues||(s.issues=a.issues),r.abortEarly){s.typed=!1;break}}a.typed||(s.typed=!1),s.value[o]=a.value}else if(u.fallback!==void 0)s.value[o]=Ve(u);else if(u.type!=="exact_optional"&&u.type!=="optional"&&u.type!=="nullish"&&(E(this,"key",s,r,{input:void 0,expected:`"${o}"`,path:[{type:"object",origin:"key",input:n,key:o,value:n[o]}]}),r.abortEarly))break}}else E(this,"type",s,r);return s}}}function m(t,e){return{kind:"schema",type:"optional",reference:m,expects:`(${t.expects} | undefined)`,async:!1,wrapped:t,default:e,get"~standard"(){return q(this)},"~run"(s,r){return s.value===void 0&&(this.default!==void 0&&(s.value=Z(this,s,r)),s.value===void 0)?(s.typed=!0,s):this.wrapped["~run"](s,r)}}}function Ee(t,e){return{kind:"schema",type:"picklist",reference:Ee,expects:Se(t.map(X),"|"),async:!1,options:t,message:e,get"~standard"(){return q(this)},"~run"(s,r){return this.options.includes(s.value)?s.typed=!0:E(this,"type",s,r),s}}}function ke(t,e,s){return{kind:"schema",type:"record",reference:ke,expects:"Object",async:!1,key:t,value:e,message:s,get"~standard"(){return q(this)},"~run"(r,n){const o=r.value;if(o&&typeof o=="object"){r.typed=!0,r.value={};for(const u in o)if(Be(o,u)){const d=o[u],a=this.key["~run"]({value:u},n);if(a.issues){const y={type:"object",origin:"key",input:o,key:u,value:d};for(const R of a.issues)R.path=[y],r.issues?.push(R);if(r.issues||(r.issues=a.issues),n.abortEarly){r.typed=!1;break}}const f=this.value["~run"]({value:d},n);if(f.issues){const y={type:"object",origin:"value",input:o,key:u,value:d};for(const R of f.issues)R.path?R.path.unshift(y):R.path=[y],r.issues?.push(R);if(r.issues||(r.issues=f.issues),n.abortEarly){r.typed=!1;break}}(!a.typed||!f.typed)&&(r.typed=!1),a.typed&&(r.value[a.value]=f.value)}}else E(this,"type",r,n);return r}}}function i(t){return{kind:"schema",type:"string",reference:i,expects:"string",async:!1,message:t,get"~standard"(){return q(this)},"~run"(e,s){return typeof e.value=="string"?e.typed=!0:E(this,"type",e,s),e}}}function ue(t){let e;if(t)for(const s of t)e?e.push(...s.issues):e=s.issues;return e}function g(t,e){return{kind:"schema",type:"union",reference:g,expects:Se(t.map(s=>s.expects),"|"),async:!1,options:t,message:e,get"~standard"(){return q(this)},"~run"(s,r){let n,o,u;for(const d of this.options){const a=d["~run"]({value:s.value},r);if(a.typed)if(a.issues)o?o.push(a):o=[a];else{n=a;break}else u?u.push(a):u=[a]}if(n)return n;if(o){if(o.length===1)return o[0];E(this,"type",s,r,{issues:ue(o)}),s.typed=!0}else{if(u?.length===1)return u[0];E(this,"type",s,r,{issues:ue(u)})}return s}}}function b(){return{kind:"schema",type:"unknown",reference:b,expects:"unknown",async:!1,get"~standard"(){return q(this)},"~run"(t){return t.typed=!0,t}}}function w(t,e,s){const r=t["~run"]({value:e},qe(s));return{typed:r.typed,success:!r.issues,output:r.value,issues:r.issues}}const c=(t,e)=>p({type:l(t),payload:p({requestId:i(),...e})}),ae={Request:c("vfs.exists",{path:i()}),Response:g([c("vfs.exists.response",{success:l(!0),data:p({exists:h(),entryType:D(i())})}),c("vfs.exists.response",{success:l(!1),error:i()})])},Ge=p({name:i(),type:g([l("file"),l("directory")]),size:G()}),ce={Request:c("vfs.readDir",{path:i()}),Response:g([c("vfs.readDir.response",{success:l(!0),data:x(Ge)}),c("vfs.readDir.response",{success:l(!1),error:i()})])},le={Request:c("vfs.readFile",{path:i()}),Response:g([c("vfs.readFile.response",{success:l(!0),data:i()}),c("vfs.readFile.response",{success:l(!1),error:i()})])},pe={Request:c("vfs.writeFile",{path:i(),content:i()}),Response:g([c("vfs.writeFile.response",{success:l(!0)}),c("vfs.writeFile.response",{success:l(!1),error:i()})])},de={Request:c("editor.openFile",{path:i()}),Response:g([c("editor.openFile.response",{success:l(!0)}),c("editor.openFile.response",{success:l(!1),error:i()})])},He={Request:c("document.content",{content:i(),hash:i(),isRevert:m(h())}),Response:g([c("document.content.response",{success:l(!0)}),c("document.content.response",{success:l(!1),error:i()})])},fe={Request:c("document.edited",{description:i()}),Response:g([c("document.edited.response",{success:l(!0)}),c("document.edited.response",{success:l(!1),error:i()})])},ye={Request:c("document.save",{}),Response:g([c("document.save.response",{success:l(!0),hash:i()}),c("document.save.response",{success:l(!1),error:i()})])},We={Request:c("document.saveRequested",{}),Response:g([c("document.saveRequested.response",{success:l(!0),content:i()}),c("document.saveRequested.response",{success:l(!1),error:i()})])},Je={Request:c("document.saved",{hash:i()}),Response:g([c("document.saved.response",{success:l(!0)}),c("document.saved.response",{success:l(!1),error:i()})])},Qe={Request:c("document.revert",{}),Response:g([c("document.revert.response",{success:l(!0)}),c("document.revert.response",{success:l(!1),error:i()})])},Ye=p({isOpen:h(),path:D(i()),name:D(i())}),he={Request:c("workspace.getDetails",{}),Response:g([c("workspace.getDetails.response",{success:l(!0),data:Ye}),c("workspace.getDetails.response",{success:l(!1),error:i()})])},ze=p({type:l("workspace.changed"),isOpen:h(),path:D(i()),name:D(i())}),me={Request:c("workspace.open",{}),Response:g([c("workspace.open.response",{success:l(!0),path:D(i())}),c("workspace.open.response",{success:l(!1),error:i()})])},ge={Request:c("native.call",{pluginId:i(),moduleId:i(),command:i(),args:b()}),Response:g([c("native.call.response",{success:l(!0),data:b()}),c("native.call.response",{success:l(!1),error:i()})])},ve={Request:c("fs.subscribe",{}),Response:g([c("fs.subscribe.response",{success:l(!0)}),c("fs.subscribe.response",{success:l(!1),error:i()})])},be={Request:c("fs.unsubscribe",{}),Response:g([c("fs.unsubscribe.response",{success:l(!0)}),c("fs.unsubscribe.response",{success:l(!1),error:i()})])},Xe=p({type:l("fs.fileChanged"),payload:p({path:i(),kind:g([l("created"),l("modified"),l("deleted")])})});var _;(function(t){t.Request=c("plugin.sendMessage",{targetModuleId:i(),message:b()}),t.Response=p({type:l("plugin.sendMessage.response"),payload:p({requestId:i(),success:h(),data:m(b()),error:m(i())})})})(_||(_={}));var Q;(function(t){t.Request=c("plugin.message",{fromModuleId:i(),message:b()}),t.Response=p({type:l("plugin.message.response"),payload:p({requestId:i(),success:h(),data:m(b()),error:m(i())})})})(Q||(Q={}));var j;(function(t){t.Request=c("plugin.sendBroadcast",{message:b()}),t.Response=p({type:l("plugin.sendBroadcast.response"),payload:p({requestId:i(),success:h(),error:m(i())})})})(j||(j={}));var Y;(function(t){t.Event=p({type:l("plugin.broadcast"),payload:p({fromModuleId:i(),message:b()})})})(Y||(Y={}));var P;(function(t){t.Request=c("storage.getSecret",{key:i()}),t.Response=p({type:l("storage.getSecret.response"),payload:p({requestId:i(),success:h(),value:D(i()),error:m(i())})})})(P||(P={}));var L;(function(t){t.Request=c("storage.setSecret",{key:i(),value:i()}),t.Response=p({type:l("storage.setSecret.response"),payload:p({requestId:i(),success:h(),error:m(i())})})})(L||(L={}));var A;(function(t){t.Request=c("storage.deleteSecret",{key:i()}),t.Response=p({type:l("storage.deleteSecret.response"),payload:p({requestId:i(),success:h(),error:m(i())})})})(A||(A={}));const Ze=Ee(["debug","info","warn","error"]);var O;(function(t){t.Request=c("logs.write",{level:Ze,channelName:i(),args:x(b())}),t.Response=p({type:l("logs.write.response"),payload:p({requestId:i(),success:h(),error:m(i())})})})(O||(O={}));const Ie=p({type:l("object"),properties:ke(i(),b()),required:m(x(i()))}),es=p({id:i(),name:i(),description:i(),parameters:Ie,provider:p({pluginId:i(),moduleId:i()}),timeoutMs:m(G())});var K;(function(t){t.Request=c("llm.tool.list",{}),t.Response=p({type:l("llm.tool.list.response"),payload:p({requestId:i(),success:h(),tools:x(es),error:m(i())})})})(K||(K={}));var N;(function(t){t.Request=c("llm.tool.execute",{toolId:i(),arguments:b()}),t.Response=p({type:l("llm.tool.execute.response"),payload:p({requestId:i(),success:h(),result:m(b()),error:m(i())})})})(N||(N={}));var B;(function(t){t.Request=c("llm.tool.register",{name:i(),description:i(),parameters:Ie,timeoutMs:m(G())}),t.Response=p({type:l("llm.tool.register.response"),payload:p({requestId:i(),success:h(),toolId:m(i()),error:m(i())})})})(B||(B={}));var V;(function(t){t.Request=c("llm.tool.unregister",{name:i()}),t.Response=p({type:l("llm.tool.unregister.response"),payload:p({requestId:i(),success:h(),error:m(i())})})})(V||(V={}));var z;(function(t){t.Request=c("llm.tool.call",{toolName:i(),arguments:b()}),t.Response=p({type:l("llm.tool.call.response"),payload:p({requestId:i(),success:h(),result:m(b()),error:m(i())})})})(z||(z={}));const De="ui.getState.request",ss="ui.getState.response",ts=p({id:i(),title:i(),isDirty:h(),isActive:h()}),Ce={Request:c(De,{}),Response:c(ss,{openTabs:x(ts)})},rs=Ce.Request,ns=Ce.Response,$e="ui.setVisibility.request",os="ui.setVisibility.response",xe={Request:c($e,{visible:h()}),Response:c(os,{success:h()})},is=xe.Request,us=xe.Response,Fe="ui.tabsChanged.event",as=p({openTabs:x(p({id:i(),title:i(),isDirty:h(),isActive:h()})),hasOpenTabs:h()}),cs=p({type:l(Fe),payload:as}),v=[];for(let t=0;t<256;++t)v.push((t+256).toString(16).slice(1));function ls(t,e=0){return(v[t[e+0]]+v[t[e+1]]+v[t[e+2]]+v[t[e+3]]+"-"+v[t[e+4]]+v[t[e+5]]+"-"+v[t[e+6]]+v[t[e+7]]+"-"+v[t[e+8]]+v[t[e+9]]+"-"+v[t[e+10]]+v[t[e+11]]+v[t[e+12]]+v[t[e+13]]+v[t[e+14]]+v[t[e+15]]).toLowerCase()}let W;const ps=new Uint8Array(16);function ds(){if(!W){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");W=crypto.getRandomValues.bind(crypto)}return W(ps)}const fs=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Re={randomUUID:fs};function ys(t,e,s){t=t||{};const r=t.random??t.rng?.()??ds();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,ls(r)}function hs(t,e,s){return Re.randomUUID&&!t?Re.randomUUID():ys(t)}class ms{subscribers=new Set;handleMessage=e=>{this.subscribers.forEach(s=>s(e))};constructor(){}init(){window.addEventListener("message",this.handleMessage)}destroy(){window.removeEventListener("message",this.handleMessage),this.subscribers.clear()}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}send(e){window.parent.postMessage(e,"*")}}class gs{messageBus;pendingRequests=new Map;constructor(){this.messageBus=new ms}init(){this.messageBus.init(),this.messageBus.subscribe(this.handleMessage)}destroy(){this.messageBus.destroy(),this.pendingRequests.clear()}subscribe(e){return this.messageBus.subscribe(e)}send(e){this.messageBus.send(e)}handleMessage=e=>{console.log("Received message:",e.data);const{type:s,payload:r}=e.data||{};if(s&&s.endsWith(".response")&&r?.requestId){const n=this.pendingRequests.get(r.requestId);n&&(n({type:s,payload:r}),this.pendingRequests.delete(r.requestId))}};async sendRequest(e,s,r,n){const o=hs(),u={type:e,payload:{requestId:o,...s}};console.log(`[SDK] Sending request ${e}:`,u);const d=w(r,u);if(!d.success)throw console.error(`[SDK] Invalid request shape for ${e}:`,d.issues),new Error(`Invalid request shape for ${e}`);return new Promise((a,f)=>{this.pendingRequests.set(o,y=>{const R=w(n,y);if(!R.success){console.error(`[SDK] Invalid response shape for ${e}:`,R.issues),f(new Error(`Invalid response shape for ${e}`));return}a(R.output.payload)}),this.messageBus.send(u)})}}class vs{client;constructor(e){this.client=e}async getState(){return{openTabs:(await this.client.sendRequest(De,{},rs,ns)).openTabs}}async setVisibility(e){if(!(await this.client.sendRequest($e,{visible:e},is,us)).success)throw new Error("Failed to set panel visibility")}onTabsChanged(e){return this.client.subscribe(s=>{const{type:r,payload:n}=s.data||{};if(r===Fe){const o=w(cs,{type:r,payload:n});o.success?e({payload:o.output.payload}):console.error("[SDK] Invalid ui.tabsChanged.event payload:",o.issues)}})}}class we{channelName;logChannelAdapters;constructor(e,s){this.channelName=e,this.logChannelAdapters=s}writeLog(e,s,r){for(const n of this.logChannelAdapters)try{n.writeLog(e,s,...r)}catch(o){console.error(`LogChannel failed to write log via adapter: ${o}`)}}debug(...e){this.writeLog(this.channelName,"debug",e)}info(...e){this.writeLog(this.channelName,"info",e)}warn(...e){this.writeLog(this.channelName,"warn",e)}error(...e){this.writeLog(this.channelName,"error",e)}}class bs{client;constructor(e){this.client=e}writeLog(e,s,...r){const n=r.map(o=>{if(typeof o=="string")return o;if(o instanceof Error)return`Error: ${o.message}
${o.stack}`;try{return JSON.stringify(o)}catch{return String(o)}}).join(" ");this.client.sendRequest("logs.write",{level:s,channelName:e,args:[n]},O.Request,O.Response).catch(o=>{console.error("Failed to write log:",o)})}}class As{client;primaryLogChannel;logAdapters;toolHandlers=new Map;toolCallUnsubscribe=null;ui;constructor(){this.client=new gs;const e=new bs(this.client);this.logAdapters=[e],this.primaryLogChannel=new we("default",this.logAdapters),this.ui=new vs(this.client)}init(){this.client.init()}destroy(){this.client.destroy()}onMessage(e){return this.client.subscribe(e)}vfs={exists:async e=>{const s=await this.client.sendRequest("vfs.exists",{path:e},ae.Request,ae.Response);if(s.success)return s.data;throw new Error(s.error)},readDir:async e=>{const s=await this.client.sendRequest("vfs.readDir",{path:e},ce.Request,ce.Response);if(s.success)return s.data;throw new Error(s.error)},readFile:async e=>{const s=await this.client.sendRequest("vfs.readFile",{path:e},le.Request,le.Response);if(s.success)return s.data;throw new Error(s.error)},writeFile:async(e,s)=>{const r=await this.client.sendRequest("vfs.writeFile",{path:e,content:s},pe.Request,pe.Response);if(!r.success)throw new Error(r.error)}};workspace={getDetails:async()=>{const e=await this.client.sendRequest("workspace.getDetails",{},he.Request,he.Response);if(e.success)return e.data;throw new Error(e.error)},onChanged:e=>this.client.subscribe(s=>{const{type:r,payload:n}=s.data||{};if(r==="workspace.changed"){const o=w(ze,{type:r,...n});o.success?e(o.output):console.error("[SDK] Invalid workspace.changed payload:",o.issues)}}),open:async()=>{const e=await this.client.sendRequest("workspace.open",{},me.Request,me.Response);if(e.success)return e.path;throw new Error(e.error)}};editor={openFile:async e=>{const s=await this.client.sendRequest("editor.openFile",{path:e},de.Request,de.Response);if(!s.success)throw new Error(s.error)}};native={call:async(e,s,r,n)=>{const o=await this.client.sendRequest("native.call",{pluginId:e,moduleId:s,command:r,args:n},ge.Request,ge.Response);if(o.success)return o.data;throw new Error(o.error)}};fs={subscribe:async()=>{const e=await this.client.sendRequest("fs.subscribe",{},ve.Request,ve.Response);if(!e.success)throw new Error(e.error)},unsubscribe:async()=>{const e=await this.client.sendRequest("fs.unsubscribe",{},be.Request,be.Response);if(!e.success)throw new Error(e.error)},onFileChanged:e=>this.client.subscribe(s=>{const{type:r}=s.data||{};if(r==="fs.fileChanged"){const n=w(Xe,s.data);n.success?e(n.output):console.error("[SDK] Invalid fs.fileChanged payload:",n.issues)}})};document={edited:async(e="edit")=>{const s=await this.client.sendRequest("document.edited",{description:e},fe.Request,fe.Response);if(!s.success)throw new Error(s.error)},requestSave:async()=>{const e=await this.client.sendRequest("document.save",{},ye.Request,ye.Response);if(!e.success)throw new Error(e.error);return e.hash},onContent:e=>this.client.subscribe(s=>{const{type:r}=s.data||{};if(r==="document.content"){const n=w(He.Request,s.data);n.success?e(n.output.payload):console.error("[SDK] Invalid document.content payload:",n.issues)}}),onSaveRequested:e=>this.client.subscribe(async s=>{const{type:r}=s.data||{};if(r==="document.saveRequested"){const n=w(We.Request,s.data);if(n.success)try{const o=await e(n.output.payload);this.client.send({type:"document.saveRequested.response",payload:{requestId:n.output.payload.requestId,success:!0,content:o}})}catch(o){this.client.send({type:"document.saveRequested.response",payload:{requestId:n.output.payload.requestId,success:!1,error:o instanceof Error?o.message:String(o)}})}else console.error("[SDK] Invalid document.saveRequested payload:",n.issues)}}),onSaved:e=>this.client.subscribe(s=>{const{type:r}=s.data||{};if(r==="document.saved"){const n=w(Je.Request,s.data);n.success?e(n.output.payload):console.error("[SDK] Invalid document.saved payload:",n.issues)}}),onRevert:e=>this.client.subscribe(s=>{const{type:r}=s.data||{};if(r==="document.revert"){const n=w(Qe.Request,s.data);n.success?e(n.output.payload):console.error("[SDK] Invalid document.revert payload:",n.issues)}}),respondToContent:(e,s,r)=>{s?this.client.send({type:"document.content.response",payload:{requestId:e,success:!0}}):this.client.send({type:"document.content.response",payload:{requestId:e,success:!1,error:r||"Unknown error"}})},respondToRevert:(e,s,r)=>{s?this.client.send({type:"document.revert.response",payload:{requestId:e,success:!0}}):this.client.send({type:"document.revert.response",payload:{requestId:e,success:!1,error:r||"Unknown error"}})},respondToSaved:(e,s,r)=>{s?this.client.send({type:"document.saved.response",payload:{requestId:e,success:!0}}):this.client.send({type:"document.saved.response",payload:{requestId:e,success:!1,error:r||"Unknown error"}})}};plugin={sendMessage:async(e,s)=>{const r=await this.client.sendRequest("plugin.sendMessage",{targetModuleId:e,message:s},_.Request,_.Response);if(r.success)return r.data;throw new Error(r.error||"Failed to send message")},onMessage:e=>this.client.subscribe(s=>{const{type:r}=s.data||{};if(r==="plugin.message"){const n=w(Q.Request,s.data);if(n.success){const o=n.output.payload.requestId;Promise.resolve().then(()=>e(n.output.payload)).then(u=>{this.client.send({type:"plugin.message.response",payload:{requestId:o,success:!0,data:u}})}).catch(u=>{console.error("[SDK] Error in plugin.onMessage handler:",u),this.client.send({type:"plugin.message.response",payload:{requestId:o,success:!1,error:u instanceof Error?u.message:String(u)}})})}else console.error("[SDK] Invalid plugin.message payload:",n.issues)}}),sendBroadcast:async e=>{const s=await this.client.sendRequest("plugin.sendBroadcast",{message:e},j.Request,j.Response);if(!s.success)throw new Error(s.error||"Failed to send broadcast")},onBroadcast:e=>this.client.subscribe(s=>{const{type:r}=s.data||{};if(r==="plugin.broadcast"){const n=w(Y.Event,s.data);n.success?e(n.output.payload):console.error("[SDK] Invalid plugin.broadcast payload:",n.issues)}})};storage={getSecret:async e=>{const s=await this.client.sendRequest("storage.getSecret",{key:e},P.Request,P.Response);if(s.success)return s.value;throw new Error(s.error||"Failed to get secret")},setSecret:async(e,s)=>{const r=await this.client.sendRequest("storage.setSecret",{key:e,value:s},L.Request,L.Response);if(!r.success)throw new Error(r.error||"Failed to set secret")},deleteSecret:async e=>{const s=await this.client.sendRequest("storage.deleteSecret",{key:e},A.Request,A.Response);if(!s.success)throw new Error(s.error||"Failed to delete secret")}};logs={createChannel:e=>new we(e,this.logAdapters),debug:e=>this.primaryLogChannel.debug(e),info:e=>this.primaryLogChannel.info(e),warn:e=>this.primaryLogChannel.warn(e),error:e=>this.primaryLogChannel.error(e)};llm={listTools:async()=>{const e=await this.client.sendRequest("llm.tool.list",{},K.Request,K.Response);if(e.success)return e.tools;throw new Error(e.error||"Failed to list tools")},executeTool:async(e,s)=>{const r=await this.client.sendRequest("llm.tool.execute",{toolId:e,arguments:s},N.Request,N.Response);if(r.success)return r.result;throw new Error(r.error||"Failed to execute tool")},registerTool:async e=>{this.toolHandlers.set(e.name,e.handler),this.ensureToolCallListener();const s=await this.client.sendRequest("llm.tool.register",{name:e.name,description:e.description,parameters:e.parameters,timeoutMs:e.timeoutMs},B.Request,B.Response);if(s.success&&s.toolId)return s.toolId;throw this.toolHandlers.delete(e.name),new Error(s.error||"Failed to register tool")},unregisterTool:async e=>{const s=await this.client.sendRequest("llm.tool.unregister",{name:e},V.Request,V.Response);if(s.success)this.toolHandlers.delete(e);else throw new Error(s.error||"Failed to unregister tool")}};ensureToolCallListener(){this.toolCallUnsubscribe||(this.toolCallUnsubscribe=this.client.subscribe(async e=>{const{type:s}=e.data||{};if(s==="llm.tool.call"){const r=w(z.Request,e.data);if(r.success){const{toolName:n,arguments:o}=r.output.payload,u=r.output.payload.requestId,d=this.toolHandlers.get(n);if(d)try{const a=await Promise.resolve(d(o));this.client.send({type:"llm.tool.call.response",payload:{requestId:u,success:!0,result:a}})}catch(a){this.client.send({type:"llm.tool.call.response",payload:{requestId:u,success:!1,error:a instanceof Error?a.message:String(a)}})}else this.client.send({type:"llm.tool.call.response",payload:{requestId:u,success:!1,error:`No handler registered for tool: ${n}`}})}else console.error("[SDK] Invalid llm.tool.call payload:",r.issues)}}))}}var J;function Me(t){return{lang:t?.lang??J?.lang,message:t?.message,abortEarly:t?.abortEarly??J?.abortEarly,abortPipeEarly:t?.abortPipeEarly??J?.abortPipeEarly}}var Rs;function ws(t){return Rs?.get(t)}var qs;function Ss(t){return qs?.get(t)}var Es;function ks(t,e){return Es?.get(t)?.get(e)}function ee(t){const e=typeof t;return e==="string"?`"${t}"`:e==="number"||e==="bigint"||e==="boolean"?`${t}`:e==="object"||e==="function"?(t&&Object.getPrototypeOf(t)?.constructor?.name)??"null":e}function k(t,e,s,r,n){const o=n&&"input"in n?n.input:s.value,u=n?.expected??t.expects??null,d=n?.received??ee(o),a={kind:t.kind,type:t.type,input:o,expected:u,received:d,message:`Invalid ${e}: ${u?`Expected ${u} but r`:"R"}eceived ${d}`,requirement:t.requirement,path:n?.path,issues:n?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},f=t.kind==="schema",y=n?.message??t.message??ks(t.reference,a.lang)??(f?Ss(a.lang):null)??r.message??ws(a.lang);y!==void 0&&(a.message=typeof y=="function"?y(a):y),f&&(s.typed=!1),s.issues?s.issues.push(a):s.issues=[a]}function C(t){return{version:1,vendor:"valibot",validate(e){return t["~run"]({value:e},Me())}}}function Ue(t,e){const s=[...new Set(t)];return s.length>1?`(${s.join(` ${e} `)})`:s[0]??"never"}function Te(t,e){return{kind:"validation",type:"min_length",reference:Te,async:!1,expects:`>=${t}`,requirement:t,message:e,"~run"(s,r){return s.typed&&s.value.length<this.requirement&&k(this,"length",s,r,{received:`${s.value.length}`}),s}}}function Is(t,e,s){return typeof t.fallback=="function"?t.fallback(e,s):t.fallback}function Ds(t,e,s){return typeof t.default=="function"?t.default(e,s):t.default}function se(t,e){return{kind:"schema",type:"array",reference:se,expects:"Array",async:!1,item:t,message:e,get"~standard"(){return C(this)},"~run"(s,r){const n=s.value;if(Array.isArray(n)){s.typed=!0,s.value=[];for(let o=0;o<n.length;o++){const u=n[o],d=this.item["~run"]({value:u},r);if(d.issues){const a={type:"array",origin:"value",input:n,key:o,value:u};for(const f of d.issues)f.path?f.path.unshift(a):f.path=[a],s.issues?.push(f);if(s.issues||(s.issues=d.issues),r.abortEarly){s.typed=!1;break}}d.typed||(s.typed=!1),s.value.push(d.value)}}else k(this,"type",s,r);return s}}}function _e(t){return{kind:"schema",type:"boolean",reference:_e,expects:"boolean",async:!1,message:t,get"~standard"(){return C(this)},"~run"(e,s){return typeof e.value=="boolean"?e.typed=!0:k(this,"type",e,s),e}}}function $(t,e){return{kind:"schema",type:"literal",reference:$,expects:ee(t),async:!1,literal:t,message:e,get"~standard"(){return C(this)},"~run"(s,r){return s.value===this.literal?s.typed=!0:k(this,"type",s,r),s}}}function I(t,e){return{kind:"schema",type:"object",reference:I,expects:"Object",async:!1,entries:t,message:e,get"~standard"(){return C(this)},"~run"(s,r){const n=s.value;if(n&&typeof n=="object"){s.typed=!0,s.value={};for(const o in this.entries){const u=this.entries[o];if(o in n||(u.type==="exact_optional"||u.type==="optional"||u.type==="nullish")&&u.default!==void 0){const d=o in n?n[o]:Ds(u),a=u["~run"]({value:d},r);if(a.issues){const f={type:"object",origin:"value",input:n,key:o,value:d};for(const y of a.issues)y.path?y.path.unshift(f):y.path=[f],s.issues?.push(y);if(s.issues||(s.issues=a.issues),r.abortEarly){s.typed=!1;break}}a.typed||(s.typed=!1),s.value[o]=a.value}else if(u.fallback!==void 0)s.value[o]=Is(u);else if(u.type!=="exact_optional"&&u.type!=="optional"&&u.type!=="nullish"&&(k(this,"key",s,r,{input:void 0,expected:`"${o}"`,path:[{type:"object",origin:"key",input:n,key:o,value:n[o]}]}),r.abortEarly))break}}else k(this,"type",s,r);return s}}}function te(t,e){return{kind:"schema",type:"picklist",reference:te,expects:Ue(t.map(ee),"|"),async:!1,options:t,message:e,get"~standard"(){return C(this)},"~run"(s,r){return this.options.includes(s.value)?s.typed=!0:k(this,"type",s,r),s}}}function M(t){return{kind:"schema",type:"string",reference:M,expects:"string",async:!1,message:t,get"~standard"(){return C(this)},"~run"(e,s){return typeof e.value=="string"?e.typed=!0:k(this,"type",e,s),e}}}function re(t,e,s){return{kind:"schema",type:"variant",reference:re,expects:"Object",async:!1,key:t,options:e,message:s,get"~standard"(){return C(this)},"~run"(r,n){const o=r.value;if(o&&typeof o=="object"){let u,d=0,a=this.key,f=[];const y=(R,oe)=>{for(const F of R.options){if(F.type==="variant")y(F,new Set(oe).add(F.key));else{let ie=!0,U=0;for(const S of oe){const T=F.entries[S];if(S in o?T["~run"]({typed:!1,value:o[S]},{abortEarly:!0}).issues:T.type!=="exact_optional"&&T.type!=="optional"&&T.type!=="nullish"){ie=!1,a!==S&&(d<U||d===U&&S in o&&!(a in o))&&(d=U,a=S,f=[]),a===S&&f.push(F.entries[S].expects);break}U++}if(ie){const S=F["~run"]({value:o},n);(!u||!u.typed&&S.typed)&&(u=S)}}if(u&&!u.issues)break}};if(y(this,new Set([this.key])),u)return u;k(this,"type",r,n,{input:o[a],expected:Ue(f,"|"),path:[{type:"object",origin:"value",input:o,key:a,value:o[a]}]})}else k(this,"type",r,n);return r}}}function Cs(...t){return{...t[0],pipe:t,get"~standard"(){return C(this)},"~run"(e,s){for(const r of t)if(r.kind!=="metadata"){if(e.issues&&(r.kind==="schema"||r.kind==="transformation")){e.typed=!1;break}(!e.issues||!s.abortEarly&&!s.abortPipeEarly)&&(e=r["~run"](e,s))}return e}}}function ne(t,e,s){const r=t["~run"]({value:e},Me(s));return{typed:r.typed,success:!r.issues,output:r.value,issues:r.issues}}const $s=I({type:$("text"),text:M()}),xs=I({id:M(),role:te(["user","assistant"]),parts:se($s)}),je=I({messages:se(xs),hasApiKey:_e(),status:te(["idle","streaming"])}),Fs=I({type:$("getState")}),Ms=I({type:$("setApiKey"),apiKey:M()}),Us=I({type:$("sendChatMessage"),text:Cs(M(),Te(1))}),Ts=I({type:$("clearMessages")}),_s=I({type:$("clearApiKey")}),js=re("type",[Fs,Ms,Us,Ts,_s]),Ps=I({type:$("stateChanged"),state:je}),Ls=re("type",[Ps]);function Os(t){const e=ne(js,t);return e.success?{success:!0,data:e.output}:{success:!1,error:`Invalid command: ${JSON.stringify(e.issues)}`}}function Ks(t){const e=ne(Ls,t);return e.success?{success:!0,data:e.output}:{success:!1,error:`Invalid broadcast: ${JSON.stringify(e.issues)}`}}function Ns(t){const e=ne(je,t);return e.success?{success:!0,data:e.output}:{success:!1,error:`Invalid state: ${JSON.stringify(e.issues)}`}}export{As as P,Ns as a,Os as b,Ks as p};
