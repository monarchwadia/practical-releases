(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();var H;function qe(t){return{lang:t?.lang??H?.lang,message:t?.message,abortEarly:t?.abortEarly??H?.abortEarly,abortPipeEarly:t?.abortPipeEarly??H?.abortPipeEarly}}var Me;function je(t){return Me?.get(t)}var Le;function Pe(t){return Le?.get(t)}var Oe;function Ae(t,e){return Oe?.get(t)?.get(e)}function Y(t){const e=typeof t;return e==="string"?`"${t}"`:e==="number"||e==="bigint"||e==="boolean"?`${t}`:e==="object"||e==="function"?(t&&Object.getPrototypeOf(t)?.constructor?.name)??"null":e}function S(t,e,s,r,n){const o=n&&"input"in n?n.input:s.value,u=n?.expected??t.expects??null,p=n?.received??Y(o),a={kind:t.kind,type:t.type,input:o,expected:u,received:p,message:`Invalid ${e}: ${u?`Expected ${u} but r`:"R"}eceived ${p}`,requirement:t.requirement,path:n?.path,issues:n?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},f=t.kind==="schema",y=n?.message??t.message??Ae(t.reference,a.lang)??(f?Pe(a.lang):null)??r.message??je(a.lang);y!==void 0&&(a.message=typeof y=="function"?y(a):y),f&&(s.typed=!1),s.issues?s.issues.push(a):s.issues=[a]}function w(t){return{version:1,vendor:"valibot",validate(e){return t["~run"]({value:e},qe())}}}function Ke(t,e){return Object.hasOwn(t,e)&&e!=="__proto__"&&e!=="prototype"&&e!=="constructor"}function ke(t,e){const s=[...new Set(t)];return s.length>1?`(${s.join(` ${e} `)})`:s[0]??"never"}function Ne(t,e,s){return typeof t.fallback=="function"?t.fallback(e,s):t.fallback}function Z(t,e,s){return typeof t.default=="function"?t.default(e,s):t.default}function F(t,e){return{kind:"schema",type:"array",reference:F,expects:"Array",async:!1,item:t,message:e,get"~standard"(){return w(this)},"~run"(s,r){const n=s.value;if(Array.isArray(n)){s.typed=!0,s.value=[];for(let o=0;o<n.length;o++){const u=n[o],p=this.item["~run"]({value:u},r);if(p.issues){const a={type:"array",origin:"value",input:n,key:o,value:u};for(const f of p.issues)f.path?f.path.unshift(a):f.path=[a],s.issues?.push(f);if(s.issues||(s.issues=p.issues),r.abortEarly){s.typed=!1;break}}p.typed||(s.typed=!1),s.value.push(p.value)}}else S(this,"type",s,r);return s}}}function v(t){return{kind:"schema",type:"boolean",reference:v,expects:"boolean",async:!1,message:t,get"~standard"(){return w(this)},"~run"(e,s){return typeof e.value=="boolean"?e.typed=!0:S(this,"type",e,s),e}}}function l(t,e){return{kind:"schema",type:"literal",reference:l,expects:Y(t),async:!1,literal:t,message:e,get"~standard"(){return w(this)},"~run"(s,r){return s.value===this.literal?s.typed=!0:S(this,"type",s,r),s}}}function D(t,e){return{kind:"schema",type:"nullable",reference:D,expects:`(${t.expects} | null)`,async:!1,wrapped:t,default:e,get"~standard"(){return w(this)},"~run"(s,r){return s.value===null&&(this.default!==void 0&&(s.value=Z(this,s,r)),s.value===null)?(s.typed=!0,s):this.wrapped["~run"](s,r)}}}function G(t){return{kind:"schema",type:"number",reference:G,expects:"number",async:!1,message:t,get"~standard"(){return w(this)},"~run"(e,s){return typeof e.value=="number"&&!isNaN(e.value)?e.typed=!0:S(this,"type",e,s),e}}}function d(t,e){return{kind:"schema",type:"object",reference:d,expects:"Object",async:!1,entries:t,message:e,get"~standard"(){return w(this)},"~run"(s,r){const n=s.value;if(n&&typeof n=="object"){s.typed=!0,s.value={};for(const o in this.entries){const u=this.entries[o];if(o in n||(u.type==="exact_optional"||u.type==="optional"||u.type==="nullish")&&u.default!==void 0){const p=o in n?n[o]:Z(u),a=u["~run"]({value:p},r);if(a.issues){const f={type:"object",origin:"value",input:n,key:o,value:p};for(const y of a.issues)y.path?y.path.unshift(f):y.path=[f],s.issues?.push(y);if(s.issues||(s.issues=a.issues),r.abortEarly){s.typed=!1;break}}a.typed||(s.typed=!1),s.value[o]=a.value}else if(u.fallback!==void 0)s.value[o]=Ne(u);else if(u.type!=="exact_optional"&&u.type!=="optional"&&u.type!=="nullish"&&(S(this,"key",s,r,{input:void 0,expected:`"${o}"`,path:[{type:"object",origin:"key",input:n,key:o,value:n[o]}]}),r.abortEarly))break}}else S(this,"type",s,r);return s}}}function h(t,e){return{kind:"schema",type:"optional",reference:h,expects:`(${t.expects} | undefined)`,async:!1,wrapped:t,default:e,get"~standard"(){return w(this)},"~run"(s,r){return s.value===void 0&&(this.default!==void 0&&(s.value=Z(this,s,r)),s.value===void 0)?(s.typed=!0,s):this.wrapped["~run"](s,r)}}}function Se(t,e){return{kind:"schema",type:"picklist",reference:Se,expects:ke(t.map(Y),"|"),async:!1,options:t,message:e,get"~standard"(){return w(this)},"~run"(s,r){return this.options.includes(s.value)?s.typed=!0:S(this,"type",s,r),s}}}function Ee(t,e,s){return{kind:"schema",type:"record",reference:Ee,expects:"Object",async:!1,key:t,value:e,message:s,get"~standard"(){return w(this)},"~run"(r,n){const o=r.value;if(o&&typeof o=="object"){r.typed=!0,r.value={};for(const u in o)if(Ke(o,u)){const p=o[u],a=this.key["~run"]({value:u},n);if(a.issues){const y={type:"object",origin:"key",input:o,key:u,value:p};for(const R of a.issues)R.path=[y],r.issues?.push(R);if(r.issues||(r.issues=a.issues),n.abortEarly){r.typed=!1;break}}const f=this.value["~run"]({value:p},n);if(f.issues){const y={type:"object",origin:"value",input:o,key:u,value:p};for(const R of f.issues)R.path?R.path.unshift(y):R.path=[y],r.issues?.push(R);if(r.issues||(r.issues=f.issues),n.abortEarly){r.typed=!1;break}}(!a.typed||!f.typed)&&(r.typed=!1),a.typed&&(r.value[a.value]=f.value)}}else S(this,"type",r,n);return r}}}function i(t){return{kind:"schema",type:"string",reference:i,expects:"string",async:!1,message:t,get"~standard"(){return w(this)},"~run"(e,s){return typeof e.value=="string"?e.typed=!0:S(this,"type",e,s),e}}}function ue(t){let e;if(t)for(const s of t)e?e.push(...s.issues):e=s.issues;return e}function m(t,e){return{kind:"schema",type:"union",reference:m,expects:ke(t.map(s=>s.expects),"|"),async:!1,options:t,message:e,get"~standard"(){return w(this)},"~run"(s,r){let n,o,u;for(const p of this.options){const a=p["~run"]({value:s.value},r);if(a.typed)if(a.issues)o?o.push(a):o=[a];else{n=a;break}else u?u.push(a):u=[a]}if(n)return n;if(o){if(o.length===1)return o[0];S(this,"type",s,r,{issues:ue(o)}),s.typed=!0}else{if(u?.length===1)return u[0];S(this,"type",s,r,{issues:ue(u)})}return s}}}function b(){return{kind:"schema",type:"unknown",reference:b,expects:"unknown",async:!1,get"~standard"(){return w(this)},"~run"(t){return t.typed=!0,t}}}function k(t,e,s){const r=t["~run"]({value:e},qe(s));return{typed:r.typed,success:!r.issues,output:r.value,issues:r.issues}}const c=(t,e)=>d({type:l(t),payload:d({requestId:i(),...e})}),ae={Request:c("vfs.exists",{path:i()}),Response:m([c("vfs.exists.response",{success:l(!0),data:d({exists:v(),entryType:D(i())})}),c("vfs.exists.response",{success:l(!1),error:i()})])},Ue=d({name:i(),type:m([l("file"),l("directory")]),size:G()}),ce={Request:c("vfs.readDir",{path:i()}),Response:m([c("vfs.readDir.response",{success:l(!0),data:F(Ue)}),c("vfs.readDir.response",{success:l(!1),error:i()})])},le={Request:c("vfs.readFile",{path:i()}),Response:m([c("vfs.readFile.response",{success:l(!0),data:i()}),c("vfs.readFile.response",{success:l(!1),error:i()})])},pe={Request:c("vfs.writeFile",{path:i(),content:i()}),Response:m([c("vfs.writeFile.response",{success:l(!0)}),c("vfs.writeFile.response",{success:l(!1),error:i()})])},de={Request:c("editor.openFile",{path:i()}),Response:m([c("editor.openFile.response",{success:l(!0)}),c("editor.openFile.response",{success:l(!1),error:i()})])},_e={Request:c("document.content",{content:i(),hash:i(),isRevert:h(v())}),Response:m([c("document.content.response",{success:l(!0)}),c("document.content.response",{success:l(!1),error:i()})])},fe={Request:c("document.edited",{description:i()}),Response:m([c("document.edited.response",{success:l(!0)}),c("document.edited.response",{success:l(!1),error:i()})])},ye={Request:c("document.save",{}),Response:m([c("document.save.response",{success:l(!0),hash:i()}),c("document.save.response",{success:l(!1),error:i()})])},Be={Request:c("document.saveRequested",{}),Response:m([c("document.saveRequested.response",{success:l(!0),content:i()}),c("document.saveRequested.response",{success:l(!1),error:i()})])},Te={Request:c("document.saved",{hash:i()}),Response:m([c("document.saved.response",{success:l(!0)}),c("document.saved.response",{success:l(!1),error:i()})])},Ve={Request:c("document.revert",{}),Response:m([c("document.revert.response",{success:l(!0)}),c("document.revert.response",{success:l(!1),error:i()})])},Ge=d({isOpen:v(),path:D(i()),name:D(i())}),he={Request:c("workspace.getDetails",{}),Response:m([c("workspace.getDetails.response",{success:l(!0),data:Ge}),c("workspace.getDetails.response",{success:l(!1),error:i()})])},He=d({type:l("workspace.changed"),isOpen:v(),path:D(i()),name:D(i())}),me={Request:c("workspace.open",{}),Response:m([c("workspace.open.response",{success:l(!0),path:D(i())}),c("workspace.open.response",{success:l(!1),error:i()})])},ge={Request:c("native.call",{pluginId:i(),moduleId:i(),command:i(),args:b()}),Response:m([c("native.call.response",{success:l(!0),data:b()}),c("native.call.response",{success:l(!1),error:i()})])},ve={Request:c("fs.subscribe",{}),Response:m([c("fs.subscribe.response",{success:l(!0)}),c("fs.subscribe.response",{success:l(!1),error:i()})])},be={Request:c("fs.unsubscribe",{}),Response:m([c("fs.unsubscribe.response",{success:l(!0)}),c("fs.unsubscribe.response",{success:l(!1),error:i()})])},We=d({type:l("fs.fileChanged"),payload:d({path:i(),kind:m([l("created"),l("modified"),l("deleted")])})});var P;(function(t){t.Request=c("plugin.sendMessage",{targetModuleId:i(),message:b()}),t.Response=d({type:l("plugin.sendMessage.response"),payload:d({requestId:i(),success:v(),data:h(b()),error:h(i())})})})(P||(P={}));var z;(function(t){t.Request=c("plugin.message",{fromModuleId:i(),message:b()}),t.Response=d({type:l("plugin.message.response"),payload:d({requestId:i(),success:v(),data:h(b()),error:h(i())})})})(z||(z={}));var O;(function(t){t.Request=c("plugin.sendBroadcast",{message:b()}),t.Response=d({type:l("plugin.sendBroadcast.response"),payload:d({requestId:i(),success:v(),error:h(i())})})})(O||(O={}));var Q;(function(t){t.Event=d({type:l("plugin.broadcast"),payload:d({fromModuleId:i(),message:b()})})})(Q||(Q={}));var A;(function(t){t.Request=c("storage.getSecret",{key:i()}),t.Response=d({type:l("storage.getSecret.response"),payload:d({requestId:i(),success:v(),value:D(i()),error:h(i())})})})(A||(A={}));var K;(function(t){t.Request=c("storage.setSecret",{key:i(),value:i()}),t.Response=d({type:l("storage.setSecret.response"),payload:d({requestId:i(),success:v(),error:h(i())})})})(K||(K={}));var N;(function(t){t.Request=c("storage.deleteSecret",{key:i()}),t.Response=d({type:l("storage.deleteSecret.response"),payload:d({requestId:i(),success:v(),error:h(i())})})})(N||(N={}));const Je=Se(["debug","info","warn","error"]);var U;(function(t){t.Request=c("logs.write",{level:Je,channelName:i(),args:F(b())}),t.Response=d({type:l("logs.write.response"),payload:d({requestId:i(),success:v(),error:h(i())})})})(U||(U={}));const Ie=d({type:l("object"),properties:Ee(i(),b()),required:h(F(i()))}),ze=d({id:i(),name:i(),description:i(),parameters:Ie,provider:d({pluginId:i(),moduleId:i()}),timeoutMs:h(G())});var _;(function(t){t.Request=c("llm.tool.list",{}),t.Response=d({type:l("llm.tool.list.response"),payload:d({requestId:i(),success:v(),tools:F(ze),error:h(i())})})})(_||(_={}));var B;(function(t){t.Request=c("llm.tool.execute",{toolId:i(),arguments:b()}),t.Response=d({type:l("llm.tool.execute.response"),payload:d({requestId:i(),success:v(),result:h(b()),error:h(i())})})})(B||(B={}));var T;(function(t){t.Request=c("llm.tool.register",{name:i(),description:i(),parameters:Ie,timeoutMs:h(G())}),t.Response=d({type:l("llm.tool.register.response"),payload:d({requestId:i(),success:v(),toolId:h(i()),error:h(i())})})})(T||(T={}));var V;(function(t){t.Request=c("llm.tool.unregister",{name:i()}),t.Response=d({type:l("llm.tool.unregister.response"),payload:d({requestId:i(),success:v(),error:h(i())})})})(V||(V={}));var X;(function(t){t.Request=c("llm.tool.call",{toolName:i(),arguments:b()}),t.Response=d({type:l("llm.tool.call.response"),payload:d({requestId:i(),success:v(),result:h(b()),error:h(i())})})})(X||(X={}));class Qe{subscribers=new Set;handleMessage=e=>{this.subscribers.forEach(s=>s(e))};constructor(){}init(){window.addEventListener("message",this.handleMessage)}destroy(){window.removeEventListener("message",this.handleMessage),this.subscribers.clear()}subscribe(e){return this.subscribers.add(e),()=>{this.subscribers.delete(e)}}send(e){window.parent.postMessage(e,"*")}}const g=[];for(let t=0;t<256;++t)g.push((t+256).toString(16).slice(1));function Xe(t,e=0){return(g[t[e+0]]+g[t[e+1]]+g[t[e+2]]+g[t[e+3]]+"-"+g[t[e+4]]+g[t[e+5]]+"-"+g[t[e+6]]+g[t[e+7]]+"-"+g[t[e+8]]+g[t[e+9]]+"-"+g[t[e+10]]+g[t[e+11]]+g[t[e+12]]+g[t[e+13]]+g[t[e+14]]+g[t[e+15]]).toLowerCase()}let W;const Ye=new Uint8Array(16);function Ze(){if(!W){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");W=crypto.getRandomValues.bind(crypto)}return W(Ye)}const es=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Re={randomUUID:es};function ss(t,e,s){t=t||{};const r=t.random??t.rng?.()??Ze();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Xe(r)}function ts(t,e,s){return Re.randomUUID&&!t?Re.randomUUID():ss(t)}class rs{messageBus;pendingRequests=new Map;constructor(){this.messageBus=new Qe}init(){this.messageBus.init(),this.messageBus.subscribe(this.handleMessage)}destroy(){this.messageBus.destroy(),this.pendingRequests.clear()}subscribe(e){return this.messageBus.subscribe(e)}send(e){this.messageBus.send(e)}handleMessage=e=>{console.log("Received message:",e.data);const{type:s,payload:r}=e.data||{};if(s&&s.endsWith(".response")&&r?.requestId){const n=this.pendingRequests.get(r.requestId);n&&(n({type:s,payload:r}),this.pendingRequests.delete(r.requestId))}};async sendRequest(e,s,r,n){const o=ts(),u={type:e,payload:{requestId:o,...s}};console.log(`[SDK] Sending request ${e}:`,u);const p=k(r,u);if(!p.success)throw console.error(`[SDK] Invalid request shape for ${e}:`,p.issues),new Error(`Invalid request shape for ${e}`);return new Promise((a,f)=>{this.pendingRequests.set(o,y=>{const R=k(n,y);if(!R.success){console.error(`[SDK] Invalid response shape for ${e}:`,R.issues),f(new Error(`Invalid response shape for ${e}`));return}a(R.output.payload)}),this.messageBus.send(u)})}}class we{channelName;logChannelAdapters;constructor(e,s){this.channelName=e,this.logChannelAdapters=s}writeLog(e,s,r){for(const n of this.logChannelAdapters)try{n.writeLog(e,s,...r)}catch(o){console.error(`LogChannel failed to write log via adapter: ${o}`)}}debug(...e){this.writeLog(this.channelName,"debug",e)}info(...e){this.writeLog(this.channelName,"info",e)}warn(...e){this.writeLog(this.channelName,"warn",e)}error(...e){this.writeLog(this.channelName,"error",e)}}class ns{client;constructor(e){this.client=e}writeLog(e,s,...r){const n=r.map(o=>{if(typeof o=="string")return o;if(o instanceof Error)return`Error: ${o.message}
${o.stack}`;try{return JSON.stringify(o)}catch{return String(o)}}).join(" ");this.client.sendRequest("logs.write",{level:s,channelName:e,args:[n]},U.Request,U.Response).catch(o=>{console.error("Failed to write log:",o)})}}class Ss{client;primaryLogChannel;logAdapters;toolHandlers=new Map;toolCallUnsubscribe=null;constructor(){this.client=new rs;const e=new ns(this.client);this.logAdapters=[e],this.primaryLogChannel=new we("default",this.logAdapters)}init(){this.client.init()}destroy(){this.client.destroy()}onMessage(e){return this.client.subscribe(e)}vfs={exists:async e=>{const s=await this.client.sendRequest("vfs.exists",{path:e},ae.Request,ae.Response);if(s.success)return s.data;throw new Error(s.error)},readDir:async e=>{const s=await this.client.sendRequest("vfs.readDir",{path:e},ce.Request,ce.Response);if(s.success)return s.data;throw new Error(s.error)},readFile:async e=>{const s=await this.client.sendRequest("vfs.readFile",{path:e},le.Request,le.Response);if(s.success)return s.data;throw new Error(s.error)},writeFile:async(e,s)=>{const r=await this.client.sendRequest("vfs.writeFile",{path:e,content:s},pe.Request,pe.Response);if(!r.success)throw new Error(r.error)}};workspace={getDetails:async()=>{const e=await this.client.sendRequest("workspace.getDetails",{},he.Request,he.Response);if(e.success)return e.data;throw new Error(e.error)},onChanged:e=>this.client.subscribe(s=>{const{type:r,payload:n}=s.data||{};if(r==="workspace.changed"){const o=k(He,{type:r,...n});o.success?e(o.output):console.error("[SDK] Invalid workspace.changed payload:",o.issues)}}),open:async()=>{const e=await this.client.sendRequest("workspace.open",{},me.Request,me.Response);if(e.success)return e.path;throw new Error(e.error)}};editor={openFile:async e=>{const s=await this.client.sendRequest("editor.openFile",{path:e},de.Request,de.Response);if(!s.success)throw new Error(s.error)}};native={call:async(e,s,r,n)=>{const o=await this.client.sendRequest("native.call",{pluginId:e,moduleId:s,command:r,args:n},ge.Request,ge.Response);if(o.success)return o.data;throw new Error(o.error)}};fs={subscribe:async()=>{const e=await this.client.sendRequest("fs.subscribe",{},ve.Request,ve.Response);if(!e.success)throw new Error(e.error)},unsubscribe:async()=>{const e=await this.client.sendRequest("fs.unsubscribe",{},be.Request,be.Response);if(!e.success)throw new Error(e.error)},onFileChanged:e=>this.client.subscribe(s=>{const{type:r}=s.data||{};if(r==="fs.fileChanged"){const n=k(We,s.data);n.success?e(n.output):console.error("[SDK] Invalid fs.fileChanged payload:",n.issues)}})};document={edited:async(e="edit")=>{const s=await this.client.sendRequest("document.edited",{description:e},fe.Request,fe.Response);if(!s.success)throw new Error(s.error)},requestSave:async()=>{const e=await this.client.sendRequest("document.save",{},ye.Request,ye.Response);if(!e.success)throw new Error(e.error);return e.hash},onContent:e=>this.client.subscribe(s=>{const{type:r}=s.data||{};if(r==="document.content"){const n=k(_e.Request,s.data);n.success?e(n.output.payload):console.error("[SDK] Invalid document.content payload:",n.issues)}}),onSaveRequested:e=>this.client.subscribe(async s=>{const{type:r}=s.data||{};if(r==="document.saveRequested"){const n=k(Be.Request,s.data);if(n.success)try{const o=await e(n.output.payload);this.client.send({type:"document.saveRequested.response",payload:{requestId:n.output.payload.requestId,success:!0,content:o}})}catch(o){this.client.send({type:"document.saveRequested.response",payload:{requestId:n.output.payload.requestId,success:!1,error:o instanceof Error?o.message:String(o)}})}else console.error("[SDK] Invalid document.saveRequested payload:",n.issues)}}),onSaved:e=>this.client.subscribe(s=>{const{type:r}=s.data||{};if(r==="document.saved"){const n=k(Te.Request,s.data);n.success?e(n.output.payload):console.error("[SDK] Invalid document.saved payload:",n.issues)}}),onRevert:e=>this.client.subscribe(s=>{const{type:r}=s.data||{};if(r==="document.revert"){const n=k(Ve.Request,s.data);n.success?e(n.output.payload):console.error("[SDK] Invalid document.revert payload:",n.issues)}}),respondToContent:(e,s,r)=>{s?this.client.send({type:"document.content.response",payload:{requestId:e,success:!0}}):this.client.send({type:"document.content.response",payload:{requestId:e,success:!1,error:r||"Unknown error"}})},respondToRevert:(e,s,r)=>{s?this.client.send({type:"document.revert.response",payload:{requestId:e,success:!0}}):this.client.send({type:"document.revert.response",payload:{requestId:e,success:!1,error:r||"Unknown error"}})},respondToSaved:(e,s,r)=>{s?this.client.send({type:"document.saved.response",payload:{requestId:e,success:!0}}):this.client.send({type:"document.saved.response",payload:{requestId:e,success:!1,error:r||"Unknown error"}})}};plugin={sendMessage:async(e,s)=>{const r=await this.client.sendRequest("plugin.sendMessage",{targetModuleId:e,message:s},P.Request,P.Response);if(r.success)return r.data;throw new Error(r.error||"Failed to send message")},onMessage:e=>this.client.subscribe(s=>{const{type:r}=s.data||{};if(r==="plugin.message"){const n=k(z.Request,s.data);if(n.success){const o=n.output.payload.requestId;Promise.resolve().then(()=>e(n.output.payload)).then(u=>{this.client.send({type:"plugin.message.response",payload:{requestId:o,success:!0,data:u}})}).catch(u=>{console.error("[SDK] Error in plugin.onMessage handler:",u),this.client.send({type:"plugin.message.response",payload:{requestId:o,success:!1,error:u instanceof Error?u.message:String(u)}})})}else console.error("[SDK] Invalid plugin.message payload:",n.issues)}}),sendBroadcast:async e=>{const s=await this.client.sendRequest("plugin.sendBroadcast",{message:e},O.Request,O.Response);if(!s.success)throw new Error(s.error||"Failed to send broadcast")},onBroadcast:e=>this.client.subscribe(s=>{const{type:r}=s.data||{};if(r==="plugin.broadcast"){const n=k(Q.Event,s.data);n.success?e(n.output.payload):console.error("[SDK] Invalid plugin.broadcast payload:",n.issues)}})};storage={getSecret:async e=>{const s=await this.client.sendRequest("storage.getSecret",{key:e},A.Request,A.Response);if(s.success)return s.value;throw new Error(s.error||"Failed to get secret")},setSecret:async(e,s)=>{const r=await this.client.sendRequest("storage.setSecret",{key:e,value:s},K.Request,K.Response);if(!r.success)throw new Error(r.error||"Failed to set secret")},deleteSecret:async e=>{const s=await this.client.sendRequest("storage.deleteSecret",{key:e},N.Request,N.Response);if(!s.success)throw new Error(s.error||"Failed to delete secret")}};logs={createChannel:e=>new we(e,this.logAdapters),debug:e=>this.primaryLogChannel.debug(e),info:e=>this.primaryLogChannel.info(e),warn:e=>this.primaryLogChannel.warn(e),error:e=>this.primaryLogChannel.error(e)};llm={listTools:async()=>{const e=await this.client.sendRequest("llm.tool.list",{},_.Request,_.Response);if(e.success)return e.tools;throw new Error(e.error||"Failed to list tools")},executeTool:async(e,s)=>{const r=await this.client.sendRequest("llm.tool.execute",{toolId:e,arguments:s},B.Request,B.Response);if(r.success)return r.result;throw new Error(r.error||"Failed to execute tool")},registerTool:async e=>{this.toolHandlers.set(e.name,e.handler),this.ensureToolCallListener();const s=await this.client.sendRequest("llm.tool.register",{name:e.name,description:e.description,parameters:e.parameters,timeoutMs:e.timeoutMs},T.Request,T.Response);if(s.success&&s.toolId)return s.toolId;throw this.toolHandlers.delete(e.name),new Error(s.error||"Failed to register tool")},unregisterTool:async e=>{const s=await this.client.sendRequest("llm.tool.unregister",{name:e},V.Request,V.Response);if(s.success)this.toolHandlers.delete(e);else throw new Error(s.error||"Failed to unregister tool")}};ensureToolCallListener(){this.toolCallUnsubscribe||(this.toolCallUnsubscribe=this.client.subscribe(async e=>{const{type:s}=e.data||{};if(s==="llm.tool.call"){const r=k(X.Request,e.data);if(r.success){const{toolName:n,arguments:o}=r.output.payload,u=r.output.payload.requestId,p=this.toolHandlers.get(n);if(p)try{const a=await Promise.resolve(p(o));this.client.send({type:"llm.tool.call.response",payload:{requestId:u,success:!0,result:a}})}catch(a){this.client.send({type:"llm.tool.call.response",payload:{requestId:u,success:!1,error:a instanceof Error?a.message:String(a)}})}else this.client.send({type:"llm.tool.call.response",payload:{requestId:u,success:!1,error:`No handler registered for tool: ${n}`}})}else console.error("[SDK] Invalid llm.tool.call payload:",r.issues)}}))}}var J;function De(t){return{lang:t?.lang??J?.lang,message:t?.message,abortEarly:t?.abortEarly??J?.abortEarly,abortPipeEarly:t?.abortPipeEarly??J?.abortPipeEarly}}var os;function is(t){return os?.get(t)}var us;function as(t){return us?.get(t)}var cs;function ls(t,e){return cs?.get(t)?.get(e)}function ee(t){const e=typeof t;return e==="string"?`"${t}"`:e==="number"||e==="bigint"||e==="boolean"?`${t}`:e==="object"||e==="function"?(t&&Object.getPrototypeOf(t)?.constructor?.name)??"null":e}function E(t,e,s,r,n){const o=n&&"input"in n?n.input:s.value,u=n?.expected??t.expects??null,p=n?.received??ee(o),a={kind:t.kind,type:t.type,input:o,expected:u,received:p,message:`Invalid ${e}: ${u?`Expected ${u} but r`:"R"}eceived ${p}`,requirement:t.requirement,path:n?.path,issues:n?.issues,lang:r.lang,abortEarly:r.abortEarly,abortPipeEarly:r.abortPipeEarly},f=t.kind==="schema",y=n?.message??t.message??ls(t.reference,a.lang)??(f?as(a.lang):null)??r.message??is(a.lang);y!==void 0&&(a.message=typeof y=="function"?y(a):y),f&&(s.typed=!1),s.issues?s.issues.push(a):s.issues=[a]}function $(t){return{version:1,vendor:"valibot",validate(e){return t["~run"]({value:e},De())}}}function $e(t,e){const s=[...new Set(t)];return s.length>1?`(${s.join(` ${e} `)})`:s[0]??"never"}function xe(t,e){return{kind:"validation",type:"min_length",reference:xe,async:!1,expects:`>=${t}`,requirement:t,message:e,"~run"(s,r){return s.typed&&s.value.length<this.requirement&&E(this,"length",s,r,{received:`${s.value.length}`}),s}}}function ps(t,e,s){return typeof t.fallback=="function"?t.fallback(e,s):t.fallback}function ds(t,e,s){return typeof t.default=="function"?t.default(e,s):t.default}function se(t,e){return{kind:"schema",type:"array",reference:se,expects:"Array",async:!1,item:t,message:e,get"~standard"(){return $(this)},"~run"(s,r){const n=s.value;if(Array.isArray(n)){s.typed=!0,s.value=[];for(let o=0;o<n.length;o++){const u=n[o],p=this.item["~run"]({value:u},r);if(p.issues){const a={type:"array",origin:"value",input:n,key:o,value:u};for(const f of p.issues)f.path?f.path.unshift(a):f.path=[a],s.issues?.push(f);if(s.issues||(s.issues=p.issues),r.abortEarly){s.typed=!1;break}}p.typed||(s.typed=!1),s.value.push(p.value)}}else E(this,"type",s,r);return s}}}function Ce(t){return{kind:"schema",type:"boolean",reference:Ce,expects:"boolean",async:!1,message:t,get"~standard"(){return $(this)},"~run"(e,s){return typeof e.value=="boolean"?e.typed=!0:E(this,"type",e,s),e}}}function x(t,e){return{kind:"schema",type:"literal",reference:x,expects:ee(t),async:!1,literal:t,message:e,get"~standard"(){return $(this)},"~run"(s,r){return s.value===this.literal?s.typed=!0:E(this,"type",s,r),s}}}function I(t,e){return{kind:"schema",type:"object",reference:I,expects:"Object",async:!1,entries:t,message:e,get"~standard"(){return $(this)},"~run"(s,r){const n=s.value;if(n&&typeof n=="object"){s.typed=!0,s.value={};for(const o in this.entries){const u=this.entries[o];if(o in n||(u.type==="exact_optional"||u.type==="optional"||u.type==="nullish")&&u.default!==void 0){const p=o in n?n[o]:ds(u),a=u["~run"]({value:p},r);if(a.issues){const f={type:"object",origin:"value",input:n,key:o,value:p};for(const y of a.issues)y.path?y.path.unshift(f):y.path=[f],s.issues?.push(y);if(s.issues||(s.issues=a.issues),r.abortEarly){s.typed=!1;break}}a.typed||(s.typed=!1),s.value[o]=a.value}else if(u.fallback!==void 0)s.value[o]=ps(u);else if(u.type!=="exact_optional"&&u.type!=="optional"&&u.type!=="nullish"&&(E(this,"key",s,r,{input:void 0,expected:`"${o}"`,path:[{type:"object",origin:"key",input:n,key:o,value:n[o]}]}),r.abortEarly))break}}else E(this,"type",s,r);return s}}}function te(t,e){return{kind:"schema",type:"picklist",reference:te,expects:$e(t.map(ee),"|"),async:!1,options:t,message:e,get"~standard"(){return $(this)},"~run"(s,r){return this.options.includes(s.value)?s.typed=!0:E(this,"type",s,r),s}}}function M(t){return{kind:"schema",type:"string",reference:M,expects:"string",async:!1,message:t,get"~standard"(){return $(this)},"~run"(e,s){return typeof e.value=="string"?e.typed=!0:E(this,"type",e,s),e}}}function re(t,e,s){return{kind:"schema",type:"variant",reference:re,expects:"Object",async:!1,key:t,options:e,message:s,get"~standard"(){return $(this)},"~run"(r,n){const o=r.value;if(o&&typeof o=="object"){let u,p=0,a=this.key,f=[];const y=(R,oe)=>{for(const C of R.options){if(C.type==="variant")y(C,new Set(oe).add(C.key));else{let ie=!0,j=0;for(const q of oe){const L=C.entries[q];if(q in o?L["~run"]({typed:!1,value:o[q]},{abortEarly:!0}).issues:L.type!=="exact_optional"&&L.type!=="optional"&&L.type!=="nullish"){ie=!1,a!==q&&(p<j||p===j&&q in o&&!(a in o))&&(p=j,a=q,f=[]),a===q&&f.push(C.entries[q].expects);break}j++}if(ie){const q=C["~run"]({value:o},n);(!u||!u.typed&&q.typed)&&(u=q)}}if(u&&!u.issues)break}};if(y(this,new Set([this.key])),u)return u;E(this,"type",r,n,{input:o[a],expected:$e(f,"|"),path:[{type:"object",origin:"value",input:o,key:a,value:o[a]}]})}else E(this,"type",r,n);return r}}}function fs(...t){return{...t[0],pipe:t,get"~standard"(){return $(this)},"~run"(e,s){for(const r of t)if(r.kind!=="metadata"){if(e.issues&&(r.kind==="schema"||r.kind==="transformation")){e.typed=!1;break}(!e.issues||!s.abortEarly&&!s.abortPipeEarly)&&(e=r["~run"](e,s))}return e}}}function ne(t,e,s){const r=t["~run"]({value:e},De(s));return{typed:r.typed,success:!r.issues,output:r.value,issues:r.issues}}const ys=I({type:x("text"),text:M()}),hs=I({id:M(),role:te(["user","assistant"]),parts:se(ys)}),Fe=I({messages:se(hs),hasApiKey:Ce(),status:te(["idle","streaming"])}),ms=I({type:x("getState")}),gs=I({type:x("setApiKey"),apiKey:M()}),vs=I({type:x("sendChatMessage"),text:fs(M(),xe(1))}),bs=I({type:x("clearMessages")}),Rs=I({type:x("clearApiKey")}),ws=re("type",[ms,gs,vs,bs,Rs]),qs=I({type:x("stateChanged"),state:Fe}),ks=re("type",[qs]);function Es(t){const e=ne(ws,t);return e.success?{success:!0,data:e.output}:{success:!1,error:`Invalid command: ${JSON.stringify(e.issues)}`}}function Is(t){const e=ne(ks,t);return e.success?{success:!0,data:e.output}:{success:!1,error:`Invalid broadcast: ${JSON.stringify(e.issues)}`}}function Ds(t){const e=ne(Fe,t);return e.success?{success:!0,data:e.output}:{success:!1,error:`Invalid state: ${JSON.stringify(e.issues)}`}}export{Ss as P,Ds as a,Es as b,Is as p};
