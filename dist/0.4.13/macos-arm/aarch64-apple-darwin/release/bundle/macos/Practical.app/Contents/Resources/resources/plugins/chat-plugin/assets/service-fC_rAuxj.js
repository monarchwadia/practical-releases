import{P as xl,b as Sl}from"./protocol-BviX4ioN.js";var rs="vercel.ai.error",Tl=Symbol.for(rs),ns,El=class as extends Error{constructor({name:t,message:r,cause:n}){super(r),this[ns]=!0,this.name=t,this.cause=n}static isInstance(t){return as.hasMarker(t,rs)}static hasMarker(t,r){const n=Symbol.for(r);return t!=null&&typeof t=="object"&&n in t&&typeof t[n]=="boolean"&&t[n]===!0}};ns=Tl;var de=El,os="AI_APICallError",ss=`vercel.ai.error.${os}`,$l=Symbol.for(ss),is,ze=class extends de{constructor({message:t,url:r,requestBodyValues:n,statusCode:a,responseHeaders:o,responseBody:s,cause:i,isRetryable:l=a!=null&&(a===408||a===409||a===429||a>=500),data:u}){super({name:os,message:t,cause:i}),this[is]=!0,this.url=r,this.requestBodyValues=n,this.statusCode=a,this.responseHeaders=o,this.responseBody=s,this.isRetryable=l,this.data=u}static isInstance(t){return de.hasMarker(t,ss)}};is=$l;var us="AI_EmptyResponseBodyError",ls=`vercel.ai.error.${us}`,Al=Symbol.for(ls),cs,Ol=class extends de{constructor({message:t="Empty response body"}={}){super({name:us,message:t}),this[cs]=!0}static isInstance(t){return de.hasMarker(t,ls)}};cs=Al;function ds(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var ps="AI_InvalidArgumentError",fs=`vercel.ai.error.${ps}`,Cl=Symbol.for(fs),ms,hs=class extends de{constructor({message:t,cause:r,argument:n}){super({name:ps,message:t,cause:r}),this[ms]=!0,this.argument=n}static isInstance(t){return de.hasMarker(t,fs)}};ms=Cl;var gs="AI_InvalidPromptError",vs=`vercel.ai.error.${gs}`,Nl=Symbol.for(vs),ys,Pl=class extends de{constructor({prompt:t,message:r,cause:n}){super({name:gs,message:`Invalid prompt: ${r}`,cause:n}),this[ys]=!0,this.prompt=t}static isInstance(t){return de.hasMarker(t,vs)}};ys=Nl;var _s="AI_InvalidResponseDataError",bs=`vercel.ai.error.${_s}`,Rl=Symbol.for(bs),ws,Wr=class extends de{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:_s,message:t}),this[ws]=!0,this.data=e}static isInstance(e){return de.hasMarker(e,bs)}};ws=Rl;var Is="AI_JSONParseError",ks=`vercel.ai.error.${Is}`,Ml=Symbol.for(ks),xs,xr=class extends de{constructor({text:t,cause:r}){super({name:Is,message:`JSON parsing failed: Text: ${t}.
Error message: ${ds(r)}`,cause:r}),this[xs]=!0,this.text=t}static isInstance(t){return de.hasMarker(t,ks)}};xs=Ml;var Ss="AI_LoadAPIKeyError",Ts=`vercel.ai.error.${Ss}`,zl=Symbol.for(Ts),Es,gr=class extends de{constructor({message:e}){super({name:Ss,message:e}),this[Es]=!0}static isInstance(e){return de.hasMarker(e,Ts)}};Es=zl;var $s="AI_TooManyEmbeddingValuesForCallError",As=`vercel.ai.error.${$s}`,Zl=Symbol.for(As),Os,jl=class extends de{constructor(e){super({name:$s,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[Os]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return de.hasMarker(e,As)}};Os=Zl;var Cs="AI_TypeValidationError",Ns=`vercel.ai.error.${Cs}`,Dl=Symbol.for(Ns),Ps,ql=class hn extends de{constructor({value:t,cause:r}){super({name:Cs,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${ds(r)}`,cause:r}),this[Ps]=!0,this.value=t}static isInstance(t){return de.hasMarker(t,Ns)}static wrap({value:t,cause:r}){return hn.isInstance(r)&&r.value===t?r:new hn({value:t,cause:r})}};Ps=Dl;var Wt=ql,Rs="AI_UnsupportedFunctionalityError",Ms=`vercel.ai.error.${Rs}`,Ul=Symbol.for(Ms),zs,rt=class extends de{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:Rs,message:t}),this[zs]=!0,this.functionality=e}static isInstance(e){return de.hasMarker(e,Ms)}};zs=Ul;class ha extends Error{constructor(t,r){super(t),this.name="ParseError",this.type=r.type,this.field=r.field,this.value=r.value,this.line=r.line}}function Hr(e){}function Fl(e){if(typeof e=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:t=Hr,onError:r=Hr,onRetry:n=Hr,onComment:a}=e;let o="",s=!0,i,l="",u="";function d(y){const _=s?y.replace(/^\xEF\xBB\xBF/,""):y,[b,I]=Ll(`${o}${_}`);for(const v of b)m(v);o=I,s=!1}function m(y){if(y===""){h();return}if(y.startsWith(":")){a&&a(y.slice(y.startsWith(": ")?2:1));return}const _=y.indexOf(":");if(_!==-1){const b=y.slice(0,_),I=y[_+1]===" "?2:1,v=y.slice(_+I);p(b,v,y);return}p(y,"",y)}function p(y,_,b){switch(y){case"event":u=_;break;case"data":l=`${l}${_}
`;break;case"id":i=_.includes("\0")?void 0:_;break;case"retry":/^\d+$/.test(_)?n(parseInt(_,10)):r(new ha(`Invalid \`retry\` value: "${_}"`,{type:"invalid-retry",value:_,line:b}));break;default:r(new ha(`Unknown field "${y.length>20?`${y.slice(0,20)}â€¦`:y}"`,{type:"unknown-field",field:y,value:_,line:b}));break}}function h(){l.length>0&&t({id:i,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),i=void 0,l="",u=""}function f(y={}){o&&y.consume&&m(o),s=!0,i=void 0,l="",u="",o=""}return{feed:d,reset:f}}function Ll(e){const t=[];let r="",n=0;for(;n<e.length;){const a=e.indexOf("\r",n),o=e.indexOf(`
`,n);let s=-1;if(a!==-1&&o!==-1?s=Math.min(a,o):a!==-1?a===e.length-1?s=-1:s=a:o!==-1&&(s=o),s===-1){r=e.slice(n);break}else{const i=e.slice(n,s);t.push(i),n=s+1,e[n-1]==="\r"&&e[n]===`
`&&n++}}return[t,r]}class Zs extends TransformStream{constructor({onError:t,onRetry:r,onComment:n}={}){let a;super({start(o){a=Fl({onEvent:s=>{o.enqueue(s)},onError(s){t==="terminate"?o.error(s):typeof t=="function"&&t(s)},onRetry:r,onComment:n})},transform(o){a.feed(o)}})}}function k(e,t,r){function n(i,l){var u;Object.defineProperty(i,"_zod",{value:i._zod??{},enumerable:!1}),(u=i._zod).traits??(u.traits=new Set),i._zod.traits.add(e),t(i,l);for(const d in s.prototype)d in i||Object.defineProperty(i,d,{value:s.prototype[d].bind(i)});i._zod.constr=s,i._zod.def=l}const a=r?.Parent??Object;class o extends a{}Object.defineProperty(o,"name",{value:e});function s(i){var l;const u=r?.Parent?new o:this;n(u,i),(l=u._zod).deferred??(l.deferred=[]);for(const d of u._zod.deferred)d();return u}return Object.defineProperty(s,"init",{value:n}),Object.defineProperty(s,Symbol.hasInstance,{value:i=>r?.Parent&&i instanceof r.Parent?!0:i?._zod?.traits?.has(e)}),Object.defineProperty(s,"name",{value:e}),s}class Ct extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}class js extends Error{constructor(t){super(`Encountered unidirectional transform during encode: ${t}`),this.name="ZodEncodeError"}}const Ds={};function it(e){return Ds}function qs(e){const t=Object.values(e).filter(n=>typeof n=="number");return Object.entries(e).filter(([n,a])=>t.indexOf(+n)===-1).map(([n,a])=>a)}function gn(e,t){return typeof t=="bigint"?t.toString():t}function Rr(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function Rn(e){return e==null}function Mn(e){const t=e.startsWith("^")?1:0,r=e.endsWith("$")?e.length-1:e.length;return e.slice(t,r)}function Vl(e,t){const r=(e.toString().split(".")[1]||"").length,n=t.toString();let a=(n.split(".")[1]||"").length;if(a===0&&/\d?e-\d?/.test(n)){const l=n.match(/\d?e-(\d?)/);l?.[1]&&(a=Number.parseInt(l[1]))}const o=r>a?r:a,s=Number.parseInt(e.toFixed(o).replace(".","")),i=Number.parseInt(t.toFixed(o).replace(".",""));return s%i/10**o}const ga=Symbol("evaluating");function L(e,t,r){let n;Object.defineProperty(e,t,{get(){if(n!==ga)return n===void 0&&(n=ga,n=r()),n},set(a){Object.defineProperty(e,t,{value:a})},configurable:!0})}function gt(e,t,r){Object.defineProperty(e,t,{value:r,writable:!0,enumerable:!0,configurable:!0})}function vt(...e){const t={};for(const r of e){const n=Object.getOwnPropertyDescriptors(r);Object.assign(t,n)}return Object.defineProperties({},t)}function va(e){return JSON.stringify(e)}const Us="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function Ht(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}const Bl=Rr(()=>{if(typeof navigator<"u"&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{const e=Function;return new e(""),!0}catch{return!1}});function Pt(e){if(Ht(e)===!1)return!1;const t=e.constructor;if(t===void 0)return!0;const r=t.prototype;return!(Ht(r)===!1||Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")===!1)}function Fs(e){return Pt(e)?{...e}:Array.isArray(e)?[...e]:e}const Jl=new Set(["string","number","symbol"]);function Rt(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function pt(e,t,r){const n=new e._zod.constr(t??e._zod.def);return(!t||r?.parent)&&(n._zod.parent=e),n}function N(e){const t=e;if(!t)return{};if(typeof t=="string")return{error:()=>t};if(t?.message!==void 0){if(t?.error!==void 0)throw new Error("Cannot specify both `message` and `error` params");t.error=t.message}return delete t.message,typeof t.error=="string"?{...t,error:()=>t.error}:t}function Gl(e){return Object.keys(e).filter(t=>e[t]._zod.optin==="optional"&&e[t]._zod.optout==="optional")}const Wl={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function Hl(e,t){const r=e._zod.def,n=vt(e._zod.def,{get shape(){const a={};for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&(a[o]=r.shape[o])}return gt(this,"shape",a),a},checks:[]});return pt(e,n)}function Kl(e,t){const r=e._zod.def,n=vt(e._zod.def,{get shape(){const a={...e._zod.def.shape};for(const o in t){if(!(o in r.shape))throw new Error(`Unrecognized key: "${o}"`);t[o]&&delete a[o]}return gt(this,"shape",a),a},checks:[]});return pt(e,n)}function Yl(e,t){if(!Pt(t))throw new Error("Invalid input to extend: expected a plain object");const r=e._zod.def.checks;if(r&&r.length>0)throw new Error("Object schemas containing refinements cannot be extended. Use `.safeExtend()` instead.");const a=vt(e._zod.def,{get shape(){const o={...e._zod.def.shape,...t};return gt(this,"shape",o),o},checks:[]});return pt(e,a)}function Xl(e,t){if(!Pt(t))throw new Error("Invalid input to safeExtend: expected a plain object");const r={...e._zod.def,get shape(){const n={...e._zod.def.shape,...t};return gt(this,"shape",n),n},checks:e._zod.def.checks};return pt(e,r)}function Ql(e,t){const r=vt(e._zod.def,{get shape(){const n={...e._zod.def.shape,...t._zod.def.shape};return gt(this,"shape",n),n},get catchall(){return t._zod.def.catchall},checks:[]});return pt(e,r)}function ec(e,t,r){const n=vt(t._zod.def,{get shape(){const a=t._zod.def.shape,o={...a};if(r)for(const s in r){if(!(s in a))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=e?new e({type:"optional",innerType:a[s]}):a[s])}else for(const s in a)o[s]=e?new e({type:"optional",innerType:a[s]}):a[s];return gt(this,"shape",o),o},checks:[]});return pt(t,n)}function tc(e,t,r){const n=vt(t._zod.def,{get shape(){const a=t._zod.def.shape,o={...a};if(r)for(const s in r){if(!(s in o))throw new Error(`Unrecognized key: "${s}"`);r[s]&&(o[s]=new e({type:"nonoptional",innerType:a[s]}))}else for(const s in a)o[s]=new e({type:"nonoptional",innerType:a[s]});return gt(this,"shape",o),o},checks:[]});return pt(t,n)}function Tt(e,t=0){if(e.aborted===!0)return!0;for(let r=t;r<e.issues.length;r++)if(e.issues[r]?.continue!==!0)return!0;return!1}function Et(e,t){return t.map(r=>{var n;return(n=r).path??(n.path=[]),r.path.unshift(e),r})}function vr(e){return typeof e=="string"?e:e?.message}function ut(e,t,r){const n={...e,path:e.path??[]};if(!e.message){const a=vr(e.inst?._zod.def?.error?.(e))??vr(t?.error?.(e))??vr(r.customError?.(e))??vr(r.localeError?.(e))??"Invalid input";n.message=a}return delete n.inst,delete n.continue,t?.reportInput||delete n.input,n}function zn(e){return Array.isArray(e)?"array":typeof e=="string"?"string":"unknown"}function Kt(...e){const[t,r,n]=e;return typeof t=="string"?{message:t,code:"custom",input:r,inst:n}:{...t}}const Ls=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,gn,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Vs=k("$ZodError",Ls),Bs=k("$ZodError",Ls,{Parent:Error});function rc(e,t=r=>r.message){const r={},n=[];for(const a of e.issues)a.path.length>0?(r[a.path[0]]=r[a.path[0]]||[],r[a.path[0]].push(t(a))):n.push(t(a));return{formErrors:n,fieldErrors:r}}function nc(e,t=r=>r.message){const r={_errors:[]},n=a=>{for(const o of a.issues)if(o.code==="invalid_union"&&o.errors.length)o.errors.map(s=>n({issues:s}));else if(o.code==="invalid_key")n({issues:o.issues});else if(o.code==="invalid_element")n({issues:o.issues});else if(o.path.length===0)r._errors.push(t(o));else{let s=r,i=0;for(;i<o.path.length;){const l=o.path[i];i===o.path.length-1?(s[l]=s[l]||{_errors:[]},s[l]._errors.push(t(o))):s[l]=s[l]||{_errors:[]},s=s[l],i++}}};return n(e),r}const Zn=e=>(t,r,n,a)=>{const o=n?Object.assign(n,{async:!1}):{async:!1},s=t._zod.run({value:r,issues:[]},o);if(s instanceof Promise)throw new Ct;if(s.issues.length){const i=new(a?.Err??e)(s.issues.map(l=>ut(l,o,it())));throw Us(i,a?.callee),i}return s.value},jn=e=>async(t,r,n,a)=>{const o=n?Object.assign(n,{async:!0}):{async:!0};let s=t._zod.run({value:r,issues:[]},o);if(s instanceof Promise&&(s=await s),s.issues.length){const i=new(a?.Err??e)(s.issues.map(l=>ut(l,o,it())));throw Us(i,a?.callee),i}return s.value},Mr=e=>(t,r,n)=>{const a=n?{...n,async:!1}:{async:!1},o=t._zod.run({value:r,issues:[]},a);if(o instanceof Promise)throw new Ct;return o.issues.length?{success:!1,error:new(e??Vs)(o.issues.map(s=>ut(s,a,it())))}:{success:!0,data:o.value}},ac=Mr(Bs),zr=e=>async(t,r,n)=>{const a=n?Object.assign(n,{async:!0}):{async:!0};let o=t._zod.run({value:r,issues:[]},a);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new e(o.issues.map(s=>ut(s,a,it())))}:{success:!0,data:o.value}},oc=zr(Bs),sc=e=>(t,r,n)=>{const a=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Zn(e)(t,r,a)},ic=e=>(t,r,n)=>Zn(e)(t,r,n),uc=e=>async(t,r,n)=>{const a=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return jn(e)(t,r,a)},lc=e=>async(t,r,n)=>jn(e)(t,r,n),cc=e=>(t,r,n)=>{const a=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return Mr(e)(t,r,a)},dc=e=>(t,r,n)=>Mr(e)(t,r,n),pc=e=>async(t,r,n)=>{const a=n?Object.assign(n,{direction:"backward"}):{direction:"backward"};return zr(e)(t,r,a)},fc=e=>async(t,r,n)=>zr(e)(t,r,n),mc=/^[cC][^\s-]{8,}$/,hc=/^[0-9a-z]+$/,gc=/^[0-9A-HJKMNP-TV-Za-hjkmnp-tv-z]{26}$/,vc=/^[0-9a-vA-V]{20}$/,yc=/^[A-Za-z0-9]{27}$/,_c=/^[a-zA-Z0-9_-]{21}$/,bc=/^P(?:(\d+W)|(?!.*W)(?=\d|T\d)(\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+([.,]\d+)?S)?)?)$/,wc=/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})$/,ya=e=>e?new RegExp(`^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-${e}[0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12})$`):/^([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[1-8][0-9a-fA-F]{3}-[89abAB][0-9a-fA-F]{3}-[0-9a-fA-F]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/,Ic=/^(?!\.)(?!.*\.\.)([A-Za-z0-9_'+\-\.]*)[A-Za-z0-9_+-]@([A-Za-z0-9][A-Za-z0-9\-]*\.)+[A-Za-z]{2,}$/,kc="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";function xc(){return new RegExp(kc,"u")}const Sc=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Tc=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:))$/,Ec=/^((25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/([0-9]|[1-2][0-9]|3[0-2])$/,$c=/^(([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|::|([0-9a-fA-F]{1,4})?::([0-9a-fA-F]{1,4}:?){0,6})\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ac=/^$|^(?:[0-9a-zA-Z+/]{4})*(?:(?:[0-9a-zA-Z+/]{2}==)|(?:[0-9a-zA-Z+/]{3}=))?$/,Js=/^[A-Za-z0-9_-]*$/,Oc=/^(?=.{1,253}\.?$)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?)*\.?$/,Cc=/^\+(?:[0-9]){6,14}[0-9]$/,Gs="(?:(?:\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-(?:(?:0[13578]|1[02])-(?:0[1-9]|[12]\\d|3[01])|(?:0[469]|11)-(?:0[1-9]|[12]\\d|30)|(?:02)-(?:0[1-9]|1\\d|2[0-8])))",Nc=new RegExp(`^${Gs}$`);function Ws(e){const t="(?:[01]\\d|2[0-3]):[0-5]\\d";return typeof e.precision=="number"?e.precision===-1?`${t}`:e.precision===0?`${t}:[0-5]\\d`:`${t}:[0-5]\\d\\.\\d{${e.precision}}`:`${t}(?::[0-5]\\d(?:\\.\\d+)?)?`}function Pc(e){return new RegExp(`^${Ws(e)}$`)}function Rc(e){const t=Ws({precision:e.precision}),r=["Z"];e.local&&r.push(""),e.offset&&r.push("([+-](?:[01]\\d|2[0-3]):[0-5]\\d)");const n=`${t}(?:${r.join("|")})`;return new RegExp(`^${Gs}T(?:${n})$`)}const Mc=e=>{const t=e?`[\\s\\S]{${e?.minimum??0},${e?.maximum??""}}`:"[\\s\\S]*";return new RegExp(`^${t}$`)},zc=/^-?\d+$/,Zc=/^-?\d+(?:\.\d+)?/,jc=/^(?:true|false)$/i,Dc=/^null$/i,qc=/^[^A-Z]*$/,Uc=/^[^a-z]*$/,$e=k("$ZodCheck",(e,t)=>{var r;e._zod??(e._zod={}),e._zod.def=t,(r=e._zod).onattach??(r.onattach=[])}),Hs={number:"number",bigint:"bigint",object:"date"},Ks=k("$ZodCheckLessThan",(e,t)=>{$e.init(e,t);const r=Hs[typeof t.value];e._zod.onattach.push(n=>{const a=n._zod.bag,o=(t.inclusive?a.maximum:a.exclusiveMaximum)??Number.POSITIVE_INFINITY;t.value<o&&(t.inclusive?a.maximum=t.value:a.exclusiveMaximum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value<=t.value:n.value<t.value)||n.issues.push({origin:r,code:"too_big",maximum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Ys=k("$ZodCheckGreaterThan",(e,t)=>{$e.init(e,t);const r=Hs[typeof t.value];e._zod.onattach.push(n=>{const a=n._zod.bag,o=(t.inclusive?a.minimum:a.exclusiveMinimum)??Number.NEGATIVE_INFINITY;t.value>o&&(t.inclusive?a.minimum=t.value:a.exclusiveMinimum=t.value)}),e._zod.check=n=>{(t.inclusive?n.value>=t.value:n.value>t.value)||n.issues.push({origin:r,code:"too_small",minimum:t.value,input:n.value,inclusive:t.inclusive,inst:e,continue:!t.abort})}}),Fc=k("$ZodCheckMultipleOf",(e,t)=>{$e.init(e,t),e._zod.onattach.push(r=>{var n;(n=r._zod.bag).multipleOf??(n.multipleOf=t.value)}),e._zod.check=r=>{if(typeof r.value!=typeof t.value)throw new Error("Cannot mix number and bigint in multiple_of check.");(typeof r.value=="bigint"?r.value%t.value===BigInt(0):Vl(r.value,t.value)===0)||r.issues.push({origin:typeof r.value,code:"not_multiple_of",divisor:t.value,input:r.value,inst:e,continue:!t.abort})}}),Lc=k("$ZodCheckNumberFormat",(e,t)=>{$e.init(e,t),t.format=t.format||"float64";const r=t.format?.includes("int"),n=r?"int":"number",[a,o]=Wl[t.format];e._zod.onattach.push(s=>{const i=s._zod.bag;i.format=t.format,i.minimum=a,i.maximum=o,r&&(i.pattern=zc)}),e._zod.check=s=>{const i=s.value;if(r){if(!Number.isInteger(i)){s.issues.push({expected:n,format:t.format,code:"invalid_type",continue:!1,input:i,inst:e});return}if(!Number.isSafeInteger(i)){i>0?s.issues.push({input:i,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort}):s.issues.push({input:i,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:n,continue:!t.abort});return}}i<a&&s.issues.push({origin:"number",input:i,code:"too_small",minimum:a,inclusive:!0,inst:e,continue:!t.abort}),i>o&&s.issues.push({origin:"number",input:i,code:"too_big",maximum:o,inst:e})}}),Vc=k("$ZodCheckMaxLength",(e,t)=>{var r;$e.init(e,t),(r=e._zod.def).when??(r.when=n=>{const a=n.value;return!Rn(a)&&a.length!==void 0}),e._zod.onattach.push(n=>{const a=n._zod.bag.maximum??Number.POSITIVE_INFINITY;t.maximum<a&&(n._zod.bag.maximum=t.maximum)}),e._zod.check=n=>{const a=n.value;if(a.length<=t.maximum)return;const s=zn(a);n.issues.push({origin:s,code:"too_big",maximum:t.maximum,inclusive:!0,input:a,inst:e,continue:!t.abort})}}),Bc=k("$ZodCheckMinLength",(e,t)=>{var r;$e.init(e,t),(r=e._zod.def).when??(r.when=n=>{const a=n.value;return!Rn(a)&&a.length!==void 0}),e._zod.onattach.push(n=>{const a=n._zod.bag.minimum??Number.NEGATIVE_INFINITY;t.minimum>a&&(n._zod.bag.minimum=t.minimum)}),e._zod.check=n=>{const a=n.value;if(a.length>=t.minimum)return;const s=zn(a);n.issues.push({origin:s,code:"too_small",minimum:t.minimum,inclusive:!0,input:a,inst:e,continue:!t.abort})}}),Jc=k("$ZodCheckLengthEquals",(e,t)=>{var r;$e.init(e,t),(r=e._zod.def).when??(r.when=n=>{const a=n.value;return!Rn(a)&&a.length!==void 0}),e._zod.onattach.push(n=>{const a=n._zod.bag;a.minimum=t.length,a.maximum=t.length,a.length=t.length}),e._zod.check=n=>{const a=n.value,o=a.length;if(o===t.length)return;const s=zn(a),i=o>t.length;n.issues.push({origin:s,...i?{code:"too_big",maximum:t.length}:{code:"too_small",minimum:t.length},inclusive:!0,exact:!0,input:n.value,inst:e,continue:!t.abort})}}),Zr=k("$ZodCheckStringFormat",(e,t)=>{var r,n;$e.init(e,t),e._zod.onattach.push(a=>{const o=a._zod.bag;o.format=t.format,t.pattern&&(o.patterns??(o.patterns=new Set),o.patterns.add(t.pattern))}),t.pattern?(r=e._zod).check??(r.check=a=>{t.pattern.lastIndex=0,!t.pattern.test(a.value)&&a.issues.push({origin:"string",code:"invalid_format",format:t.format,input:a.value,...t.pattern?{pattern:t.pattern.toString()}:{},inst:e,continue:!t.abort})}):(n=e._zod).check??(n.check=()=>{})}),Gc=k("$ZodCheckRegex",(e,t)=>{Zr.init(e,t),e._zod.check=r=>{t.pattern.lastIndex=0,!t.pattern.test(r.value)&&r.issues.push({origin:"string",code:"invalid_format",format:"regex",input:r.value,pattern:t.pattern.toString(),inst:e,continue:!t.abort})}}),Wc=k("$ZodCheckLowerCase",(e,t)=>{t.pattern??(t.pattern=qc),Zr.init(e,t)}),Hc=k("$ZodCheckUpperCase",(e,t)=>{t.pattern??(t.pattern=Uc),Zr.init(e,t)}),Kc=k("$ZodCheckIncludes",(e,t)=>{$e.init(e,t);const r=Rt(t.includes),n=new RegExp(typeof t.position=="number"?`^.{${t.position}}${r}`:r);t.pattern=n,e._zod.onattach.push(a=>{const o=a._zod.bag;o.patterns??(o.patterns=new Set),o.patterns.add(n)}),e._zod.check=a=>{a.value.includes(t.includes,t.position)||a.issues.push({origin:"string",code:"invalid_format",format:"includes",includes:t.includes,input:a.value,inst:e,continue:!t.abort})}}),Yc=k("$ZodCheckStartsWith",(e,t)=>{$e.init(e,t);const r=new RegExp(`^${Rt(t.prefix)}.*`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const a=n._zod.bag;a.patterns??(a.patterns=new Set),a.patterns.add(r)}),e._zod.check=n=>{n.value.startsWith(t.prefix)||n.issues.push({origin:"string",code:"invalid_format",format:"starts_with",prefix:t.prefix,input:n.value,inst:e,continue:!t.abort})}}),Xc=k("$ZodCheckEndsWith",(e,t)=>{$e.init(e,t);const r=new RegExp(`.*${Rt(t.suffix)}$`);t.pattern??(t.pattern=r),e._zod.onattach.push(n=>{const a=n._zod.bag;a.patterns??(a.patterns=new Set),a.patterns.add(r)}),e._zod.check=n=>{n.value.endsWith(t.suffix)||n.issues.push({origin:"string",code:"invalid_format",format:"ends_with",suffix:t.suffix,input:n.value,inst:e,continue:!t.abort})}}),Qc=k("$ZodCheckOverwrite",(e,t)=>{$e.init(e,t),e._zod.check=r=>{r.value=t.tx(r.value)}});class ed{constructor(t=[]){this.content=[],this.indent=0,this&&(this.args=t)}indented(t){this.indent+=1,t(this),this.indent-=1}write(t){if(typeof t=="function"){t(this,{execution:"sync"}),t(this,{execution:"async"});return}const n=t.split(`
`).filter(s=>s),a=Math.min(...n.map(s=>s.length-s.trimStart().length)),o=n.map(s=>s.slice(a)).map(s=>" ".repeat(this.indent*2)+s);for(const s of o)this.content.push(s)}compile(){const t=Function,r=this?.args,a=[...(this?.content??[""]).map(o=>`  ${o}`)];return new t(...r,a.join(`
`))}}const td={major:4,minor:1,patch:12},H=k("$ZodType",(e,t)=>{var r;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=td;const n=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&n.unshift(e);for(const a of n)for(const o of a._zod.onattach)o(e);if(n.length===0)(r=e._zod).deferred??(r.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const a=(s,i,l)=>{let u=Tt(s),d;for(const m of i){if(m._zod.def.when){if(!m._zod.def.when(s))continue}else if(u)continue;const p=s.issues.length,h=m._zod.check(s);if(h instanceof Promise&&l?.async===!1)throw new Ct;if(d||h instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await h,s.issues.length!==p&&(u||(u=Tt(s,p)))});else{if(s.issues.length===p)continue;u||(u=Tt(s,p))}}return d?d.then(()=>s):s},o=(s,i,l)=>{if(Tt(s))return s.aborted=!0,s;const u=a(i,n,l);if(u instanceof Promise){if(l.async===!1)throw new Ct;return u.then(d=>e._zod.parse(d,l))}return e._zod.parse(u,l)};e._zod.run=(s,i)=>{if(i.skipChecks)return e._zod.parse(s,i);if(i.direction==="backward"){const u=e._zod.parse({value:s.value,issues:[]},{...i,skipChecks:!0});return u instanceof Promise?u.then(d=>o(d,s,i)):o(u,s,i)}const l=e._zod.parse(s,i);if(l instanceof Promise){if(i.async===!1)throw new Ct;return l.then(u=>a(u,n,i))}return a(l,n,i)}}e["~standard"]={validate:a=>{try{const o=ac(e,a);return o.success?{value:o.data}:{issues:o.error?.issues}}catch{return oc(e,a).then(s=>s.success?{value:s.data}:{issues:s.error?.issues})}},vendor:"zod",version:1}}),Dn=k("$ZodString",(e,t)=>{H.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??Mc(e._zod.bag),e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=String(r.value)}catch{}return typeof r.value=="string"||r.issues.push({expected:"string",code:"invalid_type",input:r.value,inst:e}),r}}),te=k("$ZodStringFormat",(e,t)=>{Zr.init(e,t),Dn.init(e,t)}),rd=k("$ZodGUID",(e,t)=>{t.pattern??(t.pattern=wc),te.init(e,t)}),nd=k("$ZodUUID",(e,t)=>{if(t.version){const n={v1:1,v2:2,v3:3,v4:4,v5:5,v6:6,v7:7,v8:8}[t.version];if(n===void 0)throw new Error(`Invalid UUID version: "${t.version}"`);t.pattern??(t.pattern=ya(n))}else t.pattern??(t.pattern=ya());te.init(e,t)}),ad=k("$ZodEmail",(e,t)=>{t.pattern??(t.pattern=Ic),te.init(e,t)}),od=k("$ZodURL",(e,t)=>{te.init(e,t),e._zod.check=r=>{try{const n=r.value.trim(),a=new URL(n);t.hostname&&(t.hostname.lastIndex=0,t.hostname.test(a.hostname)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid hostname",pattern:Oc.source,input:r.value,inst:e,continue:!t.abort})),t.protocol&&(t.protocol.lastIndex=0,t.protocol.test(a.protocol.endsWith(":")?a.protocol.slice(0,-1):a.protocol)||r.issues.push({code:"invalid_format",format:"url",note:"Invalid protocol",pattern:t.protocol.source,input:r.value,inst:e,continue:!t.abort})),t.normalize?r.value=a.href:r.value=n;return}catch{r.issues.push({code:"invalid_format",format:"url",input:r.value,inst:e,continue:!t.abort})}}}),sd=k("$ZodEmoji",(e,t)=>{t.pattern??(t.pattern=xc()),te.init(e,t)}),id=k("$ZodNanoID",(e,t)=>{t.pattern??(t.pattern=_c),te.init(e,t)}),ud=k("$ZodCUID",(e,t)=>{t.pattern??(t.pattern=mc),te.init(e,t)}),ld=k("$ZodCUID2",(e,t)=>{t.pattern??(t.pattern=hc),te.init(e,t)}),cd=k("$ZodULID",(e,t)=>{t.pattern??(t.pattern=gc),te.init(e,t)}),dd=k("$ZodXID",(e,t)=>{t.pattern??(t.pattern=vc),te.init(e,t)}),pd=k("$ZodKSUID",(e,t)=>{t.pattern??(t.pattern=yc),te.init(e,t)}),fd=k("$ZodISODateTime",(e,t)=>{t.pattern??(t.pattern=Rc(t)),te.init(e,t)}),md=k("$ZodISODate",(e,t)=>{t.pattern??(t.pattern=Nc),te.init(e,t)}),hd=k("$ZodISOTime",(e,t)=>{t.pattern??(t.pattern=Pc(t)),te.init(e,t)}),gd=k("$ZodISODuration",(e,t)=>{t.pattern??(t.pattern=bc),te.init(e,t)}),vd=k("$ZodIPv4",(e,t)=>{t.pattern??(t.pattern=Sc),te.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv4"})}),yd=k("$ZodIPv6",(e,t)=>{t.pattern??(t.pattern=Tc),te.init(e,t),e._zod.onattach.push(r=>{const n=r._zod.bag;n.format="ipv6"}),e._zod.check=r=>{try{new URL(`http://[${r.value}]`)}catch{r.issues.push({code:"invalid_format",format:"ipv6",input:r.value,inst:e,continue:!t.abort})}}}),_d=k("$ZodCIDRv4",(e,t)=>{t.pattern??(t.pattern=Ec),te.init(e,t)}),bd=k("$ZodCIDRv6",(e,t)=>{t.pattern??(t.pattern=$c),te.init(e,t),e._zod.check=r=>{const n=r.value.split("/");try{if(n.length!==2)throw new Error;const[a,o]=n;if(!o)throw new Error;const s=Number(o);if(`${s}`!==o)throw new Error;if(s<0||s>128)throw new Error;new URL(`http://[${a}]`)}catch{r.issues.push({code:"invalid_format",format:"cidrv6",input:r.value,inst:e,continue:!t.abort})}}});function Xs(e){if(e==="")return!0;if(e.length%4!==0)return!1;try{return atob(e),!0}catch{return!1}}const wd=k("$ZodBase64",(e,t)=>{t.pattern??(t.pattern=Ac),te.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64"}),e._zod.check=r=>{Xs(r.value)||r.issues.push({code:"invalid_format",format:"base64",input:r.value,inst:e,continue:!t.abort})}});function Id(e){if(!Js.test(e))return!1;const t=e.replace(/[-_]/g,n=>n==="-"?"+":"/"),r=t.padEnd(Math.ceil(t.length/4)*4,"=");return Xs(r)}const kd=k("$ZodBase64URL",(e,t)=>{t.pattern??(t.pattern=Js),te.init(e,t),e._zod.onattach.push(r=>{r._zod.bag.contentEncoding="base64url"}),e._zod.check=r=>{Id(r.value)||r.issues.push({code:"invalid_format",format:"base64url",input:r.value,inst:e,continue:!t.abort})}}),xd=k("$ZodE164",(e,t)=>{t.pattern??(t.pattern=Cc),te.init(e,t)});function Sd(e,t=null){try{const r=e.split(".");if(r.length!==3)return!1;const[n]=r;if(!n)return!1;const a=JSON.parse(atob(n));return!("typ"in a&&a?.typ!=="JWT"||!a.alg||t&&(!("alg"in a)||a.alg!==t))}catch{return!1}}const Td=k("$ZodJWT",(e,t)=>{te.init(e,t),e._zod.check=r=>{Sd(r.value,t.alg)||r.issues.push({code:"invalid_format",format:"jwt",input:r.value,inst:e,continue:!t.abort})}}),Qs=k("$ZodNumber",(e,t)=>{H.init(e,t),e._zod.pattern=e._zod.bag.pattern??Zc,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=Number(r.value)}catch{}const a=r.value;if(typeof a=="number"&&!Number.isNaN(a)&&Number.isFinite(a))return r;const o=typeof a=="number"?Number.isNaN(a)?"NaN":Number.isFinite(a)?void 0:"Infinity":void 0;return r.issues.push({expected:"number",code:"invalid_type",input:a,inst:e,...o?{received:o}:{}}),r}}),Ed=k("$ZodNumber",(e,t)=>{Lc.init(e,t),Qs.init(e,t)}),$d=k("$ZodBoolean",(e,t)=>{H.init(e,t),e._zod.pattern=jc,e._zod.parse=(r,n)=>{if(t.coerce)try{r.value=!!r.value}catch{}const a=r.value;return typeof a=="boolean"||r.issues.push({expected:"boolean",code:"invalid_type",input:a,inst:e}),r}}),Ad=k("$ZodNull",(e,t)=>{H.init(e,t),e._zod.pattern=Dc,e._zod.values=new Set([null]),e._zod.parse=(r,n)=>{const a=r.value;return a===null||r.issues.push({expected:"null",code:"invalid_type",input:a,inst:e}),r}}),Od=k("$ZodAny",(e,t)=>{H.init(e,t),e._zod.parse=r=>r}),Cd=k("$ZodUnknown",(e,t)=>{H.init(e,t),e._zod.parse=r=>r}),Nd=k("$ZodNever",(e,t)=>{H.init(e,t),e._zod.parse=(r,n)=>(r.issues.push({expected:"never",code:"invalid_type",input:r.value,inst:e}),r)});function _a(e,t,r){e.issues.length&&t.issues.push(...Et(r,e.issues)),t.value[r]=e.value}const Pd=k("$ZodArray",(e,t)=>{H.init(e,t),e._zod.parse=(r,n)=>{const a=r.value;if(!Array.isArray(a))return r.issues.push({expected:"array",code:"invalid_type",input:a,inst:e}),r;r.value=Array(a.length);const o=[];for(let s=0;s<a.length;s++){const i=a[s],l=t.element._zod.run({value:i,issues:[]},n);l instanceof Promise?o.push(l.then(u=>_a(u,r,s))):_a(l,r,s)}return o.length?Promise.all(o).then(()=>r):r}});function Sr(e,t,r,n){e.issues.length&&t.issues.push(...Et(r,e.issues)),e.value===void 0?r in n&&(t.value[r]=void 0):t.value[r]=e.value}function ei(e){const t=Object.keys(e.shape);for(const n of t)if(!e.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);const r=Gl(e.shape);return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(r)}}function ti(e,t,r,n,a,o){const s=[],i=a.keySet,l=a.catchall._zod,u=l.def.type;for(const d of Object.keys(t)){if(i.has(d))continue;if(u==="never"){s.push(d);continue}const m=l.run({value:t[d],issues:[]},n);m instanceof Promise?e.push(m.then(p=>Sr(p,r,d,t))):Sr(m,r,d,t)}return s.length&&r.issues.push({code:"unrecognized_keys",keys:s,input:t,inst:o}),e.length?Promise.all(e).then(()=>r):r}const Rd=k("$ZodObject",(e,t)=>{if(H.init(e,t),!Object.getOwnPropertyDescriptor(t,"shape")?.get){const i=t.shape;Object.defineProperty(t,"shape",{get:()=>{const l={...i};return Object.defineProperty(t,"shape",{value:l}),l}})}const n=Rr(()=>ei(t));L(e._zod,"propValues",()=>{const i=t.shape,l={};for(const u in i){const d=i[u]._zod;if(d.values){l[u]??(l[u]=new Set);for(const m of d.values)l[u].add(m)}}return l});const a=Ht,o=t.catchall;let s;e._zod.parse=(i,l)=>{s??(s=n.value);const u=i.value;if(!a(u))return i.issues.push({expected:"object",code:"invalid_type",input:u,inst:e}),i;i.value={};const d=[],m=s.shape;for(const p of s.keys){const f=m[p]._zod.run({value:u[p],issues:[]},l);f instanceof Promise?d.push(f.then(y=>Sr(y,i,p,u))):Sr(f,i,p,u)}return o?ti(d,u,i,l,n.value,e):d.length?Promise.all(d).then(()=>i):i}}),Md=k("$ZodObjectJIT",(e,t)=>{Rd.init(e,t);const r=e._zod.parse,n=Rr(()=>ei(t)),a=p=>{const h=new ed(["shape","payload","ctx"]),f=n.value,y=v=>{const A=va(v);return`shape[${A}]._zod.run({ value: input[${A}], issues: [] }, ctx)`};h.write("const input = payload.value;");const _=Object.create(null);let b=0;for(const v of f.keys)_[v]=`key_${b++}`;h.write("const newResult = {};");for(const v of f.keys){const A=_[v],$=va(v);h.write(`const ${A} = ${y(v)};`),h.write(`
        if (${A}.issues.length) {
          payload.issues = payload.issues.concat(${A}.issues.map(iss => ({
            ...iss,
            path: iss.path ? [${$}, ...iss.path] : [${$}]
          })));
        }
        
        
        if (${A}.value === undefined) {
          if (${$} in input) {
            newResult[${$}] = undefined;
          }
        } else {
          newResult[${$}] = ${A}.value;
        }
        
      `)}h.write("payload.value = newResult;"),h.write("return payload;");const I=h.compile();return(v,A)=>I(p,v,A)};let o;const s=Ht,i=!Ds.jitless,u=i&&Bl.value,d=t.catchall;let m;e._zod.parse=(p,h)=>{m??(m=n.value);const f=p.value;return s(f)?i&&u&&h?.async===!1&&h.jitless!==!0?(o||(o=a(t.shape)),p=o(p,h),d?ti([],f,p,h,m,e):p):r(p,h):(p.issues.push({expected:"object",code:"invalid_type",input:f,inst:e}),p)}});function ba(e,t,r,n){for(const o of e)if(o.issues.length===0)return t.value=o.value,t;const a=e.filter(o=>!Tt(o));return a.length===1?(t.value=a[0].value,a[0]):(t.issues.push({code:"invalid_union",input:t.value,inst:r,errors:e.map(o=>o.issues.map(s=>ut(s,n,it())))}),t)}const ri=k("$ZodUnion",(e,t)=>{H.init(e,t),L(e._zod,"optin",()=>t.options.some(a=>a._zod.optin==="optional")?"optional":void 0),L(e._zod,"optout",()=>t.options.some(a=>a._zod.optout==="optional")?"optional":void 0),L(e._zod,"values",()=>{if(t.options.every(a=>a._zod.values))return new Set(t.options.flatMap(a=>Array.from(a._zod.values)))}),L(e._zod,"pattern",()=>{if(t.options.every(a=>a._zod.pattern)){const a=t.options.map(o=>o._zod.pattern);return new RegExp(`^(${a.map(o=>Mn(o.source)).join("|")})$`)}});const r=t.options.length===1,n=t.options[0]._zod.run;e._zod.parse=(a,o)=>{if(r)return n(a,o);let s=!1;const i=[];for(const l of t.options){const u=l._zod.run({value:a.value,issues:[]},o);if(u instanceof Promise)i.push(u),s=!0;else{if(u.issues.length===0)return u;i.push(u)}}return s?Promise.all(i).then(l=>ba(l,a,e,o)):ba(i,a,e,o)}}),zd=k("$ZodDiscriminatedUnion",(e,t)=>{ri.init(e,t);const r=e._zod.parse;L(e._zod,"propValues",()=>{const a={};for(const o of t.options){const s=o._zod.propValues;if(!s||Object.keys(s).length===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(o)}"`);for(const[i,l]of Object.entries(s)){a[i]||(a[i]=new Set);for(const u of l)a[i].add(u)}}return a});const n=Rr(()=>{const a=t.options,o=new Map;for(const s of a){const i=s._zod.propValues?.[t.discriminator];if(!i||i.size===0)throw new Error(`Invalid discriminated union option at index "${t.options.indexOf(s)}"`);for(const l of i){if(o.has(l))throw new Error(`Duplicate discriminator value "${String(l)}"`);o.set(l,s)}}return o});e._zod.parse=(a,o)=>{const s=a.value;if(!Ht(s))return a.issues.push({code:"invalid_type",expected:"object",input:s,inst:e}),a;const i=n.value.get(s?.[t.discriminator]);return i?i._zod.run(a,o):t.unionFallback?r(a,o):(a.issues.push({code:"invalid_union",errors:[],note:"No matching discriminator",discriminator:t.discriminator,input:s,path:[t.discriminator],inst:e}),a)}}),Zd=k("$ZodIntersection",(e,t)=>{H.init(e,t),e._zod.parse=(r,n)=>{const a=r.value,o=t.left._zod.run({value:a,issues:[]},n),s=t.right._zod.run({value:a,issues:[]},n);return o instanceof Promise||s instanceof Promise?Promise.all([o,s]).then(([l,u])=>wa(r,l,u)):wa(r,o,s)}});function vn(e,t){if(e===t)return{valid:!0,data:e};if(e instanceof Date&&t instanceof Date&&+e==+t)return{valid:!0,data:e};if(Pt(e)&&Pt(t)){const r=Object.keys(t),n=Object.keys(e).filter(o=>r.indexOf(o)!==-1),a={...e,...t};for(const o of n){const s=vn(e[o],t[o]);if(!s.valid)return{valid:!1,mergeErrorPath:[o,...s.mergeErrorPath]};a[o]=s.data}return{valid:!0,data:a}}if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return{valid:!1,mergeErrorPath:[]};const r=[];for(let n=0;n<e.length;n++){const a=e[n],o=t[n],s=vn(a,o);if(!s.valid)return{valid:!1,mergeErrorPath:[n,...s.mergeErrorPath]};r.push(s.data)}return{valid:!0,data:r}}return{valid:!1,mergeErrorPath:[]}}function wa(e,t,r){if(t.issues.length&&e.issues.push(...t.issues),r.issues.length&&e.issues.push(...r.issues),Tt(e))return e;const n=vn(t.value,r.value);if(!n.valid)throw new Error(`Unmergable intersection. Error path: ${JSON.stringify(n.mergeErrorPath)}`);return e.value=n.data,e}const jd=k("$ZodRecord",(e,t)=>{H.init(e,t),e._zod.parse=(r,n)=>{const a=r.value;if(!Pt(a))return r.issues.push({expected:"record",code:"invalid_type",input:a,inst:e}),r;const o=[];if(t.keyType._zod.values){const s=t.keyType._zod.values;r.value={};for(const l of s)if(typeof l=="string"||typeof l=="number"||typeof l=="symbol"){const u=t.valueType._zod.run({value:a[l],issues:[]},n);u instanceof Promise?o.push(u.then(d=>{d.issues.length&&r.issues.push(...Et(l,d.issues)),r.value[l]=d.value})):(u.issues.length&&r.issues.push(...Et(l,u.issues)),r.value[l]=u.value)}let i;for(const l in a)s.has(l)||(i=i??[],i.push(l));i&&i.length>0&&r.issues.push({code:"unrecognized_keys",input:a,inst:e,keys:i})}else{r.value={};for(const s of Reflect.ownKeys(a)){if(s==="__proto__")continue;const i=t.keyType._zod.run({value:s,issues:[]},n);if(i instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(i.issues.length){r.issues.push({code:"invalid_key",origin:"record",issues:i.issues.map(u=>ut(u,n,it())),input:s,path:[s],inst:e}),r.value[i.value]=i.value;continue}const l=t.valueType._zod.run({value:a[s],issues:[]},n);l instanceof Promise?o.push(l.then(u=>{u.issues.length&&r.issues.push(...Et(s,u.issues)),r.value[i.value]=u.value})):(l.issues.length&&r.issues.push(...Et(s,l.issues)),r.value[i.value]=l.value)}}return o.length?Promise.all(o).then(()=>r):r}}),Dd=k("$ZodEnum",(e,t)=>{H.init(e,t);const r=qs(t.entries),n=new Set(r);e._zod.values=n,e._zod.pattern=new RegExp(`^(${r.filter(a=>Jl.has(typeof a)).map(a=>typeof a=="string"?Rt(a):a.toString()).join("|")})$`),e._zod.parse=(a,o)=>{const s=a.value;return n.has(s)||a.issues.push({code:"invalid_value",values:r,input:s,inst:e}),a}}),qd=k("$ZodLiteral",(e,t)=>{if(H.init(e,t),t.values.length===0)throw new Error("Cannot create literal schema with no valid values");e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(r=>typeof r=="string"?Rt(r):r?Rt(r.toString()):String(r)).join("|")})$`),e._zod.parse=(r,n)=>{const a=r.value;return e._zod.values.has(a)||r.issues.push({code:"invalid_value",values:t.values,input:a,inst:e}),r}}),Ud=k("$ZodTransform",(e,t)=>{H.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new js(e.constructor.name);const a=t.transform(r.value,r);if(n.async)return(a instanceof Promise?a:Promise.resolve(a)).then(s=>(r.value=s,r));if(a instanceof Promise)throw new Ct;return r.value=a,r}});function Ia(e,t){return e.issues.length&&t===void 0?{issues:[],value:void 0}:e}const Fd=k("$ZodOptional",(e,t)=>{H.init(e,t),e._zod.optin="optional",e._zod.optout="optional",L(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),L(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${Mn(r.source)})?$`):void 0}),e._zod.parse=(r,n)=>{if(t.innerType._zod.optin==="optional"){const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(o=>Ia(o,r.value)):Ia(a,r.value)}return r.value===void 0?r:t.innerType._zod.run(r,n)}}),Ld=k("$ZodNullable",(e,t)=>{H.init(e,t),L(e._zod,"optin",()=>t.innerType._zod.optin),L(e._zod,"optout",()=>t.innerType._zod.optout),L(e._zod,"pattern",()=>{const r=t.innerType._zod.pattern;return r?new RegExp(`^(${Mn(r.source)}|null)$`):void 0}),L(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,null]):void 0),e._zod.parse=(r,n)=>r.value===null?r:t.innerType._zod.run(r,n)}),Vd=k("$ZodDefault",(e,t)=>{H.init(e,t),e._zod.optin="optional",L(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);if(r.value===void 0)return r.value=t.defaultValue,r;const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(o=>ka(o,t)):ka(a,t)}});function ka(e,t){return e.value===void 0&&(e.value=t.defaultValue),e}const Bd=k("$ZodPrefault",(e,t)=>{H.init(e,t),e._zod.optin="optional",L(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>(n.direction==="backward"||r.value===void 0&&(r.value=t.defaultValue),t.innerType._zod.run(r,n))}),Jd=k("$ZodNonOptional",(e,t)=>{H.init(e,t),L(e._zod,"values",()=>{const r=t.innerType._zod.values;return r?new Set([...r].filter(n=>n!==void 0)):void 0}),e._zod.parse=(r,n)=>{const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(o=>xa(o,e)):xa(a,e)}});function xa(e,t){return!e.issues.length&&e.value===void 0&&e.issues.push({code:"invalid_type",expected:"nonoptional",input:e.value,inst:t}),e}const Gd=k("$ZodCatch",(e,t)=>{H.init(e,t),L(e._zod,"optin",()=>t.innerType._zod.optin),L(e._zod,"optout",()=>t.innerType._zod.optout),L(e._zod,"values",()=>t.innerType._zod.values),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(o=>(r.value=o.value,o.issues.length&&(r.value=t.catchValue({...r,error:{issues:o.issues.map(s=>ut(s,n,it()))},input:r.value}),r.issues=[]),r)):(r.value=a.value,a.issues.length&&(r.value=t.catchValue({...r,error:{issues:a.issues.map(o=>ut(o,n,it()))},input:r.value}),r.issues=[]),r)}}),Wd=k("$ZodPipe",(e,t)=>{H.init(e,t),L(e._zod,"values",()=>t.in._zod.values),L(e._zod,"optin",()=>t.in._zod.optin),L(e._zod,"optout",()=>t.out._zod.optout),L(e._zod,"propValues",()=>t.in._zod.propValues),e._zod.parse=(r,n)=>{if(n.direction==="backward"){const o=t.out._zod.run(r,n);return o instanceof Promise?o.then(s=>yr(s,t.in,n)):yr(o,t.in,n)}const a=t.in._zod.run(r,n);return a instanceof Promise?a.then(o=>yr(o,t.out,n)):yr(a,t.out,n)}});function yr(e,t,r){return e.issues.length?(e.aborted=!0,e):t._zod.run({value:e.value,issues:e.issues},r)}const Hd=k("$ZodReadonly",(e,t)=>{H.init(e,t),L(e._zod,"propValues",()=>t.innerType._zod.propValues),L(e._zod,"values",()=>t.innerType._zod.values),L(e._zod,"optin",()=>t.innerType._zod.optin),L(e._zod,"optout",()=>t.innerType._zod.optout),e._zod.parse=(r,n)=>{if(n.direction==="backward")return t.innerType._zod.run(r,n);const a=t.innerType._zod.run(r,n);return a instanceof Promise?a.then(Sa):Sa(a)}});function Sa(e){return e.value=Object.freeze(e.value),e}const Kd=k("$ZodLazy",(e,t)=>{H.init(e,t),L(e._zod,"innerType",()=>t.getter()),L(e._zod,"pattern",()=>e._zod.innerType._zod.pattern),L(e._zod,"propValues",()=>e._zod.innerType._zod.propValues),L(e._zod,"optin",()=>e._zod.innerType._zod.optin??void 0),L(e._zod,"optout",()=>e._zod.innerType._zod.optout??void 0),e._zod.parse=(r,n)=>e._zod.innerType._zod.run(r,n)}),Yd=k("$ZodCustom",(e,t)=>{$e.init(e,t),H.init(e,t),e._zod.parse=(r,n)=>r,e._zod.check=r=>{const n=r.value,a=t.fn(n);if(a instanceof Promise)return a.then(o=>Ta(o,r,n,e));Ta(a,r,n,e)}});function Ta(e,t,r,n){if(!e){const a={code:"custom",input:r,inst:n,path:[...n._zod.def.path??[]],continue:!n._zod.def.abort};n._zod.def.params&&(a.params=n._zod.def.params),t.issues.push(Kt(a))}}class ni{constructor(){this._map=new WeakMap,this._idmap=new Map}add(t,...r){const n=r[0];if(this._map.set(t,n),n&&typeof n=="object"&&"id"in n){if(this._idmap.has(n.id))throw new Error(`ID ${n.id} already exists in the registry`);this._idmap.set(n.id,t)}return this}clear(){return this._map=new WeakMap,this._idmap=new Map,this}remove(t){const r=this._map.get(t);return r&&typeof r=="object"&&"id"in r&&this._idmap.delete(r.id),this._map.delete(t),this}get(t){const r=t._zod.parent;if(r){const n={...this.get(r)??{}};delete n.id;const a={...n,...this._map.get(t)};return Object.keys(a).length?a:void 0}return this._map.get(t)}has(t){return this._map.has(t)}}function Xd(){return new ni}const Vt=Xd();function Qd(e,t){return new e({type:"string",...N(t)})}function ep(e,t){return new e({type:"string",format:"email",check:"string_format",abort:!1,...N(t)})}function Ea(e,t){return new e({type:"string",format:"guid",check:"string_format",abort:!1,...N(t)})}function tp(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,...N(t)})}function rp(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v4",...N(t)})}function np(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v6",...N(t)})}function ap(e,t){return new e({type:"string",format:"uuid",check:"string_format",abort:!1,version:"v7",...N(t)})}function op(e,t){return new e({type:"string",format:"url",check:"string_format",abort:!1,...N(t)})}function sp(e,t){return new e({type:"string",format:"emoji",check:"string_format",abort:!1,...N(t)})}function ip(e,t){return new e({type:"string",format:"nanoid",check:"string_format",abort:!1,...N(t)})}function up(e,t){return new e({type:"string",format:"cuid",check:"string_format",abort:!1,...N(t)})}function lp(e,t){return new e({type:"string",format:"cuid2",check:"string_format",abort:!1,...N(t)})}function cp(e,t){return new e({type:"string",format:"ulid",check:"string_format",abort:!1,...N(t)})}function dp(e,t){return new e({type:"string",format:"xid",check:"string_format",abort:!1,...N(t)})}function pp(e,t){return new e({type:"string",format:"ksuid",check:"string_format",abort:!1,...N(t)})}function fp(e,t){return new e({type:"string",format:"ipv4",check:"string_format",abort:!1,...N(t)})}function mp(e,t){return new e({type:"string",format:"ipv6",check:"string_format",abort:!1,...N(t)})}function hp(e,t){return new e({type:"string",format:"cidrv4",check:"string_format",abort:!1,...N(t)})}function gp(e,t){return new e({type:"string",format:"cidrv6",check:"string_format",abort:!1,...N(t)})}function ai(e,t){return new e({type:"string",format:"base64",check:"string_format",abort:!1,...N(t)})}function vp(e,t){return new e({type:"string",format:"base64url",check:"string_format",abort:!1,...N(t)})}function yp(e,t){return new e({type:"string",format:"e164",check:"string_format",abort:!1,...N(t)})}function _p(e,t){return new e({type:"string",format:"jwt",check:"string_format",abort:!1,...N(t)})}function bp(e,t){return new e({type:"string",format:"datetime",check:"string_format",offset:!1,local:!1,precision:null,...N(t)})}function wp(e,t){return new e({type:"string",format:"date",check:"string_format",...N(t)})}function Ip(e,t){return new e({type:"string",format:"time",check:"string_format",precision:null,...N(t)})}function kp(e,t){return new e({type:"string",format:"duration",check:"string_format",...N(t)})}function xp(e,t){return new e({type:"number",checks:[],...N(t)})}function Sp(e,t){return new e({type:"number",coerce:!0,checks:[],...N(t)})}function Tp(e,t){return new e({type:"number",check:"number_format",abort:!1,format:"safeint",...N(t)})}function Ep(e,t){return new e({type:"boolean",...N(t)})}function $p(e,t){return new e({type:"null",...N(t)})}function Ap(e){return new e({type:"any"})}function Op(e){return new e({type:"unknown"})}function Cp(e,t){return new e({type:"never",...N(t)})}function $a(e,t){return new Ks({check:"less_than",...N(t),value:e,inclusive:!1})}function Kr(e,t){return new Ks({check:"less_than",...N(t),value:e,inclusive:!0})}function Aa(e,t){return new Ys({check:"greater_than",...N(t),value:e,inclusive:!1})}function Yr(e,t){return new Ys({check:"greater_than",...N(t),value:e,inclusive:!0})}function Oa(e,t){return new Fc({check:"multiple_of",...N(t),value:e})}function oi(e,t){return new Vc({check:"max_length",...N(t),maximum:e})}function Tr(e,t){return new Bc({check:"min_length",...N(t),minimum:e})}function si(e,t){return new Jc({check:"length_equals",...N(t),length:e})}function Np(e,t){return new Gc({check:"string_format",format:"regex",...N(t),pattern:e})}function Pp(e){return new Wc({check:"string_format",format:"lowercase",...N(e)})}function Rp(e){return new Hc({check:"string_format",format:"uppercase",...N(e)})}function Mp(e,t){return new Kc({check:"string_format",format:"includes",...N(t),includes:e})}function zp(e,t){return new Yc({check:"string_format",format:"starts_with",...N(t),prefix:e})}function Zp(e,t){return new Xc({check:"string_format",format:"ends_with",...N(t),suffix:e})}function sr(e){return new Qc({check:"overwrite",tx:e})}function jp(e){return sr(t=>t.normalize(e))}function Dp(){return sr(e=>e.trim())}function qp(){return sr(e=>e.toLowerCase())}function Up(){return sr(e=>e.toUpperCase())}function Fp(e,t,r){return new e({type:"array",element:t,...N(r)})}function Lp(e,t,r){const n=N(r);return n.abort??(n.abort=!0),new e({type:"custom",check:"custom",fn:t,...n})}function Vp(e,t,r){return new e({type:"custom",check:"custom",fn:t,...N(r)})}function Bp(e){const t=Jp(r=>(r.addIssue=n=>{if(typeof n=="string")r.issues.push(Kt(n,r.value,t._zod.def));else{const a=n;a.fatal&&(a.continue=!1),a.code??(a.code="custom"),a.input??(a.input=r.value),a.inst??(a.inst=t),a.continue??(a.continue=!t._zod.def.abort),r.issues.push(Kt(a))}},e(r.value,r)));return t}function Jp(e,t){const r=new $e({check:"custom",...N(t)});return r._zod.check=e,r}class Ca{constructor(t){this.counter=0,this.metadataRegistry=t?.metadata??Vt,this.target=t?.target??"draft-2020-12",this.unrepresentable=t?.unrepresentable??"throw",this.override=t?.override??(()=>{}),this.io=t?.io??"output",this.seen=new Map}process(t,r={path:[],schemaPath:[]}){var n;const a=t._zod.def,o={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},s=this.seen.get(t);if(s)return s.count++,r.schemaPath.includes(t)&&(s.cycle=r.path),s.schema;const i={schema:{},count:1,cycle:void 0,path:r.path};this.seen.set(t,i);const l=t._zod.toJSONSchema?.();if(l)i.schema=l;else{const m={...r,schemaPath:[...r.schemaPath,t],path:r.path},p=t._zod.parent;if(p)i.ref=p,this.process(p,m),this.seen.get(p).isParent=!0;else{const h=i.schema;switch(a.type){case"string":{const f=h;f.type="string";const{minimum:y,maximum:_,format:b,patterns:I,contentEncoding:v}=t._zod.bag;if(typeof y=="number"&&(f.minLength=y),typeof _=="number"&&(f.maxLength=_),b&&(f.format=o[b]??b,f.format===""&&delete f.format),v&&(f.contentEncoding=v),I&&I.size>0){const A=[...I];A.length===1?f.pattern=A[0].source:A.length>1&&(i.schema.allOf=[...A.map($=>({...this.target==="draft-7"||this.target==="draft-4"||this.target==="openapi-3.0"?{type:"string"}:{},pattern:$.source}))])}break}case"number":{const f=h,{minimum:y,maximum:_,format:b,multipleOf:I,exclusiveMaximum:v,exclusiveMinimum:A}=t._zod.bag;typeof b=="string"&&b.includes("int")?f.type="integer":f.type="number",typeof A=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(f.minimum=A,f.exclusiveMinimum=!0):f.exclusiveMinimum=A),typeof y=="number"&&(f.minimum=y,typeof A=="number"&&this.target!=="draft-4"&&(A>=y?delete f.minimum:delete f.exclusiveMinimum)),typeof v=="number"&&(this.target==="draft-4"||this.target==="openapi-3.0"?(f.maximum=v,f.exclusiveMaximum=!0):f.exclusiveMaximum=v),typeof _=="number"&&(f.maximum=_,typeof v=="number"&&this.target!=="draft-4"&&(v<=_?delete f.maximum:delete f.exclusiveMaximum)),typeof I=="number"&&(f.multipleOf=I);break}case"boolean":{const f=h;f.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"null":{this.target==="openapi-3.0"?(h.type="string",h.nullable=!0,h.enum=[null]):h.type="null";break}case"any":break;case"unknown":break;case"undefined":{if(this.unrepresentable==="throw")throw new Error("Undefined cannot be represented in JSON Schema");break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"never":{h.not={};break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const f=h,{minimum:y,maximum:_}=t._zod.bag;typeof y=="number"&&(f.minItems=y),typeof _=="number"&&(f.maxItems=_),f.type="array",f.items=this.process(a.element,{...m,path:[...m.path,"items"]});break}case"object":{const f=h;f.type="object",f.properties={};const y=a.shape;for(const I in y)f.properties[I]=this.process(y[I],{...m,path:[...m.path,"properties",I]});const _=new Set(Object.keys(y)),b=new Set([..._].filter(I=>{const v=a.shape[I]._zod;return this.io==="input"?v.optin===void 0:v.optout===void 0}));b.size>0&&(f.required=Array.from(b)),a.catchall?._zod.def.type==="never"?f.additionalProperties=!1:a.catchall?a.catchall&&(f.additionalProperties=this.process(a.catchall,{...m,path:[...m.path,"additionalProperties"]})):this.io==="output"&&(f.additionalProperties=!1);break}case"union":{const f=h,y=a.options.map((_,b)=>this.process(_,{...m,path:[...m.path,"anyOf",b]}));f.anyOf=y;break}case"intersection":{const f=h,y=this.process(a.left,{...m,path:[...m.path,"allOf",0]}),_=this.process(a.right,{...m,path:[...m.path,"allOf",1]}),b=v=>"allOf"in v&&Object.keys(v).length===1,I=[...b(y)?y.allOf:[y],...b(_)?_.allOf:[_]];f.allOf=I;break}case"tuple":{const f=h;f.type="array";const y=this.target==="draft-2020-12"?"prefixItems":"items",_=this.target==="draft-2020-12"||this.target==="openapi-3.0"?"items":"additionalItems",b=a.items.map(($,P)=>this.process($,{...m,path:[...m.path,y,P]})),I=a.rest?this.process(a.rest,{...m,path:[...m.path,_,...this.target==="openapi-3.0"?[a.items.length]:[]]}):null;this.target==="draft-2020-12"?(f.prefixItems=b,I&&(f.items=I)):this.target==="openapi-3.0"?(f.items={anyOf:b},I&&f.items.anyOf.push(I),f.minItems=b.length,I||(f.maxItems=b.length)):(f.items=b,I&&(f.additionalItems=I));const{minimum:v,maximum:A}=t._zod.bag;typeof v=="number"&&(f.minItems=v),typeof A=="number"&&(f.maxItems=A);break}case"record":{const f=h;f.type="object",(this.target==="draft-7"||this.target==="draft-2020-12")&&(f.propertyNames=this.process(a.keyType,{...m,path:[...m.path,"propertyNames"]})),f.additionalProperties=this.process(a.valueType,{...m,path:[...m.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const f=h,y=qs(a.entries);y.every(_=>typeof _=="number")&&(f.type="number"),y.every(_=>typeof _=="string")&&(f.type="string"),f.enum=y;break}case"literal":{const f=h,y=[];for(const _ of a.values)if(_===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof _=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");y.push(Number(_))}else y.push(_);if(y.length!==0)if(y.length===1){const _=y[0];f.type=_===null?"null":typeof _,this.target==="draft-4"||this.target==="openapi-3.0"?f.enum=[_]:f.const=_}else y.every(_=>typeof _=="number")&&(f.type="number"),y.every(_=>typeof _=="string")&&(f.type="string"),y.every(_=>typeof _=="boolean")&&(f.type="string"),y.every(_=>_===null)&&(f.type="null"),f.enum=y;break}case"file":{const f=h,y={type:"string",format:"binary",contentEncoding:"binary"},{minimum:_,maximum:b,mime:I}=t._zod.bag;_!==void 0&&(y.minLength=_),b!==void 0&&(y.maxLength=b),I?I.length===1?(y.contentMediaType=I[0],Object.assign(f,y)):f.anyOf=I.map(v=>({...y,contentMediaType:v})):Object.assign(f,y);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const f=this.process(a.innerType,m);this.target==="openapi-3.0"?(i.ref=a.innerType,h.nullable=!0):h.anyOf=[f,{type:"null"}];break}case"nonoptional":{this.process(a.innerType,m),i.ref=a.innerType;break}case"success":{const f=h;f.type="boolean";break}case"default":{this.process(a.innerType,m),i.ref=a.innerType,h.default=JSON.parse(JSON.stringify(a.defaultValue));break}case"prefault":{this.process(a.innerType,m),i.ref=a.innerType,this.io==="input"&&(h._prefault=JSON.parse(JSON.stringify(a.defaultValue)));break}case"catch":{this.process(a.innerType,m),i.ref=a.innerType;let f;try{f=a.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}h.default=f;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const f=h,y=t._zod.pattern;if(!y)throw new Error("Pattern not found in template literal");f.type="string",f.pattern=y.source;break}case"pipe":{const f=this.io==="input"?a.in._zod.def.type==="transform"?a.out:a.in:a.out;this.process(f,m),i.ref=f;break}case"readonly":{this.process(a.innerType,m),i.ref=a.innerType,h.readOnly=!0;break}case"promise":{this.process(a.innerType,m),i.ref=a.innerType;break}case"optional":{this.process(a.innerType,m),i.ref=a.innerType;break}case"lazy":{const f=t._zod.innerType;this.process(f,m),i.ref=f;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}case"function":{if(this.unrepresentable==="throw")throw new Error("Function types cannot be represented in JSON Schema");break}}}}const u=this.metadataRegistry.get(t);return u&&Object.assign(i.schema,u),this.io==="input"&&he(t)&&(delete i.schema.examples,delete i.schema.default),this.io==="input"&&i.schema._prefault&&((n=i.schema).default??(n.default=i.schema._prefault)),delete i.schema._prefault,this.seen.get(t).schema}emit(t,r){const n={cycles:r?.cycles??"ref",reused:r?.reused??"inline",external:r?.external??void 0},a=this.seen.get(t);if(!a)throw new Error("Unprocessed schema. This is a bug in Zod.");const o=d=>{const m=this.target==="draft-2020-12"?"$defs":"definitions";if(n.external){const y=n.external.registry.get(d[0])?.id,_=n.external.uri??(I=>I);if(y)return{ref:_(y)};const b=d[1].defId??d[1].schema.id??`schema${this.counter++}`;return d[1].defId=b,{defId:b,ref:`${_("__shared")}#/${m}/${b}`}}if(d[1]===a)return{ref:"#"};const h=`#/${m}/`,f=d[1].schema.id??`__schema${this.counter++}`;return{defId:f,ref:h+f}},s=d=>{if(d[1].schema.$ref)return;const m=d[1],{ref:p,defId:h}=o(d);m.def={...m.schema},h&&(m.defId=h);const f=m.schema;for(const y in f)delete f[y];f.$ref=p};if(n.cycles==="throw")for(const d of this.seen.entries()){const m=d[1];if(m.cycle)throw new Error(`Cycle detected: #/${m.cycle?.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`)}for(const d of this.seen.entries()){const m=d[1];if(t===d[0]){s(d);continue}if(n.external){const h=n.external.registry.get(d[0])?.id;if(t!==d[0]&&h){s(d);continue}}if(this.metadataRegistry.get(d[0])?.id){s(d);continue}if(m.cycle){s(d);continue}if(m.count>1&&n.reused==="ref"){s(d);continue}}const i=(d,m)=>{const p=this.seen.get(d),h=p.def??p.schema,f={...h};if(p.ref===null)return;const y=p.ref;if(p.ref=null,y){i(y,m);const _=this.seen.get(y).schema;_.$ref&&(m.target==="draft-7"||m.target==="draft-4"||m.target==="openapi-3.0")?(h.allOf=h.allOf??[],h.allOf.push(_)):(Object.assign(h,_),Object.assign(h,f))}p.isParent||this.override({zodSchema:d,jsonSchema:h,path:p.path??[]})};for(const d of[...this.seen.entries()].reverse())i(d[0],{target:this.target});const l={};if(this.target==="draft-2020-12"?l.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?l.$schema="http://json-schema.org/draft-07/schema#":this.target==="draft-4"?l.$schema="http://json-schema.org/draft-04/schema#":this.target==="openapi-3.0"||console.warn(`Invalid target: ${this.target}`),n.external?.uri){const d=n.external.registry.get(t)?.id;if(!d)throw new Error("Schema is missing an `id` property");l.$id=n.external.uri(d)}Object.assign(l,a.def);const u=n.external?.defs??{};for(const d of this.seen.entries()){const m=d[1];m.def&&m.defId&&(u[m.defId]=m.def)}n.external||Object.keys(u).length>0&&(this.target==="draft-2020-12"?l.$defs=u:l.definitions=u);try{return JSON.parse(JSON.stringify(l))}catch{throw new Error("Error converting schema to JSON.")}}}function ii(e,t){if(e instanceof ni){const n=new Ca(t),a={};for(const i of e._idmap.entries()){const[l,u]=i;n.process(u)}const o={},s={registry:e,uri:t?.uri,defs:a};for(const i of e._idmap.entries()){const[l,u]=i;o[l]=n.emit(u,{...t,external:s})}if(Object.keys(a).length>0){const i=n.target==="draft-2020-12"?"$defs":"definitions";o.__shared={[i]:a}}return{schemas:o}}const r=new Ca(t);return r.process(e),r.emit(e,t)}function he(e,t){const r=t??{seen:new Set};if(r.seen.has(e))return!1;r.seen.add(e);const a=e._zod.def;switch(a.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return he(a.element,r);case"object":{for(const o in a.shape)if(he(a.shape[o],r))return!0;return!1}case"union":{for(const o of a.options)if(he(o,r))return!0;return!1}case"intersection":return he(a.left,r)||he(a.right,r);case"tuple":{for(const o of a.items)if(he(o,r))return!0;return!!(a.rest&&he(a.rest,r))}case"record":return he(a.keyType,r)||he(a.valueType,r);case"map":return he(a.keyType,r)||he(a.valueType,r);case"set":return he(a.valueType,r);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return he(a.innerType,r);case"lazy":return he(a.getter(),r);case"default":return he(a.innerType,r);case"prefault":return he(a.innerType,r);case"custom":return!1;case"transform":return!0;case"pipe":return he(a.in,r)||he(a.out,r);case"success":return!1;case"catch":return!1;case"function":return!1}throw new Error(`Unknown schema type: ${a.type}`)}const Gp=k("ZodISODateTime",(e,t)=>{fd.init(e,t),ne.init(e,t)});function Wp(e){return bp(Gp,e)}const Hp=k("ZodISODate",(e,t)=>{md.init(e,t),ne.init(e,t)});function Kp(e){return wp(Hp,e)}const Yp=k("ZodISOTime",(e,t)=>{hd.init(e,t),ne.init(e,t)});function Xp(e){return Ip(Yp,e)}const Qp=k("ZodISODuration",(e,t)=>{gd.init(e,t),ne.init(e,t)});function ef(e){return kp(Qp,e)}const tf=(e,t)=>{Vs.init(e,t),e.name="ZodError",Object.defineProperties(e,{format:{value:r=>nc(e,r)},flatten:{value:r=>rc(e,r)},addIssue:{value:r=>{e.issues.push(r),e.message=JSON.stringify(e.issues,gn,2)}},addIssues:{value:r=>{e.issues.push(...r),e.message=JSON.stringify(e.issues,gn,2)}},isEmpty:{get(){return e.issues.length===0}}})},Ze=k("ZodError",tf,{Parent:Error}),rf=Zn(Ze),nf=jn(Ze),af=Mr(Ze),qn=zr(Ze),of=sc(Ze),sf=ic(Ze),uf=uc(Ze),lf=lc(Ze),cf=cc(Ze),df=dc(Ze),pf=pc(Ze),ff=fc(Ze),X=k("ZodType",(e,t)=>(H.init(e,t),e.def=t,e.type=t.type,Object.defineProperty(e,"_def",{value:t}),e.check=(...r)=>e.clone(vt(t,{checks:[...t.checks??[],...r.map(n=>typeof n=="function"?{_zod:{check:n,def:{check:"custom"},onattach:[]}}:n)]})),e.clone=(r,n)=>pt(e,r,n),e.brand=()=>e,e.register=((r,n)=>(r.add(e,n),e)),e.parse=(r,n)=>rf(e,r,n,{callee:e.parse}),e.safeParse=(r,n)=>af(e,r,n),e.parseAsync=async(r,n)=>nf(e,r,n,{callee:e.parseAsync}),e.safeParseAsync=async(r,n)=>qn(e,r,n),e.spa=e.safeParseAsync,e.encode=(r,n)=>of(e,r,n),e.decode=(r,n)=>sf(e,r,n),e.encodeAsync=async(r,n)=>uf(e,r,n),e.decodeAsync=async(r,n)=>lf(e,r,n),e.safeEncode=(r,n)=>cf(e,r,n),e.safeDecode=(r,n)=>df(e,r,n),e.safeEncodeAsync=async(r,n)=>pf(e,r,n),e.safeDecodeAsync=async(r,n)=>ff(e,r,n),e.refine=(r,n)=>e.check(sm(r,n)),e.superRefine=r=>e.check(im(r)),e.overwrite=r=>e.check(sr(r)),e.optional=()=>le(e),e.nullable=()=>Ra(e),e.nullish=()=>le(Ra(e)),e.nonoptional=r=>Xf(e,r),e.array=()=>C(e),e.or=r=>U([e,r]),e.and=r=>Ff(e,r),e.transform=r=>Ma(e,Jf(r)),e.default=r=>Hf(e,r),e.prefault=r=>Yf(e,r),e.catch=r=>em(e,r),e.pipe=r=>Ma(e,r),e.readonly=()=>nm(e),e.describe=r=>{const n=e.clone();return Vt.add(n,{description:r}),n},Object.defineProperty(e,"description",{get(){return Vt.get(e)?.description},configurable:!0}),e.meta=(...r)=>{if(r.length===0)return Vt.get(e);const n=e.clone();return Vt.add(n,r[0]),n},e.isOptional=()=>e.safeParse(void 0).success,e.isNullable=()=>e.safeParse(null).success,e)),ui=k("_ZodString",(e,t)=>{Dn.init(e,t),X.init(e,t);const r=e._zod.bag;e.format=r.format??null,e.minLength=r.minimum??null,e.maxLength=r.maximum??null,e.regex=(...n)=>e.check(Np(...n)),e.includes=(...n)=>e.check(Mp(...n)),e.startsWith=(...n)=>e.check(zp(...n)),e.endsWith=(...n)=>e.check(Zp(...n)),e.min=(...n)=>e.check(Tr(...n)),e.max=(...n)=>e.check(oi(...n)),e.length=(...n)=>e.check(si(...n)),e.nonempty=(...n)=>e.check(Tr(1,...n)),e.lowercase=n=>e.check(Pp(n)),e.uppercase=n=>e.check(Rp(n)),e.trim=()=>e.check(Dp()),e.normalize=(...n)=>e.check(jp(...n)),e.toLowerCase=()=>e.check(qp()),e.toUpperCase=()=>e.check(Up())}),mf=k("ZodString",(e,t)=>{Dn.init(e,t),ui.init(e,t),e.email=r=>e.check(ep(hf,r)),e.url=r=>e.check(op(gf,r)),e.jwt=r=>e.check(_p(Of,r)),e.emoji=r=>e.check(sp(vf,r)),e.guid=r=>e.check(Ea(Na,r)),e.uuid=r=>e.check(tp(_r,r)),e.uuidv4=r=>e.check(rp(_r,r)),e.uuidv6=r=>e.check(np(_r,r)),e.uuidv7=r=>e.check(ap(_r,r)),e.nanoid=r=>e.check(ip(yf,r)),e.guid=r=>e.check(Ea(Na,r)),e.cuid=r=>e.check(up(_f,r)),e.cuid2=r=>e.check(lp(bf,r)),e.ulid=r=>e.check(cp(wf,r)),e.base64=r=>e.check(ai(li,r)),e.base64url=r=>e.check(vp($f,r)),e.xid=r=>e.check(dp(If,r)),e.ksuid=r=>e.check(pp(kf,r)),e.ipv4=r=>e.check(fp(xf,r)),e.ipv6=r=>e.check(mp(Sf,r)),e.cidrv4=r=>e.check(hp(Tf,r)),e.cidrv6=r=>e.check(gp(Ef,r)),e.e164=r=>e.check(yp(Af,r)),e.datetime=r=>e.check(Wp(r)),e.date=r=>e.check(Kp(r)),e.time=r=>e.check(Xp(r)),e.duration=r=>e.check(ef(r))});function c(e){return Qd(mf,e)}const ne=k("ZodStringFormat",(e,t)=>{te.init(e,t),ui.init(e,t)}),hf=k("ZodEmail",(e,t)=>{ad.init(e,t),ne.init(e,t)}),Na=k("ZodGUID",(e,t)=>{rd.init(e,t),ne.init(e,t)}),_r=k("ZodUUID",(e,t)=>{nd.init(e,t),ne.init(e,t)}),gf=k("ZodURL",(e,t)=>{od.init(e,t),ne.init(e,t)}),vf=k("ZodEmoji",(e,t)=>{sd.init(e,t),ne.init(e,t)}),yf=k("ZodNanoID",(e,t)=>{id.init(e,t),ne.init(e,t)}),_f=k("ZodCUID",(e,t)=>{ud.init(e,t),ne.init(e,t)}),bf=k("ZodCUID2",(e,t)=>{ld.init(e,t),ne.init(e,t)}),wf=k("ZodULID",(e,t)=>{cd.init(e,t),ne.init(e,t)}),If=k("ZodXID",(e,t)=>{dd.init(e,t),ne.init(e,t)}),kf=k("ZodKSUID",(e,t)=>{pd.init(e,t),ne.init(e,t)}),xf=k("ZodIPv4",(e,t)=>{vd.init(e,t),ne.init(e,t)}),Sf=k("ZodIPv6",(e,t)=>{yd.init(e,t),ne.init(e,t)}),Tf=k("ZodCIDRv4",(e,t)=>{_d.init(e,t),ne.init(e,t)}),Ef=k("ZodCIDRv6",(e,t)=>{bd.init(e,t),ne.init(e,t)}),li=k("ZodBase64",(e,t)=>{wd.init(e,t),ne.init(e,t)});function ci(e){return ai(li,e)}const $f=k("ZodBase64URL",(e,t)=>{kd.init(e,t),ne.init(e,t)}),Af=k("ZodE164",(e,t)=>{xd.init(e,t),ne.init(e,t)}),Of=k("ZodJWT",(e,t)=>{Td.init(e,t),ne.init(e,t)}),Un=k("ZodNumber",(e,t)=>{Qs.init(e,t),X.init(e,t),e.gt=(n,a)=>e.check(Aa(n,a)),e.gte=(n,a)=>e.check(Yr(n,a)),e.min=(n,a)=>e.check(Yr(n,a)),e.lt=(n,a)=>e.check($a(n,a)),e.lte=(n,a)=>e.check(Kr(n,a)),e.max=(n,a)=>e.check(Kr(n,a)),e.int=n=>e.check(Pa(n)),e.safe=n=>e.check(Pa(n)),e.positive=n=>e.check(Aa(0,n)),e.nonnegative=n=>e.check(Yr(0,n)),e.negative=n=>e.check($a(0,n)),e.nonpositive=n=>e.check(Kr(0,n)),e.multipleOf=(n,a)=>e.check(Oa(n,a)),e.step=(n,a)=>e.check(Oa(n,a)),e.finite=()=>e;const r=e._zod.bag;e.minValue=Math.max(r.minimum??Number.NEGATIVE_INFINITY,r.exclusiveMinimum??Number.NEGATIVE_INFINITY)??null,e.maxValue=Math.min(r.maximum??Number.POSITIVE_INFINITY,r.exclusiveMaximum??Number.POSITIVE_INFINITY)??null,e.isInt=(r.format??"").includes("int")||Number.isSafeInteger(r.multipleOf??.5),e.isFinite=!0,e.format=r.format??null});function S(e){return xp(Un,e)}const Cf=k("ZodNumberFormat",(e,t)=>{Ed.init(e,t),Un.init(e,t)});function Pa(e){return Tp(Cf,e)}const Nf=k("ZodBoolean",(e,t)=>{$d.init(e,t),X.init(e,t)});function ce(e){return Ep(Nf,e)}const Pf=k("ZodNull",(e,t)=>{Ad.init(e,t),X.init(e,t)});function Rf(e){return $p(Pf,e)}const Mf=k("ZodAny",(e,t)=>{Od.init(e,t),X.init(e,t)});function We(){return Ap(Mf)}const zf=k("ZodUnknown",(e,t)=>{Cd.init(e,t),X.init(e,t)});function Ve(){return Op(zf)}const Zf=k("ZodNever",(e,t)=>{Nd.init(e,t),X.init(e,t)});function jf(e){return Cp(Zf,e)}const Df=k("ZodArray",(e,t)=>{Pd.init(e,t),X.init(e,t),e.element=t.element,e.min=(r,n)=>e.check(Tr(r,n)),e.nonempty=r=>e.check(Tr(1,r)),e.max=(r,n)=>e.check(oi(r,n)),e.length=(r,n)=>e.check(si(r,n)),e.unwrap=()=>e.element});function C(e,t){return Fp(Df,e,t)}const di=k("ZodObject",(e,t)=>{Md.init(e,t),X.init(e,t),L(e,"shape",()=>t.shape),e.keyof=()=>oe(Object.keys(e._zod.def.shape)),e.catchall=r=>e.clone({...e._zod.def,catchall:r}),e.passthrough=()=>e.clone({...e._zod.def,catchall:Ve()}),e.loose=()=>e.clone({...e._zod.def,catchall:Ve()}),e.strict=()=>e.clone({...e._zod.def,catchall:jf()}),e.strip=()=>e.clone({...e._zod.def,catchall:void 0}),e.extend=r=>Yl(e,r),e.safeExtend=r=>Xl(e,r),e.merge=r=>Ql(e,r),e.pick=r=>Hl(e,r),e.omit=r=>Kl(e,r),e.partial=(...r)=>ec(fi,e,r[0]),e.required=(...r)=>tc(mi,e,r[0])});function g(e,t){const r={type:"object",shape:e??{},...N(t)};return new di(r)}function $t(e,t){return new di({type:"object",shape:e,catchall:Ve(),...N(t)})}const pi=k("ZodUnion",(e,t)=>{ri.init(e,t),X.init(e,t),e.options=t.options});function U(e,t){return new pi({type:"union",options:e,...N(t)})}const qf=k("ZodDiscriminatedUnion",(e,t)=>{pi.init(e,t),zd.init(e,t)});function Ee(e,t,r){return new qf({type:"union",options:t,discriminator:e,...N(r)})}const Uf=k("ZodIntersection",(e,t)=>{Zd.init(e,t),X.init(e,t)});function Ff(e,t){return new Uf({type:"intersection",left:e,right:t})}const Lf=k("ZodRecord",(e,t)=>{jd.init(e,t),X.init(e,t),e.keyType=t.keyType,e.valueType=t.valueType});function ge(e,t,r){return new Lf({type:"record",keyType:e,valueType:t,...N(r)})}const yn=k("ZodEnum",(e,t)=>{Dd.init(e,t),X.init(e,t),e.enum=t.entries,e.options=Object.values(t.entries);const r=new Set(Object.keys(t.entries));e.extract=(n,a)=>{const o={};for(const s of n)if(r.has(s))o[s]=t.entries[s];else throw new Error(`Key ${s} not found in enum`);return new yn({...t,checks:[],...N(a),entries:o})},e.exclude=(n,a)=>{const o={...t.entries};for(const s of n)if(r.has(s))delete o[s];else throw new Error(`Key ${s} not found in enum`);return new yn({...t,checks:[],...N(a),entries:o})}});function oe(e,t){const r=Array.isArray(e)?Object.fromEntries(e.map(n=>[n,n])):e;return new yn({type:"enum",entries:r,...N(t)})}const Vf=k("ZodLiteral",(e,t)=>{qd.init(e,t),X.init(e,t),e.values=new Set(t.values),Object.defineProperty(e,"value",{get(){if(t.values.length>1)throw new Error("This schema contains multiple valid literal values. Use `.values` instead.");return t.values[0]}})});function x(e,t){return new Vf({type:"literal",values:Array.isArray(e)?e:[e],...N(t)})}const Bf=k("ZodTransform",(e,t)=>{Ud.init(e,t),X.init(e,t),e._zod.parse=(r,n)=>{if(n.direction==="backward")throw new js(e.constructor.name);r.addIssue=o=>{if(typeof o=="string")r.issues.push(Kt(o,r.value,t));else{const s=o;s.fatal&&(s.continue=!1),s.code??(s.code="custom"),s.input??(s.input=r.value),s.inst??(s.inst=e),r.issues.push(Kt(s))}};const a=t.transform(r.value,r);return a instanceof Promise?a.then(o=>(r.value=o,r)):(r.value=a,r)}});function Jf(e){return new Bf({type:"transform",transform:e})}const fi=k("ZodOptional",(e,t)=>{Fd.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType});function le(e){return new fi({type:"optional",innerType:e})}const Gf=k("ZodNullable",(e,t)=>{Ld.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Ra(e){return new Gf({type:"nullable",innerType:e})}const Wf=k("ZodDefault",(e,t)=>{Vd.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeDefault=e.unwrap});function Hf(e,t){return new Wf({type:"default",innerType:e,get defaultValue(){return typeof t=="function"?t():Fs(t)}})}const Kf=k("ZodPrefault",(e,t)=>{Bd.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Yf(e,t){return new Kf({type:"prefault",innerType:e,get defaultValue(){return typeof t=="function"?t():Fs(t)}})}const mi=k("ZodNonOptional",(e,t)=>{Jd.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType});function Xf(e,t){return new mi({type:"nonoptional",innerType:e,...N(t)})}const Qf=k("ZodCatch",(e,t)=>{Gd.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType,e.removeCatch=e.unwrap});function em(e,t){return new Qf({type:"catch",innerType:e,catchValue:typeof t=="function"?t:()=>t})}const tm=k("ZodPipe",(e,t)=>{Wd.init(e,t),X.init(e,t),e.in=t.in,e.out=t.out});function Ma(e,t){return new tm({type:"pipe",in:e,out:t})}const rm=k("ZodReadonly",(e,t)=>{Hd.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.innerType});function nm(e){return new rm({type:"readonly",innerType:e})}const am=k("ZodLazy",(e,t)=>{Kd.init(e,t),X.init(e,t),e.unwrap=()=>e._zod.def.getter()});function hi(e){return new am({type:"lazy",getter:e})}const Fn=k("ZodCustom",(e,t)=>{Yd.init(e,t),X.init(e,t)});function om(e,t){return Lp(Fn,e??(()=>!0),t)}function sm(e,t={}){return Vp(Fn,e,t)}function im(e){return Bp(e)}function Er(e,t={error:`Input not instance of ${e.name}`}){const r=new Fn({type:"custom",check:"custom",fn:n=>n instanceof e,abort:!0,...N(t)});return r._zod.bag.Class=e,r}function um(e){return Sp(Un,e)}var Yt;(function(e){e.assertEqual=a=>{};function t(a){}e.assertIs=t;function r(a){throw new Error}e.assertNever=r,e.arrayToEnum=a=>{const o={};for(const s of a)o[s]=s;return o},e.getValidEnumValues=a=>{const o=e.objectKeys(a).filter(i=>typeof a[a[i]]!="number"),s={};for(const i of o)s[i]=a[i];return e.objectValues(s)},e.objectValues=a=>e.objectKeys(a).map(function(o){return a[o]}),e.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const o=[];for(const s in a)Object.prototype.hasOwnProperty.call(a,s)&&o.push(s);return o},e.find=(a,o)=>{for(const s of a)if(o(s))return s},e.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function n(a,o=" | "){return a.map(s=>typeof s=="string"?`'${s}'`:s).join(o)}e.joinValues=n,e.jsonStringifyReplacer=(a,o)=>typeof o=="bigint"?o.toString():o})(Yt||(Yt={}));var za;(function(e){e.mergeShapes=(t,r)=>({...t,...r})})(za||(za={}));Yt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]);Yt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class $r extends Error{get errors(){return this.issues}constructor(t){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};const r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=t}format(t){const r=t||function(o){return o.message},n={_errors:[]},a=o=>{for(const s of o.issues)if(s.code==="invalid_union")s.unionErrors.map(a);else if(s.code==="invalid_return_type")a(s.returnTypeError);else if(s.code==="invalid_arguments")a(s.argumentsError);else if(s.path.length===0)n._errors.push(r(s));else{let i=n,l=0;for(;l<s.path.length;){const u=s.path[l];l===s.path.length-1?(i[u]=i[u]||{_errors:[]},i[u]._errors.push(r(s))):i[u]=i[u]||{_errors:[]},i=i[u],l++}}};return a(this),n}static assert(t){if(!(t instanceof $r))throw new Error(`Not a ZodError: ${t}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Yt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(t=r=>r.message){const r=Object.create(null),n=[];for(const a of this.issues)if(a.path.length>0){const o=a.path[0];r[o]=r[o]||[],r[o].push(t(a))}else n.push(t(a));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}}$r.create=e=>new $r(e);var Za;(function(e){e.errToObj=t=>typeof t=="string"?{message:t}:t||{},e.toString=t=>typeof t=="string"?t:t?.message})(Za||(Za={}));var T;(function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"})(T||(T={}));var gi={};function He(...e){return e.reduce((t,r)=>({...t,...r??{}}),{})}function ir(e){return Object.fromEntries([...e.headers])}var lm=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:n="-"}={})=>{const a=()=>{const o=r.length,s=new Array(t);for(let i=0;i<t;i++)s[i]=r[Math.random()*o|0];return s.join("")};if(e==null)return a;if(r.includes(n))throw new hs({argument:"separator",message:`The separator "${n}" must not be part of the alphabet "${r}".`});return()=>`${e}${n}${a()}`},tt=lm();function _n(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}var cm=["fetch failed","failed to fetch"];function dm({error:e,url:t,requestBodyValues:r}){if(_n(e))return e;if(e instanceof TypeError&&cm.includes(e.message.toLowerCase())){const n=e.cause;if(n!=null)return new ze({message:`Cannot connect to API: ${n.message}`,cause:n,url:t,requestBodyValues:r,isRetryable:!0})}return e}function pm(e=globalThis){var t,r,n;return e.window?"runtime/browser":(t=e.navigator)!=null&&t.userAgent?`runtime/${e.navigator.userAgent.toLowerCase()}`:(n=(r=e.process)==null?void 0:r.versions)!=null&&n.node?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function fm(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!=null))}function vi(e,...t){const r=fm(e??{}),n=new Headers(r),a=n.get("user-agent")||"";return n.set("user-agent",[a,...t].filter(Boolean).join(" ")),Object.fromEntries(n)}var mm="3.0.12";function hm({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:n}){if(typeof e=="string")return e;if(e!=null)throw new gr({message:`${n} API key must be a string.`});if(typeof process>"u")throw new gr({message:`${n} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(e=gi[t],e==null)throw new gr({message:`${n} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if(typeof e!="string")throw new gr({message:`${n} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}function gm({settingValue:e,environmentVariableName:t}){if(typeof e=="string")return e;if(!(e!=null||typeof process>"u")&&(e=gi[t],!(e==null||typeof e!="string")))return e}function vm(e){var t;const[r,n=""]=e.toLowerCase().split("/");return(t={mpeg:"mp3","x-wav":"wav",opus:"ogg",mp4:"m4a","x-m4a":"m4a"}[n])!=null?t:n}var ym=/"__proto__"\s*:/,_m=/"constructor"\s*:/;function bm(e){const t=JSON.parse(e);return t===null||typeof t!="object"||ym.test(e)===!1&&_m.test(e)===!1?t:wm(t)}function wm(e){let t=[e];for(;t.length;){const r=t;t=[];for(const n of r){if(Object.prototype.hasOwnProperty.call(n,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const a in n){const o=n[a];o&&typeof o=="object"&&t.push(o)}}}return e}function Ln(e){const{stackTraceLimit:t}=Error;Error.stackTraceLimit=0;try{return bm(e)}finally{Error.stackTraceLimit=t}}var Ar=Symbol.for("vercel.ai.validator");function Im(e){return{[Ar]:!0,validate:e}}function km(e){return typeof e=="object"&&e!==null&&Ar in e&&e[Ar]===!0&&"validate"in e}function Te(e){let t;return()=>(t==null&&(t=e()),t)}function xm(e){return km(e)?e:typeof e=="function"?e():Sm(e)}function Sm(e){return Im(async t=>{const r=await e["~standard"].validate(t);return r.issues==null?{success:!0,value:r.value}:{success:!1,error:new Wt({value:t,cause:r.issues})}})}async function st({value:e,schema:t}){const r=await Vn({value:e,schema:t});if(!r.success)throw Wt.wrap({value:e,cause:r.error});return r.value}async function Vn({value:e,schema:t}){const r=xm(t);try{if(r.validate==null)return{success:!0,value:e,rawValue:e};const n=await r.validate(e);return n.success?{success:!0,value:n.value,rawValue:e}:{success:!1,error:Wt.wrap({value:e,cause:n.error}),rawValue:e}}catch(n){return{success:!1,error:Wt.wrap({value:e,cause:n}),rawValue:e}}}async function Tm({text:e,schema:t}){try{const r=Ln(e);return t==null?r:st({value:r,schema:t})}catch(r){throw xr.isInstance(r)||Wt.isInstance(r)?r:new xr({text:e,cause:r})}}async function yi({text:e,schema:t}){try{const r=Ln(e);return t==null?{success:!0,value:r,rawValue:r}:await Vn({value:r,schema:t})}catch(r){return{success:!1,error:xr.isInstance(r)?r:new xr({text:e,cause:r}),rawValue:void 0}}}function ja(e){try{return Ln(e),!0}catch{return!1}}function Em({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new Zs).pipeThrough(new TransformStream({async transform({data:r},n){r!=="[DONE]"&&n.enqueue(await yi({text:r,schema:t}))}}))}async function lt({provider:e,providerOptions:t,schema:r}){if(t?.[e]==null)return;const n=await Vn({value:t[e],schema:r});if(!n.success)throw new hs({argument:"providerOptions",message:`invalid ${e} provider options`,cause:n.error});return n.value}var $m=()=>globalThis.fetch,at=async({url:e,headers:t,body:r,failedResponseHandler:n,successfulResponseHandler:a,abortSignal:o,fetch:s})=>_i({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:n,successfulResponseHandler:a,abortSignal:o,fetch:s}),Am=async({url:e,headers:t,formData:r,failedResponseHandler:n,successfulResponseHandler:a,abortSignal:o,fetch:s})=>_i({url:e,headers:t,body:{content:r,values:Object.fromEntries(r.entries())},failedResponseHandler:n,successfulResponseHandler:a,abortSignal:o,fetch:s}),_i=async({url:e,headers:t={},body:r,successfulResponseHandler:n,failedResponseHandler:a,abortSignal:o,fetch:s=$m()})=>{try{const i=await s(e,{method:"POST",headers:vi(t,`ai-sdk/provider-utils/${mm}`,pm()),body:r.content,signal:o}),l=ir(i);if(!i.ok){let u;try{u=await a({response:i,url:e,requestBodyValues:r.values})}catch(d){throw _n(d)||ze.isInstance(d)?d:new ze({message:"Failed to process error response",cause:d,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:r.values})}throw u.value}try{return await n({response:i,url:e,requestBodyValues:r.values})}catch(u){throw u instanceof Error&&(_n(u)||ze.isInstance(u))?u:new ze({message:"Failed to process successful response",cause:u,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:r.values})}}catch(i){throw dm({error:i,url:e,requestBodyValues:r.values})}};function Mt({id:e,name:t,inputSchema:r,outputSchema:n}){return({execute:a,toModelOutput:o,onInputStart:s,onInputDelta:i,onInputAvailable:l,...u})=>({type:"provider-defined",id:e,name:t,args:u,inputSchema:r,outputSchema:n,execute:a,toModelOutput:o,onInputStart:s,onInputDelta:i,onInputAvailable:l})}var Om=({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:n,url:a,requestBodyValues:o})=>{const s=await n.text(),i=ir(n);if(s.trim()==="")return{responseHeaders:i,value:new ze({message:n.statusText,url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,isRetryable:r?.(n)})};try{const l=await Tm({text:s,schema:e});return{responseHeaders:i,value:new ze({message:t(l),url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,data:l,isRetryable:r?.(n,l)})}}catch{return{responseHeaders:i,value:new ze({message:n.statusText,url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,isRetryable:r?.(n)})}}},Bn=e=>async({response:t})=>{const r=ir(t);if(t.body==null)throw new Ol({});return{responseHeaders:r,value:Em({stream:t.body,schema:e})}},zt=e=>async({response:t,url:r,requestBodyValues:n})=>{const a=await t.text(),o=await yi({text:a,schema:e}),s=ir(t);if(!o.success)throw new ze({message:"Invalid JSON response",cause:o.error,statusCode:t.status,responseHeaders:s,responseBody:a,url:r,requestBodyValues:n});return{responseHeaders:s,value:o.value,rawValue:o.rawValue}},Cm=()=>async({response:e,url:t,requestBodyValues:r})=>{const n=ir(e);if(!e.body)throw new ze({message:"Response body is empty",url:t,requestBodyValues:r,statusCode:e.status,responseHeaders:n,responseBody:void 0});try{const a=await e.arrayBuffer();return{responseHeaders:n,value:new Uint8Array(a)}}catch(a){throw new ze({message:"Failed to read response as array buffer",url:t,requestBodyValues:r,statusCode:e.status,responseHeaders:n,responseBody:void 0,cause:a})}},Nm=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},Pm=Symbol("Let zodToJsonSchema decide on which parser to use"),Da={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Rm=e=>typeof e=="string"?{...Da,name:e}:{...Da,...e};function Ce(){return{}}function Mm(e,t){var r,n,a;const o={type:"array"};return(r=e.type)!=null&&r._def&&((a=(n=e.type)==null?void 0:n._def)==null?void 0:a.typeName)!==T.ZodAny&&(o.items=J(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&(o.minItems=e.minLength.value),e.maxLength&&(o.maxItems=e.maxLength.value),e.exactLength&&(o.minItems=e.exactLength.value,o.maxItems=e.exactLength.value),o}function zm(e){const t={type:"integer",format:"int64"};if(!e.checks)return t;for(const r of e.checks)switch(r.kind){case"min":r.inclusive?t.minimum=r.value:t.exclusiveMinimum=r.value;break;case"max":r.inclusive?t.maximum=r.value:t.exclusiveMaximum=r.value;break;case"multipleOf":t.multipleOf=r.value;break}return t}function Zm(){return{type:"boolean"}}function bi(e,t){return J(e.type._def,t)}var jm=(e,t)=>J(e.innerType._def,t);function wi(e,t,r){const n=r??t.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,o)=>wi(e,t,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Dm(e)}}var Dm=e=>{const t={type:"integer",format:"unix-time"};for(const r of e.checks)switch(r.kind){case"min":t.minimum=r.value;break;case"max":t.maximum=r.value;break}return t};function qm(e,t){return{...J(e.innerType._def,t),default:e.defaultValue()}}function Um(e,t){return t.effectStrategy==="input"?J(e.schema._def,t):Ce()}function Fm(e){return{type:"string",enum:Array.from(e.values)}}var Lm=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function Vm(e,t){const r=[J(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),J(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(a=>!!a),n=[];return r.forEach(a=>{if(Lm(a))n.push(...a.allOf);else{let o=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:s,...i}=a;o=i}n.push(o)}}),n.length?{allOf:n}:void 0}function Bm(e){const t=typeof e.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(e.value)?"array":"object"}:{type:t==="bigint"?"integer":t,const:e.value}}var Xr=void 0,qe={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Xr===void 0&&(Xr=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Xr),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Ii(e,t){const r={type:"string"};if(e.checks)for(const n of e.checks)switch(n.kind){case"min":r.minLength=typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value;break;case"max":r.maxLength=typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value;break;case"email":switch(t.emailStrategy){case"format:email":Ue(r,"email",n.message,t);break;case"format:idn-email":Ue(r,"idn-email",n.message,t);break;case"pattern:zod":ke(r,qe.email,n.message,t);break}break;case"url":Ue(r,"uri",n.message,t);break;case"uuid":Ue(r,"uuid",n.message,t);break;case"regex":ke(r,n.regex,n.message,t);break;case"cuid":ke(r,qe.cuid,n.message,t);break;case"cuid2":ke(r,qe.cuid2,n.message,t);break;case"startsWith":ke(r,RegExp(`^${Qr(n.value,t)}`),n.message,t);break;case"endsWith":ke(r,RegExp(`${Qr(n.value,t)}$`),n.message,t);break;case"datetime":Ue(r,"date-time",n.message,t);break;case"date":Ue(r,"date",n.message,t);break;case"time":Ue(r,"time",n.message,t);break;case"duration":Ue(r,"duration",n.message,t);break;case"length":r.minLength=typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,r.maxLength=typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value;break;case"includes":{ke(r,RegExp(Qr(n.value,t)),n.message,t);break}case"ip":{n.version!=="v6"&&Ue(r,"ipv4",n.message,t),n.version!=="v4"&&Ue(r,"ipv6",n.message,t);break}case"base64url":ke(r,qe.base64url,n.message,t);break;case"jwt":ke(r,qe.jwt,n.message,t);break;case"cidr":{n.version!=="v6"&&ke(r,qe.ipv4Cidr,n.message,t),n.version!=="v4"&&ke(r,qe.ipv6Cidr,n.message,t);break}case"emoji":ke(r,qe.emoji(),n.message,t);break;case"ulid":{ke(r,qe.ulid,n.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{Ue(r,"binary",n.message,t);break}case"contentEncoding:base64":{r.contentEncoding="base64";break}case"pattern:zod":{ke(r,qe.base64,n.message,t);break}}break}case"nanoid":ke(r,qe.nanoid,n.message,t)}return r}function Qr(e,t){return t.patternStrategy==="escape"?Gm(e):e}var Jm=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Gm(e){let t="";for(let r=0;r<e.length;r++)Jm.has(e[r])||(t+="\\"),t+=e[r];return t}function Ue(e,t,r,n){var a;e.format||(a=e.anyOf)!=null&&a.some(o=>o.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...r&&n.errorMessages&&{errorMessage:{format:r}}})):e.format=t}function ke(e,t,r,n){var a;e.pattern||(a=e.allOf)!=null&&a.some(o=>o.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:qa(t,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):e.pattern=qa(t,n)}function qa(e,t){var r;if(!t.applyRegexFlags||!e.flags)return e.source;const n={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=n.i?e.source.toLowerCase():e.source;let o="",s=!1,i=!1,l=!1;for(let u=0;u<a.length;u++){if(s){o+=a[u],s=!1;continue}if(n.i){if(i){if(a[u].match(/[a-z]/)){l?(o+=a[u],o+=`${a[u-2]}-${a[u]}`.toUpperCase(),l=!1):a[u+1]==="-"&&((r=a[u+2])!=null&&r.match(/[a-z]/))?(o+=a[u],l=!0):o+=`${a[u]}${a[u].toUpperCase()}`;continue}}else if(a[u].match(/[a-z]/)){o+=`[${a[u]}${a[u].toUpperCase()}]`;continue}}if(n.m){if(a[u]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(a[u]==="$"){o+=`($|(?=[\r
]))`;continue}}if(n.s&&a[u]==="."){o+=i?`${a[u]}\r
`:`[${a[u]}\r
]`;continue}o+=a[u],a[u]==="\\"?s=!0:i&&a[u]==="]"?i=!1:!i&&a[u]==="["&&(i=!0)}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return o}function ki(e,t){var r,n,a,o,s,i;const l={type:"object",additionalProperties:(r=J(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))!=null?r:t.allowedAdditionalProperties};if(((n=e.keyType)==null?void 0:n._def.typeName)===T.ZodString&&((a=e.keyType._def.checks)!=null&&a.length)){const{type:u,...d}=Ii(e.keyType._def,t);return{...l,propertyNames:d}}else{if(((o=e.keyType)==null?void 0:o._def.typeName)===T.ZodEnum)return{...l,propertyNames:{enum:e.keyType._def.values}};if(((s=e.keyType)==null?void 0:s._def.typeName)===T.ZodBranded&&e.keyType._def.type._def.typeName===T.ZodString&&((i=e.keyType._def.type._def.checks)!=null&&i.length)){const{type:u,...d}=bi(e.keyType._def,t);return{...l,propertyNames:d}}}return l}function Wm(e,t){if(t.mapStrategy==="record")return ki(e,t);const r=J(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||Ce(),n=J(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||Ce();return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function Hm(e){const t=e.values,n=Object.keys(e.values).filter(o=>typeof t[t[o]]!="number").map(o=>t[o]),a=Array.from(new Set(n.map(o=>typeof o)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:n}}function Km(){return{not:Ce()}}function Ym(){return{type:"null"}}var bn={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Xm(e,t){const r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(n=>n._def.typeName in bn&&(!n._def.checks||!n._def.checks.length))){const n=r.reduce((a,o)=>{const s=bn[o._def.typeName];return s&&!a.includes(s)?[...a,s]:a},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=r.reduce((a,o)=>{const s=typeof o._def.value;switch(s){case"string":case"number":case"boolean":return[...a,s];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(n.length===r.length){const a=n.filter((o,s,i)=>i.indexOf(o)===s);return{type:a.length>1?a:a[0],enum:r.reduce((o,s)=>o.includes(s._def.value)?o:[...o,s._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,a)=>[...n,...a._def.values.filter(o=>!n.includes(o))],[])};return Qm(e,t)}var Qm=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((n,a)=>J(n._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!t.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function eh(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[bn[e.innerType._def.typeName],"null"]};const r=J(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function th(e){const t={type:"number"};if(!e.checks)return t;for(const r of e.checks)switch(r.kind){case"int":t.type="integer";break;case"min":r.inclusive?t.minimum=r.value:t.exclusiveMinimum=r.value;break;case"max":r.inclusive?t.maximum=r.value:t.exclusiveMaximum=r.value;break;case"multipleOf":t.multipleOf=r.value;break}return t}function rh(e,t){const r={type:"object",properties:{}},n=[],a=e.shape();for(const s in a){let i=a[s];if(i===void 0||i._def===void 0)continue;const l=ah(i),u=J(i._def,{...t,currentPath:[...t.currentPath,"properties",s],propertyPath:[...t.currentPath,"properties",s]});u!==void 0&&(r.properties[s]=u,l||n.push(s))}n.length&&(r.required=n);const o=nh(e,t);return o!==void 0&&(r.additionalProperties=o),r}function nh(e,t){if(e.catchall._def.typeName!=="ZodNever")return J(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function ah(e){try{return e.isOptional()}catch{return!0}}var oh=(e,t)=>{var r;if(t.currentPath.toString()===((r=t.propertyPath)==null?void 0:r.toString()))return J(e.innerType._def,t);const n=J(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:Ce()},n]}:Ce()},sh=(e,t)=>{if(t.pipeStrategy==="input")return J(e.in._def,t);if(t.pipeStrategy==="output")return J(e.out._def,t);const r=J(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),n=J(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(a=>a!==void 0)}};function ih(e,t){return J(e.type._def,t)}function uh(e,t){const n={type:"array",uniqueItems:!0,items:J(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&(n.minItems=e.minSize.value),e.maxSize&&(n.maxItems=e.maxSize.value),n}function lh(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((r,n)=>J(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:J(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((r,n)=>J(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function ch(){return{not:Ce()}}function dh(){return Ce()}var ph=(e,t)=>J(e.innerType._def,t),fh=(e,t,r)=>{switch(t){case T.ZodString:return Ii(e,r);case T.ZodNumber:return th(e);case T.ZodObject:return rh(e,r);case T.ZodBigInt:return zm(e);case T.ZodBoolean:return Zm();case T.ZodDate:return wi(e,r);case T.ZodUndefined:return ch();case T.ZodNull:return Ym();case T.ZodArray:return Mm(e,r);case T.ZodUnion:case T.ZodDiscriminatedUnion:return Xm(e,r);case T.ZodIntersection:return Vm(e,r);case T.ZodTuple:return lh(e,r);case T.ZodRecord:return ki(e,r);case T.ZodLiteral:return Bm(e);case T.ZodEnum:return Fm(e);case T.ZodNativeEnum:return Hm(e);case T.ZodNullable:return eh(e,r);case T.ZodOptional:return oh(e,r);case T.ZodMap:return Wm(e,r);case T.ZodSet:return uh(e,r);case T.ZodLazy:return()=>e.getter()._def;case T.ZodPromise:return ih(e,r);case T.ZodNaN:case T.ZodNever:return Km();case T.ZodEffects:return Um(e,r);case T.ZodAny:return Ce();case T.ZodUnknown:return dh();case T.ZodDefault:return qm(e,r);case T.ZodBranded:return bi(e,r);case T.ZodReadonly:return ph(e,r);case T.ZodCatch:return jm(e,r);case T.ZodPipeline:return sh(e,r);case T.ZodFunction:case T.ZodVoid:case T.ZodSymbol:return;default:return(n=>{})()}};function J(e,t,r=!1){var n;const a=t.seen.get(e);if(t.override){const l=(n=t.override)==null?void 0:n.call(t,e,t,a,r);if(l!==Pm)return l}if(a&&!r){const l=mh(a,t);if(l!==void 0)return l}const o={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,o);const s=fh(e,e.typeName,t),i=typeof s=="function"?J(s(),t):s;if(i&&hh(e,t,i),t.postProcess){const l=t.postProcess(i,e,t);return o.jsonSchema=i,l}return o.jsonSchema=i,i}var mh=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Nm(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((r,n)=>t.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),Ce()):t.$refStrategy==="seen"?Ce():void 0}},hh=(e,t,r)=>(e.description&&(r.description=e.description),r),gh=e=>{const t=Rm(e),r=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([n,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,n],jsonSchema:void 0}]))}},vh=(e,t)=>{var r;const n=gh(t);let a=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((u,[d,m])=>{var p;return{...u,[d]:(p=J(m._def,{...n,currentPath:[...n.basePath,n.definitionPath,d]},!0))!=null?p:Ce()}},{}):void 0;const o=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,s=(r=J(e._def,o===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,o]},!1))!=null?r:Ce(),i=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;i!==void 0&&(s.title=i);const l=o===void 0?a?{...s,[n.definitionPath]:a}:s:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,o].join("/"),[n.definitionPath]:{...a,[o]:s}};return l.$schema="http://json-schema.org/draft-07/schema#",l},yh=vh;function _h(e,t){var r;const n=(r=void 0)!=null?r:!1;return xi(()=>yh(e,{$refStrategy:n?"root":"none"}),{validate:async a=>{const o=await e.safeParseAsync(a);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}function bh(e,t){var r;const n=(r=void 0)!=null?r:!1;return xi(()=>ii(e,{target:"draft-7",io:"output",reused:n?"ref":"inline"}),{validate:async a=>{const o=await qn(e,a);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}function wh(e){return"_zod"in e}function V(e,t){return wh(e)?bh(e):_h(e)}var Ih=Symbol.for("vercel.ai.schema");function we(e){let t;return()=>(t==null&&(t=e()),t)}function xi(e,{validate:t}={}){return{[Ih]:!0,_type:void 0,[Ar]:!0,get jsonSchema(){return typeof e=="function"&&(e=e()),e},validate:t}}var{btoa:kh,atob:xh}=globalThis;function Sh(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=xh(t);return Uint8Array.from(r,n=>n.codePointAt(0))}function Th(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return kh(t)}function At(e){return e instanceof Uint8Array?Th(e):e}function Eh(e){return e?.replace(/\/$/,"")}var Jn=g({error:g({message:c(),type:c().nullish(),param:We().nullish(),code:U([c(),S()]).nullish()})}),Ke=Om({errorSchema:Jn,errorToMessage:e=>e.error.message});function $h({prompt:e,systemMessageMode:t="system"}){const r=[],n=[];for(const{role:a,content:o}of e)switch(a){case"system":{switch(t){case"system":{r.push({role:"system",content:o});break}case"developer":{r.push({role:"developer",content:o});break}case"remove":{n.push({type:"other",message:"system messages are removed for this model"});break}default:{const s=t;throw new Error(`Unsupported system message mode: ${s}`)}}break}case"user":{if(o.length===1&&o[0].type==="text"){r.push({role:"user",content:o[0].text});break}r.push({role:"user",content:o.map((s,i)=>{var l,u,d;switch(s.type){case"text":return{type:"text",text:s.text};case"file":if(s.mediaType.startsWith("image/")){const m=s.mediaType==="image/*"?"image/jpeg":s.mediaType;return{type:"image_url",image_url:{url:s.data instanceof URL?s.data.toString():`data:${m};base64,${At(s.data)}`,detail:(u=(l=s.providerOptions)==null?void 0:l.openai)==null?void 0:u.imageDetail}}}else if(s.mediaType.startsWith("audio/")){if(s.data instanceof URL)throw new rt({functionality:"audio file parts with URLs"});switch(s.mediaType){case"audio/wav":return{type:"input_audio",input_audio:{data:At(s.data),format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:At(s.data),format:"mp3"}};default:throw new rt({functionality:`audio content parts with media type ${s.mediaType}`})}}else if(s.mediaType==="application/pdf"){if(s.data instanceof URL)throw new rt({functionality:"PDF file parts with URLs"});return{type:"file",file:typeof s.data=="string"&&s.data.startsWith("file-")?{file_id:s.data}:{filename:(d=s.filename)!=null?d:`part-${i}.pdf`,file_data:`data:application/pdf;base64,${At(s.data)}`}}}else throw new rt({functionality:`file part media type ${s.mediaType}`})}})});break}case"assistant":{let s="";const i=[];for(const l of o)switch(l.type){case"text":{s+=l.text;break}case"tool-call":{i.push({id:l.toolCallId,type:"function",function:{name:l.toolName,arguments:JSON.stringify(l.input)}});break}}r.push({role:"assistant",content:s,tool_calls:i.length>0?i:void 0});break}case"tool":{for(const s of o){const i=s.output;let l;switch(i.type){case"text":case"error-text":l=i.value;break;case"content":case"json":case"error-json":l=JSON.stringify(i.value);break}r.push({role:"tool",tool_call_id:s.toolCallId,content:l})}break}default:{const s=a;throw new Error(`Unsupported role: ${s}`)}}return{messages:r,warnings:n}}function Ua({id:e,model:t,created:r}){return{id:e??void 0,modelId:t??void 0,timestamp:r!=null?new Date(r*1e3):void 0}}function Fa(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var Ah=Te(()=>V(g({id:c().nullish(),created:S().nullish(),model:c().nullish(),choices:C(g({message:g({role:x("assistant").nullish(),content:c().nullish(),tool_calls:C(g({id:c().nullish(),type:x("function"),function:g({name:c(),arguments:c()})})).nullish(),annotations:C(g({type:x("url_citation"),start_index:S(),end_index:S(),url:c(),title:c()})).nullish()}),index:S(),logprobs:g({content:C(g({token:c(),logprob:S(),top_logprobs:C(g({token:c(),logprob:S()}))})).nullish()}).nullish(),finish_reason:c().nullish()})),usage:g({prompt_tokens:S().nullish(),completion_tokens:S().nullish(),total_tokens:S().nullish(),prompt_tokens_details:g({cached_tokens:S().nullish()}).nullish(),completion_tokens_details:g({reasoning_tokens:S().nullish(),accepted_prediction_tokens:S().nullish(),rejected_prediction_tokens:S().nullish()}).nullish()}).nullish()}))),Oh=Te(()=>V(U([g({id:c().nullish(),created:S().nullish(),model:c().nullish(),choices:C(g({delta:g({role:oe(["assistant"]).nullish(),content:c().nullish(),tool_calls:C(g({index:S(),id:c().nullish(),type:x("function").nullish(),function:g({name:c().nullish(),arguments:c().nullish()})})).nullish(),annotations:C(g({type:x("url_citation"),start_index:S(),end_index:S(),url:c(),title:c()})).nullish()}).nullish(),logprobs:g({content:C(g({token:c(),logprob:S(),top_logprobs:C(g({token:c(),logprob:S()}))})).nullish()}).nullish(),finish_reason:c().nullish(),index:S()})),usage:g({prompt_tokens:S().nullish(),completion_tokens:S().nullish(),total_tokens:S().nullish(),prompt_tokens_details:g({cached_tokens:S().nullish()}).nullish(),completion_tokens_details:g({reasoning_tokens:S().nullish(),accepted_prediction_tokens:S().nullish(),rejected_prediction_tokens:S().nullish()}).nullish()}).nullish()}),Jn]))),Ch=Te(()=>V(g({logitBias:ge(um(),S()).optional(),logprobs:U([ce(),S()]).optional(),parallelToolCalls:ce().optional(),user:c().optional(),reasoningEffort:oe(["minimal","low","medium","high"]).optional(),maxCompletionTokens:S().optional(),store:ce().optional(),metadata:ge(c().max(64),c().max(512)).optional(),prediction:ge(c(),We()).optional(),structuredOutputs:ce().optional(),serviceTier:oe(["auto","flex","priority","default"]).optional(),strictJsonSchema:ce().optional(),textVerbosity:oe(["low","medium","high"]).optional(),promptCacheKey:c().optional(),safetyIdentifier:c().optional()})));function Nh({tools:e,toolChoice:t,structuredOutputs:r,strictJsonSchema:n}){e=e?.length?e:void 0;const a=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:a};const o=[];for(const i of e)switch(i.type){case"function":o.push({type:"function",function:{name:i.name,description:i.description,parameters:i.inputSchema,strict:r?n:void 0}});break;default:a.push({type:"unsupported-tool",tool:i});break}if(t==null)return{tools:o,toolChoice:void 0,toolWarnings:a};const s=t.type;switch(s){case"auto":case"none":case"required":return{tools:o,toolChoice:s,toolWarnings:a};case"tool":return{tools:o,toolChoice:{type:"function",function:{name:t.toolName}},toolWarnings:a};default:{const i=s;throw new rt({functionality:`tool choice type: ${i}`})}}}var Ph=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:r,topP:n,topK:a,frequencyPenalty:o,presencePenalty:s,stopSequences:i,responseFormat:l,seed:u,tools:d,toolChoice:m,providerOptions:p}){var h,f,y,_;const b=[],I=(h=await lt({provider:"openai",providerOptions:p,schema:Ch}))!=null?h:{},v=(f=I.structuredOutputs)!=null?f:!0;a!=null&&b.push({type:"unsupported-setting",setting:"topK"}),l?.type==="json"&&l.schema!=null&&!v&&b.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});const{messages:A,warnings:$}=$h({prompt:e,systemMessageMode:zh(this.modelId)});b.push(...$);const P=(y=I.strictJsonSchema)!=null?y:!1,E={model:this.modelId,logit_bias:I.logitBias,logprobs:I.logprobs===!0||typeof I.logprobs=="number"?!0:void 0,top_logprobs:typeof I.logprobs=="number"?I.logprobs:typeof I.logprobs=="boolean"&&I.logprobs?0:void 0,user:I.user,parallel_tool_calls:I.parallelToolCalls,max_tokens:t,temperature:r,top_p:n,frequency_penalty:o,presence_penalty:s,response_format:l?.type==="json"?v&&l.schema!=null?{type:"json_schema",json_schema:{schema:l.schema,strict:P,name:(_=l.name)!=null?_:"response",description:l.description}}:{type:"json_object"}:void 0,stop:i,seed:u,verbosity:I.textVerbosity,max_completion_tokens:I.maxCompletionTokens,store:I.store,metadata:I.metadata,prediction:I.prediction,reasoning_effort:I.reasoningEffort,service_tier:I.serviceTier,prompt_cache_key:I.promptCacheKey,safety_identifier:I.safetyIdentifier,messages:A};Si(this.modelId)?(E.temperature!=null&&(E.temperature=void 0,b.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),E.top_p!=null&&(E.top_p=void 0,b.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),E.frequency_penalty!=null&&(E.frequency_penalty=void 0,b.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),E.presence_penalty!=null&&(E.presence_penalty=void 0,b.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),E.logit_bias!=null&&(E.logit_bias=void 0,b.push({type:"other",message:"logitBias is not supported for reasoning models"})),E.logprobs!=null&&(E.logprobs=void 0,b.push({type:"other",message:"logprobs is not supported for reasoning models"})),E.top_logprobs!=null&&(E.top_logprobs=void 0,b.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),E.max_tokens!=null&&(E.max_completion_tokens==null&&(E.max_completion_tokens=E.max_tokens),E.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&E.temperature!=null&&(E.temperature=void 0,b.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),I.serviceTier==="flex"&&!Rh(this.modelId)&&(b.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),E.service_tier=void 0),I.serviceTier==="priority"&&!Mh(this.modelId)&&(b.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),E.service_tier=void 0);const{tools:j,toolChoice:Z,toolWarnings:K}=Nh({tools:d,toolChoice:m,structuredOutputs:v,strictJsonSchema:P});return{args:{...E,tools:j,tool_choice:Z},warnings:[...b,...K]}}async doGenerate(e){var t,r,n,a,o,s,i,l,u,d,m,p,h,f;const{args:y,warnings:_}=await this.getArgs(e),{responseHeaders:b,value:I,rawValue:v}=await at({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),body:y,failedResponseHandler:Ke,successfulResponseHandler:zt(Ah),abortSignal:e.abortSignal,fetch:this.config.fetch}),A=I.choices[0],$=[],P=A.message.content;P!=null&&P.length>0&&$.push({type:"text",text:P});for(const K of(t=A.message.tool_calls)!=null?t:[])$.push({type:"tool-call",toolCallId:(r=K.id)!=null?r:tt(),toolName:K.function.name,input:K.function.arguments});for(const K of(n=A.message.annotations)!=null?n:[])$.push({type:"source",sourceType:"url",id:tt(),url:K.url,title:K.title});const E=(a=I.usage)==null?void 0:a.completion_tokens_details,j=(o=I.usage)==null?void 0:o.prompt_tokens_details,Z={openai:{}};return E?.accepted_prediction_tokens!=null&&(Z.openai.acceptedPredictionTokens=E?.accepted_prediction_tokens),E?.rejected_prediction_tokens!=null&&(Z.openai.rejectedPredictionTokens=E?.rejected_prediction_tokens),((s=A.logprobs)==null?void 0:s.content)!=null&&(Z.openai.logprobs=A.logprobs.content),{content:$,finishReason:Fa(A.finish_reason),usage:{inputTokens:(l=(i=I.usage)==null?void 0:i.prompt_tokens)!=null?l:void 0,outputTokens:(d=(u=I.usage)==null?void 0:u.completion_tokens)!=null?d:void 0,totalTokens:(p=(m=I.usage)==null?void 0:m.total_tokens)!=null?p:void 0,reasoningTokens:(h=E?.reasoning_tokens)!=null?h:void 0,cachedInputTokens:(f=j?.cached_tokens)!=null?f:void 0},request:{body:y},response:{...Ua(I),headers:b,body:v},warnings:_,providerMetadata:Z}}async doStream(e){const{args:t,warnings:r}=await this.getArgs(e),n={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:a,value:o}=await at({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),body:n,failedResponseHandler:Ke,successfulResponseHandler:Bn(Oh),abortSignal:e.abortSignal,fetch:this.config.fetch}),s=[];let i="unknown";const l={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let u=!0,d=!1;const m={openai:{}};return{stream:o.pipeThrough(new TransformStream({start(p){p.enqueue({type:"stream-start",warnings:r})},transform(p,h){var f,y,_,b,I,v,A,$,P,E,j,Z,K,q,ye,ae,Y,z,Q,W,je,Ye,ve,Xe;if(e.includeRawChunks&&h.enqueue({type:"raw",rawValue:p.rawValue}),!p.success){i="error",h.enqueue({type:"error",error:p.error});return}const ee=p.value;if("error"in ee){i="error",h.enqueue({type:"error",error:ee.error});return}u&&(u=!1,h.enqueue({type:"response-metadata",...Ua(ee)})),ee.usage!=null&&(l.inputTokens=(f=ee.usage.prompt_tokens)!=null?f:void 0,l.outputTokens=(y=ee.usage.completion_tokens)!=null?y:void 0,l.totalTokens=(_=ee.usage.total_tokens)!=null?_:void 0,l.reasoningTokens=(I=(b=ee.usage.completion_tokens_details)==null?void 0:b.reasoning_tokens)!=null?I:void 0,l.cachedInputTokens=(A=(v=ee.usage.prompt_tokens_details)==null?void 0:v.cached_tokens)!=null?A:void 0,(($=ee.usage.completion_tokens_details)==null?void 0:$.accepted_prediction_tokens)!=null&&(m.openai.acceptedPredictionTokens=(P=ee.usage.completion_tokens_details)==null?void 0:P.accepted_prediction_tokens),((E=ee.usage.completion_tokens_details)==null?void 0:E.rejected_prediction_tokens)!=null&&(m.openai.rejectedPredictionTokens=(j=ee.usage.completion_tokens_details)==null?void 0:j.rejected_prediction_tokens));const pe=ee.choices[0];if(pe?.finish_reason!=null&&(i=Fa(pe.finish_reason)),((Z=pe?.logprobs)==null?void 0:Z.content)!=null&&(m.openai.logprobs=pe.logprobs.content),pe?.delta==null)return;const w=pe.delta;if(w.content!=null&&(d||(h.enqueue({type:"text-start",id:"0"}),d=!0),h.enqueue({type:"text-delta",id:"0",delta:w.content})),w.tool_calls!=null)for(const M of w.tool_calls){const Re=M.index;if(s[Re]==null){if(M.type!=="function")throw new Wr({data:M,message:"Expected 'function' type."});if(M.id==null)throw new Wr({data:M,message:"Expected 'id' to be a string."});if(((K=M.function)==null?void 0:K.name)==null)throw new Wr({data:M,message:"Expected 'function.name' to be a string."});h.enqueue({type:"tool-input-start",id:M.id,toolName:M.function.name}),s[Re]={id:M.id,type:"function",function:{name:M.function.name,arguments:(q=M.function.arguments)!=null?q:""},hasFinished:!1};const be=s[Re];((ye=be.function)==null?void 0:ye.name)!=null&&((ae=be.function)==null?void 0:ae.arguments)!=null&&(be.function.arguments.length>0&&h.enqueue({type:"tool-input-delta",id:be.id,delta:be.function.arguments}),ja(be.function.arguments)&&(h.enqueue({type:"tool-input-end",id:be.id}),h.enqueue({type:"tool-call",toolCallId:(Y=be.id)!=null?Y:tt(),toolName:be.function.name,input:be.function.arguments}),be.hasFinished=!0));continue}const se=s[Re];se.hasFinished||(((z=M.function)==null?void 0:z.arguments)!=null&&(se.function.arguments+=(W=(Q=M.function)==null?void 0:Q.arguments)!=null?W:""),h.enqueue({type:"tool-input-delta",id:se.id,delta:(je=M.function.arguments)!=null?je:""}),((Ye=se.function)==null?void 0:Ye.name)!=null&&((ve=se.function)==null?void 0:ve.arguments)!=null&&ja(se.function.arguments)&&(h.enqueue({type:"tool-input-end",id:se.id}),h.enqueue({type:"tool-call",toolCallId:(Xe=se.id)!=null?Xe:tt(),toolName:se.function.name,input:se.function.arguments}),se.hasFinished=!0))}if(w.annotations!=null)for(const M of w.annotations)h.enqueue({type:"source",sourceType:"url",id:tt(),url:M.url,title:M.title})},flush(p){d&&p.enqueue({type:"text-end",id:"0"}),p.enqueue({type:"finish",finishReason:i,usage:l,...m!=null?{providerMetadata:m}:{}})}})),request:{body:n},response:{headers:a}}}};function Si(e){return(e.startsWith("o")||e.startsWith("gpt-5"))&&!e.startsWith("gpt-5-chat")}function Rh(e){return e.startsWith("o3")||e.startsWith("o4-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-chat")}function Mh(e){return e.startsWith("gpt-4")||e.startsWith("gpt-5-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-nano")&&!e.startsWith("gpt-5-chat")||e.startsWith("o3")||e.startsWith("o4-mini")}function zh(e){var t,r;return Si(e)?(r=(t=Zh[e])==null?void 0:t.systemMessageMode)!=null?r:"developer":"system"}var Zh={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function jh({prompt:e,user:t="user",assistant:r="assistant"}){let n="";e[0].role==="system"&&(n+=`${e[0].content}

`,e=e.slice(1));for(const{role:a,content:o}of e)switch(a){case"system":throw new Pl({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{const s=o.map(i=>{switch(i.type){case"text":return i.text}}).filter(Boolean).join("");n+=`${t}:
${s}

`;break}case"assistant":{const s=o.map(i=>{switch(i.type){case"text":return i.text;case"tool-call":throw new rt({functionality:"tool-call messages"})}}).join("");n+=`${r}:
${s}

`;break}case"tool":throw new rt({functionality:"tool messages"});default:{const s=a;throw new Error(`Unsupported role: ${s}`)}}return n+=`${r}:
`,{prompt:n,stopSequences:[`
${t}:`]}}function La({id:e,model:t,created:r}){return{id:e??void 0,modelId:t??void 0,timestamp:r!=null?new Date(r*1e3):void 0}}function Va(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var Dh=Te(()=>V(g({id:c().nullish(),created:S().nullish(),model:c().nullish(),choices:C(g({text:c(),finish_reason:c(),logprobs:g({tokens:C(c()),token_logprobs:C(S()),top_logprobs:C(ge(c(),S())).nullish()}).nullish()})),usage:g({prompt_tokens:S(),completion_tokens:S(),total_tokens:S()}).nullish()}))),qh=Te(()=>V(U([g({id:c().nullish(),created:S().nullish(),model:c().nullish(),choices:C(g({text:c(),finish_reason:c().nullish(),index:S(),logprobs:g({tokens:C(c()),token_logprobs:C(S()),top_logprobs:C(ge(c(),S())).nullish()}).nullish()})),usage:g({prompt_tokens:S(),completion_tokens:S(),total_tokens:S()}).nullish()}),Jn]))),Ba=Te(()=>V(g({echo:ce().optional(),logitBias:ge(c(),S()).optional(),suffix:c().optional(),user:c().optional(),logprobs:U([ce(),S()]).optional()}))),Uh=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={},this.modelId=e,this.config=t}get providerOptionsName(){return this.config.provider.split(".")[0].trim()}get provider(){return this.config.provider}async getArgs({prompt:e,maxOutputTokens:t,temperature:r,topP:n,topK:a,frequencyPenalty:o,presencePenalty:s,stopSequences:i,responseFormat:l,tools:u,toolChoice:d,seed:m,providerOptions:p}){const h=[],f={...await lt({provider:"openai",providerOptions:p,schema:Ba}),...await lt({provider:this.providerOptionsName,providerOptions:p,schema:Ba})};a!=null&&h.push({type:"unsupported-setting",setting:"topK"}),u?.length&&h.push({type:"unsupported-setting",setting:"tools"}),d!=null&&h.push({type:"unsupported-setting",setting:"toolChoice"}),l!=null&&l.type!=="text"&&h.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});const{prompt:y,stopSequences:_}=jh({prompt:e}),b=[..._??[],...i??[]];return{args:{model:this.modelId,echo:f.echo,logit_bias:f.logitBias,logprobs:f?.logprobs===!0?0:f?.logprobs===!1?void 0:f?.logprobs,suffix:f.suffix,user:f.user,max_tokens:t,temperature:r,top_p:n,frequency_penalty:o,presence_penalty:s,seed:m,prompt:y,stop:b.length>0?b:void 0},warnings:h}}async doGenerate(e){var t,r,n;const{args:a,warnings:o}=await this.getArgs(e),{responseHeaders:s,value:i,rawValue:l}=await at({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),body:a,failedResponseHandler:Ke,successfulResponseHandler:zt(Dh),abortSignal:e.abortSignal,fetch:this.config.fetch}),u=i.choices[0],d={openai:{}};return u.logprobs!=null&&(d.openai.logprobs=u.logprobs),{content:[{type:"text",text:u.text}],usage:{inputTokens:(t=i.usage)==null?void 0:t.prompt_tokens,outputTokens:(r=i.usage)==null?void 0:r.completion_tokens,totalTokens:(n=i.usage)==null?void 0:n.total_tokens},finishReason:Va(u.finish_reason),request:{body:a},response:{...La(i),headers:s,body:l},providerMetadata:d,warnings:o}}async doStream(e){const{args:t,warnings:r}=await this.getArgs(e),n={...t,stream:!0,stream_options:{include_usage:!0}},{responseHeaders:a,value:o}=await at({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),body:n,failedResponseHandler:Ke,successfulResponseHandler:Bn(qh),abortSignal:e.abortSignal,fetch:this.config.fetch});let s="unknown";const i={openai:{}},l={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};let u=!0;return{stream:o.pipeThrough(new TransformStream({start(d){d.enqueue({type:"stream-start",warnings:r})},transform(d,m){if(e.includeRawChunks&&m.enqueue({type:"raw",rawValue:d.rawValue}),!d.success){s="error",m.enqueue({type:"error",error:d.error});return}const p=d.value;if("error"in p){s="error",m.enqueue({type:"error",error:p.error});return}u&&(u=!1,m.enqueue({type:"response-metadata",...La(p)}),m.enqueue({type:"text-start",id:"0"})),p.usage!=null&&(l.inputTokens=p.usage.prompt_tokens,l.outputTokens=p.usage.completion_tokens,l.totalTokens=p.usage.total_tokens);const h=p.choices[0];h?.finish_reason!=null&&(s=Va(h.finish_reason)),h?.logprobs!=null&&(i.openai.logprobs=h.logprobs),h?.text!=null&&h.text.length>0&&m.enqueue({type:"text-delta",id:"0",delta:h.text})},flush(d){u||d.enqueue({type:"text-end",id:"0"}),d.enqueue({type:"finish",finishReason:s,providerMetadata:i,usage:l})}})),request:{body:n},response:{headers:a}}}},Fh=Te(()=>V(g({dimensions:S().optional(),user:c().optional()}))),Lh=Te(()=>V(g({data:C(g({embedding:C(S())})),usage:g({prompt_tokens:S()}).nullish()}))),Vh=class{constructor(e,t){this.specificationVersion="v2",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:r,providerOptions:n}){var a;if(e.length>this.maxEmbeddingsPerCall)throw new jl({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});const o=(a=await lt({provider:"openai",providerOptions:n,schema:Fh}))!=null?a:{},{responseHeaders:s,value:i,rawValue:l}=await at({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:He(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:o.dimensions,user:o.user},failedResponseHandler:Ke,successfulResponseHandler:zt(Lh),abortSignal:r,fetch:this.config.fetch});return{embeddings:i.data.map(u=>u.embedding),usage:i.usage?{tokens:i.usage.prompt_tokens}:void 0,response:{headers:s,body:l}}}},Bh=Te(()=>V(g({data:C(g({b64_json:c(),revised_prompt:c().optional()}))}))),Jh={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10,"gpt-image-1-mini":10},Gh=new Set(["gpt-image-1","gpt-image-1-mini"]),Wh=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get maxImagesPerCall(){var e;return(e=Jh[this.modelId])!=null?e:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:r,aspectRatio:n,seed:a,providerOptions:o,headers:s,abortSignal:i}){var l,u,d,m;const p=[];n!=null&&p.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),a!=null&&p.push({type:"unsupported-setting",setting:"seed"});const h=(d=(u=(l=this.config._internal)==null?void 0:l.currentDate)==null?void 0:u.call(l))!=null?d:new Date,{value:f,responseHeaders:y}=await at({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:He(this.config.headers(),s),body:{model:this.modelId,prompt:e,n:t,size:r,...(m=o.openai)!=null?m:{},...Gh.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:Ke,successfulResponseHandler:zt(Bh),abortSignal:i,fetch:this.config.fetch});return{images:f.data.map(_=>_.b64_json),warnings:p,response:{timestamp:h,modelId:this.modelId,headers:y},providerMetadata:{openai:{images:f.data.map(_=>_.revised_prompt?{revisedPrompt:_.revised_prompt}:null)}}}}},Hh=we(()=>V(g({code:c().nullish(),containerId:c()}))),Kh=we(()=>V(g({outputs:C(Ee("type",[g({type:x("logs"),logs:c()}),g({type:x("image"),url:c()})])).nullish()}))),Yh=we(()=>V(g({container:U([c(),g({fileIds:C(c()).optional()})]).optional()}))),Xh=Mt({id:"openai.code_interpreter",name:"code_interpreter",inputSchema:Hh,outputSchema:Kh}),Qh=(e={})=>Xh(e),Ti=g({key:c(),type:oe(["eq","ne","gt","gte","lt","lte"]),value:U([c(),S(),ce()])}),Ei=g({type:oe(["and","or"]),filters:C(U([Ti,hi(()=>Ei)]))}),eg=we(()=>V(g({vectorStoreIds:C(c()),maxNumResults:S().optional(),ranking:g({ranker:c().optional(),scoreThreshold:S().optional()}).optional(),filters:U([Ti,Ei]).optional()}))),tg=we(()=>V(g({queries:C(c()),results:C(g({attributes:ge(c(),Ve()),fileId:c(),filename:c(),score:S(),text:c()})).nullable()}))),rg=Mt({id:"openai.file_search",name:"file_search",inputSchema:g({}),outputSchema:tg}),ng=we(()=>V(g({background:oe(["auto","opaque","transparent"]).optional(),inputFidelity:oe(["low","high"]).optional(),inputImageMask:g({fileId:c().optional(),imageUrl:c().optional()}).optional(),model:c().optional(),moderation:oe(["auto"]).optional(),outputCompression:S().int().min(0).max(100).optional(),outputFormat:oe(["png","jpeg","webp"]).optional(),partialImages:S().int().min(0).max(3).optional(),quality:oe(["auto","low","medium","high"]).optional(),size:oe(["1024x1024","1024x1536","1536x1024","auto"]).optional()}).strict())),ag=we(()=>V(g({}))),og=we(()=>V(g({result:c()}))),sg=Mt({id:"openai.image_generation",name:"image_generation",inputSchema:ag,outputSchema:og}),ig=(e={})=>sg(e),$i=we(()=>V(g({action:g({type:x("exec"),command:C(c()),timeoutMs:S().optional(),user:c().optional(),workingDirectory:c().optional(),env:ge(c(),c()).optional()})}))),Ai=we(()=>V(g({output:c()}))),ug=Mt({id:"openai.local_shell",name:"local_shell",inputSchema:$i,outputSchema:Ai}),lg=we(()=>V(g({filters:g({allowedDomains:C(c()).optional()}).optional(),searchContextSize:oe(["low","medium","high"]).optional(),userLocation:g({type:x("approximate"),country:c().optional(),city:c().optional(),region:c().optional(),timezone:c().optional()}).optional()}))),cg=we(()=>V(g({}))),dg=we(()=>V(g({action:Ee("type",[g({type:x("search"),query:c().optional()}),g({type:x("openPage"),url:c()}),g({type:x("find"),url:c(),pattern:c()})])}))),pg=Mt({id:"openai.web_search",name:"web_search",inputSchema:cg,outputSchema:dg}),fg=(e={})=>pg(e),mg=we(()=>V(g({searchContextSize:oe(["low","medium","high"]).optional(),userLocation:g({type:x("approximate"),country:c().optional(),city:c().optional(),region:c().optional(),timezone:c().optional()}).optional()}))),hg=we(()=>V(g({}))),gg=we(()=>V(g({action:Ee("type",[g({type:x("search"),query:c().optional()}),g({type:x("openPage"),url:c()}),g({type:x("find"),url:c(),pattern:c()})])}))),vg=Mt({id:"openai.web_search_preview",name:"web_search_preview",inputSchema:hg,outputSchema:gg}),yg={codeInterpreter:Qh,fileSearch:rg,imageGeneration:ig,localShell:ug,webSearchPreview:vg,webSearch:fg};function Ja(e,t){return t?t.some(r=>e.startsWith(r)):!1}async function _g({prompt:e,systemMessageMode:t,fileIdPrefixes:r,store:n,hasLocalShellTool:a=!1}){var o,s,i,l;const u=[],d=[];for(const{role:m,content:p}of e)switch(m){case"system":{switch(t){case"system":{u.push({role:"system",content:p});break}case"developer":{u.push({role:"developer",content:p});break}case"remove":{d.push({type:"other",message:"system messages are removed for this model"});break}default:{const h=t;throw new Error(`Unsupported system message mode: ${h}`)}}break}case"user":{u.push({role:"user",content:p.map((h,f)=>{var y,_,b;switch(h.type){case"text":return{type:"input_text",text:h.text};case"file":if(h.mediaType.startsWith("image/")){const I=h.mediaType==="image/*"?"image/jpeg":h.mediaType;return{type:"input_image",...h.data instanceof URL?{image_url:h.data.toString()}:typeof h.data=="string"&&Ja(h.data,r)?{file_id:h.data}:{image_url:`data:${I};base64,${At(h.data)}`},detail:(_=(y=h.providerOptions)==null?void 0:y.openai)==null?void 0:_.imageDetail}}else{if(h.mediaType==="application/pdf")return h.data instanceof URL?{type:"input_file",file_url:h.data.toString()}:{type:"input_file",...typeof h.data=="string"&&Ja(h.data,r)?{file_id:h.data}:{filename:(b=h.filename)!=null?b:`part-${f}.pdf`,file_data:`data:application/pdf;base64,${At(h.data)}`}};throw new rt({functionality:`file part media type ${h.mediaType}`})}}})});break}case"assistant":{const h={},f={};for(const y of p)switch(y.type){case"text":{const _=(s=(o=y.providerOptions)==null?void 0:o.openai)==null?void 0:s.itemId;if(n&&_!=null){u.push({type:"item_reference",id:_});break}u.push({role:"assistant",content:[{type:"output_text",text:y.text}],id:_});break}case"tool-call":{if(f[y.toolCallId]=y,y.providerExecuted)break;const _=(l=(i=y.providerOptions)==null?void 0:i.openai)==null?void 0:l.itemId;if(n&&_!=null){u.push({type:"item_reference",id:_});break}if(a&&y.toolName==="local_shell"){const b=await st({value:y.input,schema:$i});u.push({type:"local_shell_call",call_id:y.toolCallId,id:_,action:{type:"exec",command:b.action.command,timeout_ms:b.action.timeoutMs,user:b.action.user,working_directory:b.action.workingDirectory,env:b.action.env}});break}u.push({type:"function_call",call_id:y.toolCallId,name:y.toolName,arguments:JSON.stringify(y.input),id:_});break}case"tool-result":{n?u.push({type:"item_reference",id:y.toolCallId}):d.push({type:"other",message:`Results for OpenAI tool ${y.toolName} are not sent to the API when store is false`});break}case"reasoning":{const _=await lt({provider:"openai",providerOptions:y.providerOptions,schema:bg}),b=_?.itemId;if(b!=null){const I=h[b];if(n)I===void 0&&(u.push({type:"item_reference",id:b}),h[b]={type:"reasoning",id:b,summary:[]});else{const v=[];y.text.length>0?v.push({type:"summary_text",text:y.text}):I!==void 0&&d.push({type:"other",message:`Cannot append empty reasoning part to existing reasoning sequence. Skipping reasoning part: ${JSON.stringify(y)}.`}),I===void 0?(h[b]={type:"reasoning",id:b,encrypted_content:_?.reasoningEncryptedContent,summary:v},u.push(h[b])):(I.summary.push(...v),_?.reasoningEncryptedContent!=null&&(I.encrypted_content=_.reasoningEncryptedContent))}}else d.push({type:"other",message:`Non-OpenAI reasoning parts are not supported. Skipping reasoning part: ${JSON.stringify(y)}.`});break}}break}case"tool":{for(const h of p){const f=h.output;if(a&&h.toolName==="local_shell"&&f.type==="json"){const _=await st({value:f.value,schema:Ai});u.push({type:"local_shell_call_output",call_id:h.toolCallId,output:_.output});break}let y;switch(f.type){case"text":case"error-text":y=f.value;break;case"json":case"error-json":y=JSON.stringify(f.value);break;case"content":y=f.value.map(_=>{switch(_.type){case"text":return{type:"input_text",text:_.text};case"media":return _.mediaType.startsWith("image/")?{type:"input_image",image_url:`data:${_.mediaType};base64,${_.data}`}:{type:"input_file",filename:"data",file_data:`data:${_.mediaType};base64,${_.data}`}}});break}u.push({type:"function_call_output",call_id:h.toolCallId,output:y})}break}default:{const h=m;throw new Error(`Unsupported role: ${h}`)}}return{input:u,warnings:d}}var bg=g({itemId:c().nullish(),reasoningEncryptedContent:c().nullish()});function Ga({finishReason:e,hasFunctionCall:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}var wg=Te(()=>V(U([g({type:x("response.output_text.delta"),item_id:c(),delta:c(),logprobs:C(g({token:c(),logprob:S(),top_logprobs:C(g({token:c(),logprob:S()}))})).nullish()}),g({type:oe(["response.completed","response.incomplete"]),response:g({incomplete_details:g({reason:c()}).nullish(),usage:g({input_tokens:S(),input_tokens_details:g({cached_tokens:S().nullish()}).nullish(),output_tokens:S(),output_tokens_details:g({reasoning_tokens:S().nullish()}).nullish()}),service_tier:c().nullish()})}),g({type:x("response.created"),response:g({id:c(),created_at:S(),model:c(),service_tier:c().nullish()})}),g({type:x("response.output_item.added"),output_index:S(),item:Ee("type",[g({type:x("message"),id:c()}),g({type:x("reasoning"),id:c(),encrypted_content:c().nullish()}),g({type:x("function_call"),id:c(),call_id:c(),name:c(),arguments:c()}),g({type:x("web_search_call"),id:c(),status:c()}),g({type:x("computer_call"),id:c(),status:c()}),g({type:x("file_search_call"),id:c()}),g({type:x("image_generation_call"),id:c()}),g({type:x("code_interpreter_call"),id:c(),container_id:c(),code:c().nullable(),outputs:C(Ee("type",[g({type:x("logs"),logs:c()}),g({type:x("image"),url:c()})])).nullable(),status:c()})])}),g({type:x("response.output_item.done"),output_index:S(),item:Ee("type",[g({type:x("message"),id:c()}),g({type:x("reasoning"),id:c(),encrypted_content:c().nullish()}),g({type:x("function_call"),id:c(),call_id:c(),name:c(),arguments:c(),status:x("completed")}),g({type:x("code_interpreter_call"),id:c(),code:c().nullable(),container_id:c(),outputs:C(Ee("type",[g({type:x("logs"),logs:c()}),g({type:x("image"),url:c()})])).nullable()}),g({type:x("image_generation_call"),id:c(),result:c()}),g({type:x("web_search_call"),id:c(),status:c(),action:Ee("type",[g({type:x("search"),query:c().nullish()}),g({type:x("open_page"),url:c()}),g({type:x("find"),url:c(),pattern:c()})])}),g({type:x("file_search_call"),id:c(),queries:C(c()),results:C(g({attributes:ge(c(),Ve()),file_id:c(),filename:c(),score:S(),text:c()})).nullish()}),g({type:x("local_shell_call"),id:c(),call_id:c(),action:g({type:x("exec"),command:C(c()),timeout_ms:S().optional(),user:c().optional(),working_directory:c().optional(),env:ge(c(),c()).optional()})}),g({type:x("computer_call"),id:c(),status:x("completed")})])}),g({type:x("response.function_call_arguments.delta"),item_id:c(),output_index:S(),delta:c()}),g({type:x("response.image_generation_call.partial_image"),item_id:c(),output_index:S(),partial_image_b64:c()}),g({type:x("response.code_interpreter_call_code.delta"),item_id:c(),output_index:S(),delta:c()}),g({type:x("response.code_interpreter_call_code.done"),item_id:c(),output_index:S(),code:c()}),g({type:x("response.output_text.annotation.added"),annotation:Ee("type",[g({type:x("url_citation"),url:c(),title:c()}),g({type:x("file_citation"),file_id:c(),filename:c().nullish(),index:S().nullish(),start_index:S().nullish(),end_index:S().nullish(),quote:c().nullish()})])}),g({type:x("response.reasoning_summary_part.added"),item_id:c(),summary_index:S()}),g({type:x("response.reasoning_summary_text.delta"),item_id:c(),summary_index:S(),delta:c()}),g({type:x("response.reasoning_summary_part.done"),item_id:c(),summary_index:S()}),g({type:x("error"),code:c(),message:c(),param:c().nullish(),sequence_number:S()}),g({type:c()}).loose().transform(e=>({type:"unknown_chunk",message:e.type}))]))),Ig=Te(()=>V(g({id:c(),created_at:S(),error:g({code:c(),message:c()}).nullish(),model:c(),output:C(Ee("type",[g({type:x("message"),role:x("assistant"),id:c(),content:C(g({type:x("output_text"),text:c(),logprobs:C(g({token:c(),logprob:S(),top_logprobs:C(g({token:c(),logprob:S()}))})).nullish(),annotations:C(Ee("type",[g({type:x("url_citation"),start_index:S(),end_index:S(),url:c(),title:c()}),g({type:x("file_citation"),file_id:c(),filename:c().nullish(),index:S().nullish(),start_index:S().nullish(),end_index:S().nullish(),quote:c().nullish()}),g({type:x("container_file_citation")})]))}))}),g({type:x("web_search_call"),id:c(),status:c(),action:Ee("type",[g({type:x("search"),query:c().nullish()}),g({type:x("open_page"),url:c()}),g({type:x("find"),url:c(),pattern:c()})])}),g({type:x("file_search_call"),id:c(),queries:C(c()),results:C(g({attributes:ge(c(),Ve()),file_id:c(),filename:c(),score:S(),text:c()})).nullish()}),g({type:x("code_interpreter_call"),id:c(),code:c().nullable(),container_id:c(),outputs:C(Ee("type",[g({type:x("logs"),logs:c()}),g({type:x("image"),url:c()})])).nullable()}),g({type:x("image_generation_call"),id:c(),result:c()}),g({type:x("local_shell_call"),id:c(),call_id:c(),action:g({type:x("exec"),command:C(c()),timeout_ms:S().optional(),user:c().optional(),working_directory:c().optional(),env:ge(c(),c()).optional()})}),g({type:x("function_call"),call_id:c(),name:c(),arguments:c(),id:c()}),g({type:x("computer_call"),id:c(),status:c().optional()}),g({type:x("reasoning"),id:c(),encrypted_content:c().nullish(),summary:C(g({type:x("summary_text"),text:c()}))})])),service_tier:c().nullish(),incomplete_details:g({reason:c()}).nullish(),usage:g({input_tokens:S(),input_tokens_details:g({cached_tokens:S().nullish()}).nullish(),output_tokens:S(),output_tokens_details:g({reasoning_tokens:S().nullish()}).nullish()})}))),Oi=20,kg=Te(()=>V(g({include:C(oe(["reasoning.encrypted_content","file_search_call.results","message.output_text.logprobs"])).nullish(),instructions:c().nullish(),logprobs:U([ce(),S().min(1).max(Oi)]).optional(),maxToolCalls:S().nullish(),metadata:We().nullish(),parallelToolCalls:ce().nullish(),previousResponseId:c().nullish(),promptCacheKey:c().nullish(),reasoningEffort:c().nullish(),reasoningSummary:c().nullish(),safetyIdentifier:c().nullish(),serviceTier:oe(["auto","flex","priority","default"]).nullish(),store:ce().nullish(),strictJsonSchema:ce().nullish(),textVerbosity:oe(["low","medium","high"]).nullish(),user:c().nullish()})));async function xg({tools:e,toolChoice:t,strictJsonSchema:r}){e=e?.length?e:void 0;const n=[];if(e==null)return{tools:void 0,toolChoice:void 0,toolWarnings:n};const a=[];for(const s of e)switch(s.type){case"function":a.push({type:"function",name:s.name,description:s.description,parameters:s.inputSchema,strict:r});break;case"provider-defined":{switch(s.id){case"openai.file_search":{const i=await st({value:s.args,schema:eg});a.push({type:"file_search",vector_store_ids:i.vectorStoreIds,max_num_results:i.maxNumResults,ranking_options:i.ranking?{ranker:i.ranking.ranker,score_threshold:i.ranking.scoreThreshold}:void 0,filters:i.filters});break}case"openai.local_shell":{a.push({type:"local_shell"});break}case"openai.web_search_preview":{const i=await st({value:s.args,schema:mg});a.push({type:"web_search_preview",search_context_size:i.searchContextSize,user_location:i.userLocation});break}case"openai.web_search":{const i=await st({value:s.args,schema:lg});a.push({type:"web_search",filters:i.filters!=null?{allowed_domains:i.filters.allowedDomains}:void 0,search_context_size:i.searchContextSize,user_location:i.userLocation});break}case"openai.code_interpreter":{const i=await st({value:s.args,schema:Yh});a.push({type:"code_interpreter",container:i.container==null?{type:"auto",file_ids:void 0}:typeof i.container=="string"?i.container:{type:"auto",file_ids:i.container.fileIds}});break}case"openai.image_generation":{const i=await st({value:s.args,schema:ng});a.push({type:"image_generation",background:i.background,input_fidelity:i.inputFidelity,input_image_mask:i.inputImageMask?{file_id:i.inputImageMask.fileId,image_url:i.inputImageMask.imageUrl}:void 0,model:i.model,size:i.size,quality:i.quality,moderation:i.moderation,output_format:i.outputFormat,output_compression:i.outputCompression});break}}break}default:n.push({type:"unsupported-tool",tool:s});break}if(t==null)return{tools:a,toolChoice:void 0,toolWarnings:n};const o=t.type;switch(o){case"auto":case"none":case"required":return{tools:a,toolChoice:o,toolWarnings:n};case"tool":return{tools:a,toolChoice:t.toolName==="code_interpreter"||t.toolName==="file_search"||t.toolName==="image_generation"||t.toolName==="web_search_preview"||t.toolName==="web_search"?{type:t.toolName}:{type:"function",name:t.toolName},toolWarnings:n};default:{const s=o;throw new rt({functionality:`tool choice type: ${s}`})}}}var Sg=class{constructor(e,t){this.specificationVersion="v2",this.supportedUrls={"image/*":[/^https?:\/\/.*$/],"application/pdf":[/^https?:\/\/.*$/]},this.modelId=e,this.config=t}get provider(){return this.config.provider}async getArgs({maxOutputTokens:e,temperature:t,stopSequences:r,topP:n,topK:a,presencePenalty:o,frequencyPenalty:s,seed:i,prompt:l,providerOptions:u,tools:d,toolChoice:m,responseFormat:p}){var h,f,y,_;const b=[],I=Mg(this.modelId);a!=null&&b.push({type:"unsupported-setting",setting:"topK"}),i!=null&&b.push({type:"unsupported-setting",setting:"seed"}),o!=null&&b.push({type:"unsupported-setting",setting:"presencePenalty"}),s!=null&&b.push({type:"unsupported-setting",setting:"frequencyPenalty"}),r!=null&&b.push({type:"unsupported-setting",setting:"stopSequences"});const v=await lt({provider:"openai",providerOptions:u,schema:kg}),{input:A,warnings:$}=await _g({prompt:l,systemMessageMode:I.systemMessageMode,fileIdPrefixes:this.config.fileIdPrefixes,store:(h=v?.store)!=null?h:!0,hasLocalShellTool:Z("openai.local_shell")});b.push(...$);const P=(f=v?.strictJsonSchema)!=null?f:!1;let E=v?.include;function j(W){E==null?E=[W]:E.includes(W)||(E=[...E,W])}function Z(W){return d?.find(je=>je.type==="provider-defined"&&je.id===W)!=null}const K=typeof v?.logprobs=="number"?v?.logprobs:v?.logprobs===!0?Oi:void 0;K&&j("message.output_text.logprobs");const q=(y=d?.find(W=>W.type==="provider-defined"&&(W.id==="openai.web_search"||W.id==="openai.web_search_preview")))==null?void 0:y.name;q&&j("web_search_call.action.sources"),Z("openai.code_interpreter")&&j("code_interpreter_call.outputs");const ye=v?.store;ye===!1&&I.isReasoningModel&&j("reasoning.encrypted_content");const ae={model:this.modelId,input:A,temperature:t,top_p:n,max_output_tokens:e,...(p?.type==="json"||v?.textVerbosity)&&{text:{...p?.type==="json"&&{format:p.schema!=null?{type:"json_schema",strict:P,name:(_=p.name)!=null?_:"response",description:p.description,schema:p.schema}:{type:"json_object"}},...v?.textVerbosity&&{verbosity:v.textVerbosity}}},max_tool_calls:v?.maxToolCalls,metadata:v?.metadata,parallel_tool_calls:v?.parallelToolCalls,previous_response_id:v?.previousResponseId,store:ye,user:v?.user,instructions:v?.instructions,service_tier:v?.serviceTier,include:E,prompt_cache_key:v?.promptCacheKey,safety_identifier:v?.safetyIdentifier,top_logprobs:K,...I.isReasoningModel&&(v?.reasoningEffort!=null||v?.reasoningSummary!=null)&&{reasoning:{...v?.reasoningEffort!=null&&{effort:v.reasoningEffort},...v?.reasoningSummary!=null&&{summary:v.reasoningSummary}}},...I.requiredAutoTruncation&&{truncation:"auto"}};I.isReasoningModel?(ae.temperature!=null&&(ae.temperature=void 0,b.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),ae.top_p!=null&&(ae.top_p=void 0,b.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))):(v?.reasoningEffort!=null&&b.push({type:"unsupported-setting",setting:"reasoningEffort",details:"reasoningEffort is not supported for non-reasoning models"}),v?.reasoningSummary!=null&&b.push({type:"unsupported-setting",setting:"reasoningSummary",details:"reasoningSummary is not supported for non-reasoning models"})),v?.serviceTier==="flex"&&!I.supportsFlexProcessing&&(b.push({type:"unsupported-setting",setting:"serviceTier",details:"flex processing is only available for o3, o4-mini, and gpt-5 models"}),delete ae.service_tier),v?.serviceTier==="priority"&&!I.supportsPriorityProcessing&&(b.push({type:"unsupported-setting",setting:"serviceTier",details:"priority processing is only available for supported models (gpt-4, gpt-5, gpt-5-mini, o3, o4-mini) and requires Enterprise access. gpt-5-nano is not supported"}),delete ae.service_tier);const{tools:Y,toolChoice:z,toolWarnings:Q}=await xg({tools:d,toolChoice:m,strictJsonSchema:P});return{webSearchToolName:q,args:{...ae,tools:Y,tool_choice:z},warnings:[...b,...Q],store:ye}}async doGenerate(e){var t,r,n,a,o,s,i,l,u,d,m,p,h,f,y,_,b,I,v;const{args:A,warnings:$,webSearchToolName:P}=await this.getArgs(e),E=this.config.url({path:"/responses",modelId:this.modelId}),{responseHeaders:j,value:Z,rawValue:K}=await at({url:E,headers:He(this.config.headers(),e.headers),body:A,failedResponseHandler:Ke,successfulResponseHandler:zt(Ig),abortSignal:e.abortSignal,fetch:this.config.fetch});if(Z.error)throw new ze({message:Z.error.message,url:E,requestBodyValues:A,statusCode:400,responseHeaders:j,responseBody:K,isRetryable:!1});const q=[],ye=[];let ae=!1;for(const z of Z.output)switch(z.type){case"reasoning":{z.summary.length===0&&z.summary.push({type:"summary_text",text:""});for(const Q of z.summary)q.push({type:"reasoning",text:Q.text,providerMetadata:{openai:{itemId:z.id,reasoningEncryptedContent:(t=z.encrypted_content)!=null?t:null}}});break}case"image_generation_call":{q.push({type:"tool-call",toolCallId:z.id,toolName:"image_generation",input:"{}",providerExecuted:!0}),q.push({type:"tool-result",toolCallId:z.id,toolName:"image_generation",result:{result:z.result},providerExecuted:!0});break}case"local_shell_call":{q.push({type:"tool-call",toolCallId:z.call_id,toolName:"local_shell",input:JSON.stringify({action:z.action}),providerMetadata:{openai:{itemId:z.id}}});break}case"message":{for(const Q of z.content){(n=(r=e.providerOptions)==null?void 0:r.openai)!=null&&n.logprobs&&Q.logprobs&&ye.push(Q.logprobs),q.push({type:"text",text:Q.text,providerMetadata:{openai:{itemId:z.id}}});for(const W of Q.annotations)W.type==="url_citation"?q.push({type:"source",sourceType:"url",id:(s=(o=(a=this.config).generateId)==null?void 0:o.call(a))!=null?s:tt(),url:W.url,title:W.title}):W.type==="file_citation"&&q.push({type:"source",sourceType:"document",id:(u=(l=(i=this.config).generateId)==null?void 0:l.call(i))!=null?u:tt(),mediaType:"text/plain",title:(m=(d=W.quote)!=null?d:W.filename)!=null?m:"Document",filename:(p=W.filename)!=null?p:W.file_id})}break}case"function_call":{ae=!0,q.push({type:"tool-call",toolCallId:z.call_id,toolName:z.name,input:z.arguments,providerMetadata:{openai:{itemId:z.id}}});break}case"web_search_call":{q.push({type:"tool-call",toolCallId:z.id,toolName:P??"web_search",input:JSON.stringify({}),providerExecuted:!0}),q.push({type:"tool-result",toolCallId:z.id,toolName:P??"web_search",result:Ha(z.action),providerExecuted:!0});break}case"computer_call":{q.push({type:"tool-call",toolCallId:z.id,toolName:"computer_use",input:"",providerExecuted:!0}),q.push({type:"tool-result",toolCallId:z.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:z.status||"completed"},providerExecuted:!0});break}case"file_search_call":{q.push({type:"tool-call",toolCallId:z.id,toolName:"file_search",input:"{}",providerExecuted:!0}),q.push({type:"tool-result",toolCallId:z.id,toolName:"file_search",result:{queries:z.queries,results:(f=(h=z.results)==null?void 0:h.map(Q=>({attributes:Q.attributes,fileId:Q.file_id,filename:Q.filename,score:Q.score,text:Q.text})))!=null?f:null},providerExecuted:!0});break}case"code_interpreter_call":{q.push({type:"tool-call",toolCallId:z.id,toolName:"code_interpreter",input:JSON.stringify({code:z.code,containerId:z.container_id}),providerExecuted:!0}),q.push({type:"tool-result",toolCallId:z.id,toolName:"code_interpreter",result:{outputs:z.outputs},providerExecuted:!0});break}}const Y={openai:{responseId:Z.id}};return ye.length>0&&(Y.openai.logprobs=ye),typeof Z.service_tier=="string"&&(Y.openai.serviceTier=Z.service_tier),{content:q,finishReason:Ga({finishReason:(y=Z.incomplete_details)==null?void 0:y.reason,hasFunctionCall:ae}),usage:{inputTokens:Z.usage.input_tokens,outputTokens:Z.usage.output_tokens,totalTokens:Z.usage.input_tokens+Z.usage.output_tokens,reasoningTokens:(b=(_=Z.usage.output_tokens_details)==null?void 0:_.reasoning_tokens)!=null?b:void 0,cachedInputTokens:(v=(I=Z.usage.input_tokens_details)==null?void 0:I.cached_tokens)!=null?v:void 0},request:{body:A},response:{id:Z.id,timestamp:new Date(Z.created_at*1e3),modelId:Z.model,headers:j,body:K},providerMetadata:Y,warnings:$}}async doStream(e){const{args:t,warnings:r,webSearchToolName:n,store:a}=await this.getArgs(e),{responseHeaders:o,value:s}=await at({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:Ke,successfulResponseHandler:Bn(wg),abortSignal:e.abortSignal,fetch:this.config.fetch}),i=this;let l="unknown";const u={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},d=[];let m=null;const p={};let h=!1;const f={};let y;return{stream:s.pipeThrough(new TransformStream({start(_){_.enqueue({type:"stream-start",warnings:r})},transform(_,b){var I,v,A,$,P,E,j,Z,K,q,ye,ae,Y,z,Q,W,je,Ye,ve,Xe,ee,pe;if(e.includeRawChunks&&b.enqueue({type:"raw",rawValue:_.rawValue}),!_.success){l="error",b.enqueue({type:"error",error:_.error});return}const w=_.value;if(Wa(w))w.item.type==="function_call"?(p[w.output_index]={toolName:w.item.name,toolCallId:w.item.call_id},b.enqueue({type:"tool-input-start",id:w.item.call_id,toolName:w.item.name})):w.item.type==="web_search_call"?(p[w.output_index]={toolName:n??"web_search",toolCallId:w.item.id},b.enqueue({type:"tool-input-start",id:w.item.id,toolName:n??"web_search",providerExecuted:!0}),b.enqueue({type:"tool-input-end",id:w.item.id}),b.enqueue({type:"tool-call",toolCallId:w.item.id,toolName:"web_search",input:JSON.stringify({}),providerExecuted:!0})):w.item.type==="computer_call"?(p[w.output_index]={toolName:"computer_use",toolCallId:w.item.id},b.enqueue({type:"tool-input-start",id:w.item.id,toolName:"computer_use",providerExecuted:!0})):w.item.type==="code_interpreter_call"?(p[w.output_index]={toolName:"code_interpreter",toolCallId:w.item.id,codeInterpreter:{containerId:w.item.container_id}},b.enqueue({type:"tool-input-start",id:w.item.id,toolName:"code_interpreter",providerExecuted:!0}),b.enqueue({type:"tool-input-delta",id:w.item.id,delta:`{"containerId":"${w.item.container_id}","code":"`})):w.item.type==="file_search_call"?b.enqueue({type:"tool-call",toolCallId:w.item.id,toolName:"file_search",input:"{}",providerExecuted:!0}):w.item.type==="image_generation_call"?b.enqueue({type:"tool-call",toolCallId:w.item.id,toolName:"image_generation",input:"{}",providerExecuted:!0}):w.item.type==="message"?b.enqueue({type:"text-start",id:w.item.id,providerMetadata:{openai:{itemId:w.item.id}}}):Wa(w)&&w.item.type==="reasoning"&&(f[w.item.id]={encryptedContent:w.item.encrypted_content,summaryParts:{0:"active"}},b.enqueue({type:"reasoning-start",id:`${w.item.id}:0`,providerMetadata:{openai:{itemId:w.item.id,reasoningEncryptedContent:(I=w.item.encrypted_content)!=null?I:null}}}));else if(Eg(w)){if(w.item.type==="function_call")p[w.output_index]=void 0,h=!0,b.enqueue({type:"tool-input-end",id:w.item.call_id}),b.enqueue({type:"tool-call",toolCallId:w.item.call_id,toolName:w.item.name,input:w.item.arguments,providerMetadata:{openai:{itemId:w.item.id}}});else if(w.item.type==="web_search_call")p[w.output_index]=void 0,b.enqueue({type:"tool-result",toolCallId:w.item.id,toolName:"web_search",result:Ha(w.item.action),providerExecuted:!0});else if(w.item.type==="computer_call")p[w.output_index]=void 0,b.enqueue({type:"tool-input-end",id:w.item.id}),b.enqueue({type:"tool-call",toolCallId:w.item.id,toolName:"computer_use",input:"",providerExecuted:!0}),b.enqueue({type:"tool-result",toolCallId:w.item.id,toolName:"computer_use",result:{type:"computer_use_tool_result",status:w.item.status||"completed"},providerExecuted:!0});else if(w.item.type==="file_search_call")p[w.output_index]=void 0,b.enqueue({type:"tool-result",toolCallId:w.item.id,toolName:"file_search",result:{queries:w.item.queries,results:(A=(v=w.item.results)==null?void 0:v.map(M=>({attributes:M.attributes,fileId:M.file_id,filename:M.filename,score:M.score,text:M.text})))!=null?A:null},providerExecuted:!0});else if(w.item.type==="code_interpreter_call")p[w.output_index]=void 0,b.enqueue({type:"tool-result",toolCallId:w.item.id,toolName:"code_interpreter",result:{outputs:w.item.outputs},providerExecuted:!0});else if(w.item.type==="image_generation_call")b.enqueue({type:"tool-result",toolCallId:w.item.id,toolName:"image_generation",result:{result:w.item.result},providerExecuted:!0});else if(w.item.type==="local_shell_call")p[w.output_index]=void 0,b.enqueue({type:"tool-call",toolCallId:w.item.call_id,toolName:"local_shell",input:JSON.stringify({action:{type:"exec",command:w.item.action.command,timeoutMs:w.item.action.timeout_ms,user:w.item.action.user,workingDirectory:w.item.action.working_directory,env:w.item.action.env}}),providerMetadata:{openai:{itemId:w.item.id}}});else if(w.item.type==="message")b.enqueue({type:"text-end",id:w.item.id});else if(w.item.type==="reasoning"){const M=f[w.item.id],Re=Object.entries(M.summaryParts).filter(([se,be])=>be==="active"||be==="can-conclude").map(([se])=>se);for(const se of Re)b.enqueue({type:"reasoning-end",id:`${w.item.id}:${se}`,providerMetadata:{openai:{itemId:w.item.id,reasoningEncryptedContent:($=w.item.encrypted_content)!=null?$:null}}});delete f[w.item.id]}}else if(Og(w)){const M=p[w.output_index];M!=null&&b.enqueue({type:"tool-input-delta",id:M.toolCallId,delta:w.delta})}else if(Cg(w)){const M=p[w.output_index];M!=null&&b.enqueue({type:"tool-input-delta",id:M.toolCallId,delta:JSON.stringify(w.delta).slice(1,-1)})}else if(Ng(w)){const M=p[w.output_index];M!=null&&(b.enqueue({type:"tool-input-delta",id:M.toolCallId,delta:'"}'}),b.enqueue({type:"tool-input-end",id:M.toolCallId}),b.enqueue({type:"tool-call",toolCallId:M.toolCallId,toolName:"code_interpreter",input:JSON.stringify({code:w.code,containerId:M.codeInterpreter.containerId}),providerExecuted:!0}))}else if(Ag(w))m=w.response.id,b.enqueue({type:"response-metadata",id:w.response.id,timestamp:new Date(w.response.created_at*1e3),modelId:w.response.model});else if(Tg(w))b.enqueue({type:"text-delta",id:w.item_id,delta:w.delta}),(E=(P=e.providerOptions)==null?void 0:P.openai)!=null&&E.logprobs&&w.logprobs&&d.push(w.logprobs);else if(w.type==="response.reasoning_summary_part.added"){if(w.summary_index>0){const M=f[w.item_id];M.summaryParts[w.summary_index]="active";for(const Re of Object.keys(M.summaryParts))M.summaryParts[Re]==="can-conclude"&&(b.enqueue({type:"reasoning-end",id:`${w.item_id}:${Re}`,providerMetadata:{openai:{itemId:w.item_id}}}),M.summaryParts[Re]="concluded");b.enqueue({type:"reasoning-start",id:`${w.item_id}:${w.summary_index}`,providerMetadata:{openai:{itemId:w.item_id,reasoningEncryptedContent:(Z=(j=f[w.item_id])==null?void 0:j.encryptedContent)!=null?Z:null}}})}}else w.type==="response.reasoning_summary_text.delta"?b.enqueue({type:"reasoning-delta",id:`${w.item_id}:${w.summary_index}`,delta:w.delta,providerMetadata:{openai:{itemId:w.item_id}}}):w.type==="response.reasoning_summary_part.done"?a?(b.enqueue({type:"reasoning-end",id:`${w.item_id}:${w.summary_index}`,providerMetadata:{openai:{itemId:w.item_id}}}),f[w.item_id].summaryParts[w.summary_index]="concluded"):f[w.item_id].summaryParts[w.summary_index]="can-conclude":$g(w)?(l=Ga({finishReason:(K=w.response.incomplete_details)==null?void 0:K.reason,hasFunctionCall:h}),u.inputTokens=w.response.usage.input_tokens,u.outputTokens=w.response.usage.output_tokens,u.totalTokens=w.response.usage.input_tokens+w.response.usage.output_tokens,u.reasoningTokens=(ye=(q=w.response.usage.output_tokens_details)==null?void 0:q.reasoning_tokens)!=null?ye:void 0,u.cachedInputTokens=(Y=(ae=w.response.usage.input_tokens_details)==null?void 0:ae.cached_tokens)!=null?Y:void 0,typeof w.response.service_tier=="string"&&(y=w.response.service_tier)):Pg(w)?w.annotation.type==="url_citation"?b.enqueue({type:"source",sourceType:"url",id:(W=(Q=(z=i.config).generateId)==null?void 0:Q.call(z))!=null?W:tt(),url:w.annotation.url,title:w.annotation.title}):w.annotation.type==="file_citation"&&b.enqueue({type:"source",sourceType:"document",id:(ve=(Ye=(je=i.config).generateId)==null?void 0:Ye.call(je))!=null?ve:tt(),mediaType:"text/plain",title:(ee=(Xe=w.annotation.quote)!=null?Xe:w.annotation.filename)!=null?ee:"Document",filename:(pe=w.annotation.filename)!=null?pe:w.annotation.file_id}):Rg(w)&&b.enqueue({type:"error",error:w})},flush(_){const b={openai:{responseId:m}};d.length>0&&(b.openai.logprobs=d),y!==void 0&&(b.openai.serviceTier=y),_.enqueue({type:"finish",finishReason:l,usage:u,providerMetadata:b})}})),request:{body:t},response:{headers:o}}}};function Tg(e){return e.type==="response.output_text.delta"}function Eg(e){return e.type==="response.output_item.done"}function $g(e){return e.type==="response.completed"||e.type==="response.incomplete"}function Ag(e){return e.type==="response.created"}function Og(e){return e.type==="response.function_call_arguments.delta"}function Cg(e){return e.type==="response.code_interpreter_call_code.delta"}function Ng(e){return e.type==="response.code_interpreter_call_code.done"}function Wa(e){return e.type==="response.output_item.added"}function Pg(e){return e.type==="response.output_text.annotation.added"}function Rg(e){return e.type==="error"}function Mg(e){const t=e.startsWith("o3")||e.startsWith("o4-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-chat"),r=e.startsWith("gpt-4")||e.startsWith("gpt-5-mini")||e.startsWith("gpt-5")&&!e.startsWith("gpt-5-nano")&&!e.startsWith("gpt-5-chat")||e.startsWith("o3")||e.startsWith("o4-mini"),n={requiredAutoTruncation:!1,systemMessageMode:"system",supportsFlexProcessing:t,supportsPriorityProcessing:r};return e.startsWith("gpt-5-chat")?{...n,isReasoningModel:!1}:e.startsWith("o")||e.startsWith("gpt-5")||e.startsWith("codex-")||e.startsWith("computer-use")?e.startsWith("o1-mini")||e.startsWith("o1-preview")?{...n,isReasoningModel:!0,systemMessageMode:"remove"}:{...n,isReasoningModel:!0,systemMessageMode:"developer"}:{...n,isReasoningModel:!1}}function Ha(e){var t;switch(e.type){case"search":return{action:{type:"search",query:(t=e.query)!=null?t:void 0}};case"open_page":return{action:{type:"openPage",url:e.url}};case"find":return{action:{type:"find",url:e.url,pattern:e.pattern}}}}var zg=Te(()=>V(g({instructions:c().nullish(),speed:S().min(.25).max(4).default(1).nullish()}))),Zg=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({text:e,voice:t="alloy",outputFormat:r="mp3",speed:n,instructions:a,language:o,providerOptions:s}){const i=[],l=await lt({provider:"openai",providerOptions:s,schema:zg}),u={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:n,instructions:a};if(r&&(["mp3","opus","aac","flac","wav","pcm"].includes(r)?u.response_format=r:i.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${r}. Using mp3 instead.`})),l){const d={};for(const m in d){const p=d[m];p!==void 0&&(u[m]=p)}}return o&&i.push({type:"unsupported-setting",setting:"language",details:`OpenAI speech models do not support language selection. Language parameter "${o}" was ignored.`}),{requestBody:u,warnings:i}}async doGenerate(e){var t,r,n;const a=(n=(r=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:r.call(t))!=null?n:new Date,{requestBody:o,warnings:s}=await this.getArgs(e),{value:i,responseHeaders:l,rawValue:u}=await at({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),body:o,failedResponseHandler:Ke,successfulResponseHandler:Cm(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:i,warnings:s,request:{body:JSON.stringify(o)},response:{timestamp:a,modelId:this.modelId,headers:l,body:u}}}},jg=Te(()=>V(g({text:c(),language:c().nullish(),duration:S().nullish(),words:C(g({word:c(),start:S(),end:S()})).nullish(),segments:C(g({id:S(),seek:S(),start:S(),end:S(),text:c(),tokens:C(S()),temperature:S(),avg_logprob:S(),compression_ratio:S(),no_speech_prob:S()})).nullish()}))),Dg=Te(()=>V(g({include:C(c()).optional(),language:c().optional(),prompt:c().optional(),temperature:S().min(0).max(1).default(0).optional(),timestampGranularities:C(oe(["word","segment"])).default(["segment"]).optional()}))),Ka={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},qg=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v2"}get provider(){return this.config.provider}async getArgs({audio:e,mediaType:t,providerOptions:r}){const n=[],a=await lt({provider:"openai",providerOptions:r,schema:Dg}),o=new FormData,s=e instanceof Uint8Array?new Blob([e]):new Blob([Sh(e)]);o.append("model",this.modelId);const i=vm(t);if(o.append("file",new File([s],"audio",{type:t}),`audio.${i}`),a){const l={include:a.include,language:a.language,prompt:a.prompt,response_format:["gpt-4o-transcribe","gpt-4o-mini-transcribe"].includes(this.modelId)?"json":"verbose_json",temperature:a.temperature,timestamp_granularities:a.timestampGranularities};for(const[u,d]of Object.entries(l))if(d!=null)if(Array.isArray(d))for(const m of d)o.append(`${u}[]`,String(m));else o.append(u,String(d))}return{formData:o,warnings:n}}async doGenerate(e){var t,r,n,a,o,s,i,l;const u=(n=(r=(t=this.config._internal)==null?void 0:t.currentDate)==null?void 0:r.call(t))!=null?n:new Date,{formData:d,warnings:m}=await this.getArgs(e),{value:p,responseHeaders:h,rawValue:f}=await Am({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:He(this.config.headers(),e.headers),formData:d,failedResponseHandler:Ke,successfulResponseHandler:zt(jg),abortSignal:e.abortSignal,fetch:this.config.fetch}),y=p.language!=null&&p.language in Ka?Ka[p.language]:void 0;return{text:p.text,segments:(i=(s=(a=p.segments)==null?void 0:a.map(_=>({text:_.text,startSecond:_.start,endSecond:_.end})))!=null?s:(o=p.words)==null?void 0:o.map(_=>({text:_.word,startSecond:_.start,endSecond:_.end})))!=null?i:[],language:y,durationInSeconds:(l=p.duration)!=null?l:void 0,warnings:m,response:{timestamp:u,modelId:this.modelId,headers:h,body:f}}}},Ug="2.0.52";function Ci(e={}){var t,r;const n=(t=Eh(gm({settingValue:e.baseURL,environmentVariableName:"OPENAI_BASE_URL"})))!=null?t:"https://api.openai.com/v1",a=(r=e.name)!=null?r:"openai",o=()=>vi({Authorization:`Bearer ${hm({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers},`ai-sdk/openai/${Ug}`),s=y=>new Ph(y,{provider:`${a}.chat`,url:({path:_})=>`${n}${_}`,headers:o,fetch:e.fetch}),i=y=>new Uh(y,{provider:`${a}.completion`,url:({path:_})=>`${n}${_}`,headers:o,fetch:e.fetch}),l=y=>new Vh(y,{provider:`${a}.embedding`,url:({path:_})=>`${n}${_}`,headers:o,fetch:e.fetch}),u=y=>new Wh(y,{provider:`${a}.image`,url:({path:_})=>`${n}${_}`,headers:o,fetch:e.fetch}),d=y=>new qg(y,{provider:`${a}.transcription`,url:({path:_})=>`${n}${_}`,headers:o,fetch:e.fetch}),m=y=>new Zg(y,{provider:`${a}.speech`,url:({path:_})=>`${n}${_}`,headers:o,fetch:e.fetch}),p=y=>{if(new.target)throw new Error("The OpenAI model function cannot be called with the new keyword.");return h(y)},h=y=>new Sg(y,{provider:`${a}.responses`,url:({path:_})=>`${n}${_}`,headers:o,fetch:e.fetch,fileIdPrefixes:["file-"]}),f=function(y){return p(y)};return f.languageModel=p,f.chat=s,f.completion=i,f.responses=h,f.embedding=l,f.textEmbedding=l,f.textEmbeddingModel=l,f.image=u,f.imageModel=u,f.transcription=d,f.transcriptionModel=d,f.speech=m,f.speechModel=m,f.tools=yg,f}Ci();var Ni="vercel.ai.error",Fg=Symbol.for(Ni),Ya,Xa,D=class Pi extends(Xa=Error,Ya=Fg,Xa){constructor({name:t,message:r,cause:n}){super(r),this[Ya]=!0,this.name=t,this.cause=n}static isInstance(t){return Pi.hasMarker(t,Ni)}static hasMarker(t,r){const n=Symbol.for(r);return t!=null&&typeof t=="object"&&n in t&&typeof t[n]=="boolean"&&t[n]===!0}},Ri="AI_APICallError",Mi=`vercel.ai.error.${Ri}`,Lg=Symbol.for(Mi),Qa,eo,Se=class extends(eo=D,Qa=Lg,eo){constructor({message:e,url:t,requestBodyValues:r,statusCode:n,responseHeaders:a,responseBody:o,cause:s,isRetryable:i=n!=null&&(n===408||n===409||n===429||n>=500),data:l}){super({name:Ri,message:e,cause:s}),this[Qa]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=n,this.responseHeaders=a,this.responseBody=o,this.isRetryable=i,this.data=l}static isInstance(e){return D.hasMarker(e,Mi)}},zi="AI_EmptyResponseBodyError",Zi=`vercel.ai.error.${zi}`,Vg=Symbol.for(Zi),to,ro,Bg=class extends(ro=D,to=Vg,ro){constructor({message:e="Empty response body"}={}){super({name:zi,message:e}),this[to]=!0}static isInstance(e){return D.hasMarker(e,Zi)}};function Zt(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}var ji="AI_InvalidArgumentError",Di=`vercel.ai.error.${ji}`,Jg=Symbol.for(Di),no,ao,Gg=class extends(ao=D,no=Jg,ao){constructor({message:t,cause:r,argument:n}){super({name:ji,message:t,cause:r}),this[no]=!0,this.argument=n}static isInstance(t){return D.hasMarker(t,Di)}},qi="AI_InvalidPromptError",Ui=`vercel.ai.error.${qi}`,Wg=Symbol.for(Ui),oo,so,St=class extends(so=D,oo=Wg,so){constructor({prompt:e,message:t,cause:r}){super({name:qi,message:`Invalid prompt: ${t}`,cause:r}),this[oo]=!0,this.prompt=e}static isInstance(e){return D.hasMarker(e,Ui)}},Fi="AI_JSONParseError",Li=`vercel.ai.error.${Fi}`,Hg=Symbol.for(Li),io,uo,Or=class extends(uo=D,io=Hg,uo){constructor({text:e,cause:t}){super({name:Fi,message:`JSON parsing failed: Text: ${e}.
Error message: ${Zt(t)}`,cause:t}),this[io]=!0,this.text=e}static isInstance(e){return D.hasMarker(e,Li)}},Vi="AI_NoSuchModelError",Bi=`vercel.ai.error.${Vi}`,Kg=Symbol.for(Bi),lo,co,Yg=class extends(co=D,lo=Kg,co){constructor({errorName:e=Vi,modelId:t,modelType:r,message:n=`No such ${r}: ${t}`}){super({name:e,message:n}),this[lo]=!0,this.modelId=t,this.modelType=r}static isInstance(e){return D.hasMarker(e,Bi)}},Ji="AI_TypeValidationError",Gi=`vercel.ai.error.${Ji}`,Xg=Symbol.for(Gi),po,fo,Xt=class wn extends(fo=D,po=Xg,fo){constructor({value:t,cause:r}){super({name:Ji,message:`Type validation failed: Value: ${JSON.stringify(t)}.
Error message: ${Zt(r)}`,cause:r}),this[po]=!0,this.value=t}static isInstance(t){return D.hasMarker(t,Gi)}static wrap({value:t,cause:r}){return wn.isInstance(r)&&r.value===t?r:new wn({value:t,cause:r})}};const Qg="modulepreload",ev=function(e){return"/"+e},mo={},Wi=function(t,r,n){let a=Promise.resolve();if(r&&r.length>0){let l=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),i=s?.nonce||s?.getAttribute("nonce");a=l(r.map(u=>{if(u=ev(u),u in mo)return;mo[u]=!0;const d=u.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${m}`))return;const p=document.createElement("link");if(p.rel=d?"stylesheet":Qg,d||(p.as="script"),p.crossOrigin="",p.href=u,i&&p.setAttribute("nonce",i),document.head.appendChild(p),d)return new Promise((h,f)=>{p.addEventListener("load",h),p.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${u}`)))})}))}function o(s){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=s,window.dispatchEvent(i),!i.defaultPrevented)throw s}return a.then(s=>{for(const i of s||[])i.status==="rejected"&&o(i.reason);return t().catch(o)})};var tv={};function In(...e){return e.reduce((t,r)=>({...t,...r??{}}),{})}async function rv(e,t){if(e==null)return Promise.resolve();const r=t?.abortSignal;return new Promise((n,a)=>{if(r?.aborted){a(ho());return}const o=setTimeout(()=>{s(),n()},e),s=()=>{clearTimeout(o),r?.removeEventListener("abort",i)},i=()=>{s(),a(ho())};r?.addEventListener("abort",i)})}function ho(){return new DOMException("Delay was aborted","AbortError")}function ur(e){return Object.fromEntries([...e.headers])}var lr=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:n="-"}={})=>{const a=()=>{const o=r.length,s=new Array(t);for(let i=0;i<t;i++)s[i]=r[Math.random()*o|0];return s.join("")};if(e==null)return a;if(r.includes(n))throw new Gg({argument:"separator",message:`The separator "${n}" must not be part of the alphabet "${r}".`});return()=>`${e}${n}${a()}`};lr();function Hi(e){return e==null?"unknown error":typeof e=="string"?e:e instanceof Error?e.message:JSON.stringify(e)}function mt(e){return(e instanceof Error||e instanceof DOMException)&&(e.name==="AbortError"||e.name==="ResponseAborted"||e.name==="TimeoutError")}var nv=["fetch failed","failed to fetch"];function Ki({error:e,url:t,requestBodyValues:r}){if(mt(e))return e;if(e instanceof TypeError&&nv.includes(e.message.toLowerCase())){const n=e.cause;if(n!=null)return new Se({message:`Cannot connect to API: ${n.message}`,cause:n,url:t,requestBodyValues:r,isRetryable:!0})}return e}function Gn(e=globalThis){var t,r,n;return e.window?"runtime/browser":(t=e.navigator)!=null&&t.userAgent?`runtime/${e.navigator.userAgent.toLowerCase()}`:(n=(r=e.process)==null?void 0:r.versions)!=null&&n.node?`runtime/node.js/${e.process.version.substring(0)}`:e.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function av(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!=null))}function jr(e,...t){const r=av(e??{}),n=new Headers(r),a=n.get("user-agent")||"";return n.set("user-agent",[a,...t].filter(Boolean).join(" ")),Object.fromEntries(n)}var Yi="4.0.0-beta.20",ov=()=>globalThis.fetch,go=async({url:e,headers:t={},successfulResponseHandler:r,failedResponseHandler:n,abortSignal:a,fetch:o=ov()})=>{try{const s=await o(e,{method:"GET",headers:jr(t,`ai-sdk/provider-utils/${Yi}`,Gn()),signal:a}),i=ur(s);if(!s.ok){let l;try{l=await n({response:s,url:e,requestBodyValues:{}})}catch(u){throw mt(u)||Se.isInstance(u)?u:new Se({message:"Failed to process error response",cause:u,statusCode:s.status,url:e,responseHeaders:i,requestBodyValues:{}})}throw l.value}try{return await r({response:s,url:e,requestBodyValues:{}})}catch(l){throw l instanceof Error&&(mt(l)||Se.isInstance(l))?l:new Se({message:"Failed to process successful response",cause:l,statusCode:s.status,url:e,responseHeaders:i,requestBodyValues:{}})}}catch(s){throw Ki({error:s,url:e,requestBodyValues:{}})}};function sv(e){return e!=null}function iv({mediaType:e,url:t,supportedUrls:r}){return t=t.toLowerCase(),e=e.toLowerCase(),Object.entries(r).map(([n,a])=>{const o=n.toLowerCase();return o==="*"||o==="*/*"?{mediaTypePrefix:"",regexes:a}:{mediaTypePrefix:o.replace(/\*/,""),regexes:a}}).filter(({mediaTypePrefix:n})=>e.startsWith(n)).flatMap(({regexes:n})=>n).some(n=>n.test(t))}function kr({settingValue:e,environmentVariableName:t}){if(typeof e=="string")return e;if(!(e!=null||typeof process>"u")&&(e=tv[t],!(e==null||typeof e!="string")))return e}var uv=/"__proto__"\s*:/,lv=/"constructor"\s*:/;function cv(e){const t=JSON.parse(e);return t===null||typeof t!="object"||uv.test(e)===!1&&lv.test(e)===!1?t:dv(t)}function dv(e){let t=[e];for(;t.length;){const r=t;t=[];for(const n of r){if(Object.prototype.hasOwnProperty.call(n,"__proto__"))throw new SyntaxError("Object contains forbidden prototype property");if(Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype"))throw new SyntaxError("Object contains forbidden prototype property");for(const a in n){const o=n[a];o&&typeof o=="object"&&t.push(o)}}}return e}function Xi(e){const{stackTraceLimit:t}=Error;Error.stackTraceLimit=0;try{return cv(e)}finally{Error.stackTraceLimit=t}}var pv=e=>()=>e.toJsonSchema(),fv=e=>async()=>{try{const{JSONSchema:t}=await Wi(async()=>{const{JSONSchema:r}=await import("./provider-utils_false-Bu5lmX18.js");return{JSONSchema:r}},[]);return t.make(e)}catch{throw new Error("Failed to import module 'effect'")}},mv=e=>async()=>{try{const{toJsonSchema:t}=await Wi(async()=>{const{toJsonSchema:r}=await import("./provider-utils_false-BKJD46kk.js");return{toJsonSchema:r}},[]);return t(e)}catch{throw new Error("Failed to import module '@valibot/to-json-schema'")}},hv=Symbol("Let zodToJsonSchema decide on which parser to use"),vo={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},gv=e=>typeof e=="string"?{...vo,name:e}:{...vo,...e};function Ne(){return{}}function vv(e,t){var r,n,a;const o={type:"array"};return(r=e.type)!=null&&r._def&&((a=(n=e.type)==null?void 0:n._def)==null?void 0:a.typeName)!==T.ZodAny&&(o.items=G(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&(o.minItems=e.minLength.value),e.maxLength&&(o.maxItems=e.maxLength.value),e.exactLength&&(o.minItems=e.exactLength.value,o.maxItems=e.exactLength.value),o}function yv(e){const t={type:"integer",format:"int64"};if(!e.checks)return t;for(const r of e.checks)switch(r.kind){case"min":r.inclusive?t.minimum=r.value:t.exclusiveMinimum=r.value;break;case"max":r.inclusive?t.maximum=r.value:t.exclusiveMaximum=r.value;break;case"multipleOf":t.multipleOf=r.value;break}return t}function _v(){return{type:"boolean"}}function Qi(e,t){return G(e.type._def,t)}var bv=(e,t)=>G(e.innerType._def,t);function eu(e,t,r){const n=r??t.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((a,o)=>eu(e,t,a))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return wv(e)}}var wv=e=>{const t={type:"integer",format:"unix-time"};for(const r of e.checks)switch(r.kind){case"min":t.minimum=r.value;break;case"max":t.maximum=r.value;break}return t};function Iv(e,t){return{...G(e.innerType._def,t),default:e.defaultValue()}}function kv(e,t){return t.effectStrategy==="input"?G(e.schema._def,t):Ne()}function xv(e){return{type:"string",enum:Array.from(e.values)}}var Sv=e=>"type"in e&&e.type==="string"?!1:"allOf"in e;function Tv(e,t){const r=[G(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),G(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(a=>!!a),n=[];return r.forEach(a=>{if(Sv(a))n.push(...a.allOf);else{let o=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:s,...i}=a;o=i}n.push(o)}}),n.length?{allOf:n}:void 0}function Ev(e){const t=typeof e.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(e.value)?"array":"object"}:{type:t==="bigint"?"integer":t,const:e.value}}var en=void 0,Fe={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(en===void 0&&(en=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),en),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function tu(e,t){const r={type:"string"};if(e.checks)for(const n of e.checks)switch(n.kind){case"min":r.minLength=typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value;break;case"max":r.maxLength=typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value;break;case"email":switch(t.emailStrategy){case"format:email":Le(r,"email",n.message,t);break;case"format:idn-email":Le(r,"idn-email",n.message,t);break;case"pattern:zod":xe(r,Fe.email,n.message,t);break}break;case"url":Le(r,"uri",n.message,t);break;case"uuid":Le(r,"uuid",n.message,t);break;case"regex":xe(r,n.regex,n.message,t);break;case"cuid":xe(r,Fe.cuid,n.message,t);break;case"cuid2":xe(r,Fe.cuid2,n.message,t);break;case"startsWith":xe(r,RegExp(`^${tn(n.value,t)}`),n.message,t);break;case"endsWith":xe(r,RegExp(`${tn(n.value,t)}$`),n.message,t);break;case"datetime":Le(r,"date-time",n.message,t);break;case"date":Le(r,"date",n.message,t);break;case"time":Le(r,"time",n.message,t);break;case"duration":Le(r,"duration",n.message,t);break;case"length":r.minLength=typeof r.minLength=="number"?Math.max(r.minLength,n.value):n.value,r.maxLength=typeof r.maxLength=="number"?Math.min(r.maxLength,n.value):n.value;break;case"includes":{xe(r,RegExp(tn(n.value,t)),n.message,t);break}case"ip":{n.version!=="v6"&&Le(r,"ipv4",n.message,t),n.version!=="v4"&&Le(r,"ipv6",n.message,t);break}case"base64url":xe(r,Fe.base64url,n.message,t);break;case"jwt":xe(r,Fe.jwt,n.message,t);break;case"cidr":{n.version!=="v6"&&xe(r,Fe.ipv4Cidr,n.message,t),n.version!=="v4"&&xe(r,Fe.ipv6Cidr,n.message,t);break}case"emoji":xe(r,Fe.emoji(),n.message,t);break;case"ulid":{xe(r,Fe.ulid,n.message,t);break}case"base64":{switch(t.base64Strategy){case"format:binary":{Le(r,"binary",n.message,t);break}case"contentEncoding:base64":{r.contentEncoding="base64";break}case"pattern:zod":{xe(r,Fe.base64,n.message,t);break}}break}case"nanoid":xe(r,Fe.nanoid,n.message,t)}return r}function tn(e,t){return t.patternStrategy==="escape"?Av(e):e}var $v=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Av(e){let t="";for(let r=0;r<e.length;r++)$v.has(e[r])||(t+="\\"),t+=e[r];return t}function Le(e,t,r,n){var a;e.format||(a=e.anyOf)!=null&&a.some(o=>o.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format}),delete e.format),e.anyOf.push({format:t,...r&&n.errorMessages&&{errorMessage:{format:r}}})):e.format=t}function xe(e,t,r,n){var a;e.pattern||(a=e.allOf)!=null&&a.some(o=>o.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern}),delete e.pattern),e.allOf.push({pattern:yo(t,n),...r&&n.errorMessages&&{errorMessage:{pattern:r}}})):e.pattern=yo(t,n)}function yo(e,t){var r;if(!t.applyRegexFlags||!e.flags)return e.source;const n={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=n.i?e.source.toLowerCase():e.source;let o="",s=!1,i=!1,l=!1;for(let u=0;u<a.length;u++){if(s){o+=a[u],s=!1;continue}if(n.i){if(i){if(a[u].match(/[a-z]/)){l?(o+=a[u],o+=`${a[u-2]}-${a[u]}`.toUpperCase(),l=!1):a[u+1]==="-"&&((r=a[u+2])!=null&&r.match(/[a-z]/))?(o+=a[u],l=!0):o+=`${a[u]}${a[u].toUpperCase()}`;continue}}else if(a[u].match(/[a-z]/)){o+=`[${a[u]}${a[u].toUpperCase()}]`;continue}}if(n.m){if(a[u]==="^"){o+=`(^|(?<=[\r
]))`;continue}else if(a[u]==="$"){o+=`($|(?=[\r
]))`;continue}}if(n.s&&a[u]==="."){o+=i?`${a[u]}\r
`:`[${a[u]}\r
]`;continue}o+=a[u],a[u]==="\\"?s=!0:i&&a[u]==="]"?i=!1:!i&&a[u]==="["&&(i=!0)}try{new RegExp(o)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return o}function ru(e,t){var r,n,a,o,s,i;const l={type:"object",additionalProperties:(r=G(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]}))!=null?r:t.allowedAdditionalProperties};if(((n=e.keyType)==null?void 0:n._def.typeName)===T.ZodString&&((a=e.keyType._def.checks)!=null&&a.length)){const{type:u,...d}=tu(e.keyType._def,t);return{...l,propertyNames:d}}else{if(((o=e.keyType)==null?void 0:o._def.typeName)===T.ZodEnum)return{...l,propertyNames:{enum:e.keyType._def.values}};if(((s=e.keyType)==null?void 0:s._def.typeName)===T.ZodBranded&&e.keyType._def.type._def.typeName===T.ZodString&&((i=e.keyType._def.type._def.checks)!=null&&i.length)){const{type:u,...d}=Qi(e.keyType._def,t);return{...l,propertyNames:d}}}return l}function Ov(e,t){if(t.mapStrategy==="record")return ru(e,t);const r=G(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||Ne(),n=G(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||Ne();return{type:"array",maxItems:125,items:{type:"array",items:[r,n],minItems:2,maxItems:2}}}function Cv(e){const t=e.values,n=Object.keys(e.values).filter(o=>typeof t[t[o]]!="number").map(o=>t[o]),a=Array.from(new Set(n.map(o=>typeof o)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:n}}function Nv(){return{not:Ne()}}function Pv(){return{type:"null"}}var kn={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Rv(e,t){const r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(n=>n._def.typeName in kn&&(!n._def.checks||!n._def.checks.length))){const n=r.reduce((a,o)=>{const s=kn[o._def.typeName];return s&&!a.includes(s)?[...a,s]:a},[]);return{type:n.length>1?n:n[0]}}else if(r.every(n=>n._def.typeName==="ZodLiteral"&&!n.description)){const n=r.reduce((a,o)=>{const s=typeof o._def.value;switch(s){case"string":case"number":case"boolean":return[...a,s];case"bigint":return[...a,"integer"];case"object":if(o._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(n.length===r.length){const a=n.filter((o,s,i)=>i.indexOf(o)===s);return{type:a.length>1?a:a[0],enum:r.reduce((o,s)=>o.includes(s._def.value)?o:[...o,s._def.value],[])}}}else if(r.every(n=>n._def.typeName==="ZodEnum"))return{type:"string",enum:r.reduce((n,a)=>[...n,...a._def.values.filter(o=>!n.includes(o))],[])};return Mv(e,t)}var Mv=(e,t)=>{const r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((n,a)=>G(n._def,{...t,currentPath:[...t.currentPath,"anyOf",`${a}`]})).filter(n=>!!n&&(!t.strictUnions||typeof n=="object"&&Object.keys(n).length>0));return r.length?{anyOf:r}:void 0};function zv(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return{type:[kn[e.innerType._def.typeName],"null"]};const r=G(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function Zv(e){const t={type:"number"};if(!e.checks)return t;for(const r of e.checks)switch(r.kind){case"int":t.type="integer";break;case"min":r.inclusive?t.minimum=r.value:t.exclusiveMinimum=r.value;break;case"max":r.inclusive?t.maximum=r.value:t.exclusiveMaximum=r.value;break;case"multipleOf":t.multipleOf=r.value;break}return t}function jv(e,t){const r={type:"object",properties:{}},n=[],a=e.shape();for(const s in a){let i=a[s];if(i===void 0||i._def===void 0)continue;const l=qv(i),u=G(i._def,{...t,currentPath:[...t.currentPath,"properties",s],propertyPath:[...t.currentPath,"properties",s]});u!==void 0&&(r.properties[s]=u,l||n.push(s))}n.length&&(r.required=n);const o=Dv(e,t);return o!==void 0&&(r.additionalProperties=o),r}function Dv(e,t){if(e.catchall._def.typeName!=="ZodNever")return G(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return t.removeAdditionalStrategy==="strict"?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}function qv(e){try{return e.isOptional()}catch{return!0}}var Uv=(e,t)=>{var r;if(t.currentPath.toString()===((r=t.propertyPath)==null?void 0:r.toString()))return G(e.innerType._def,t);const n=G(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return n?{anyOf:[{not:Ne()},n]}:Ne()},Fv=(e,t)=>{if(t.pipeStrategy==="input")return G(e.in._def,t);if(t.pipeStrategy==="output")return G(e.out._def,t);const r=G(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),n=G(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,n].filter(a=>a!==void 0)}};function Lv(e,t){return G(e.type._def,t)}function Vv(e,t){const n={type:"array",uniqueItems:!0,items:G(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&(n.minItems=e.minSize.value),e.maxSize&&(n.maxItems=e.maxSize.value),n}function Bv(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((r,n)=>G(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[]),additionalItems:G(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((r,n)=>G(r._def,{...t,currentPath:[...t.currentPath,"items",`${n}`]})).reduce((r,n)=>n===void 0?r:[...r,n],[])}}function Jv(){return{not:Ne()}}function Gv(){return Ne()}var Wv=(e,t)=>G(e.innerType._def,t),Hv=(e,t,r)=>{switch(t){case T.ZodString:return tu(e,r);case T.ZodNumber:return Zv(e);case T.ZodObject:return jv(e,r);case T.ZodBigInt:return yv(e);case T.ZodBoolean:return _v();case T.ZodDate:return eu(e,r);case T.ZodUndefined:return Jv();case T.ZodNull:return Pv();case T.ZodArray:return vv(e,r);case T.ZodUnion:case T.ZodDiscriminatedUnion:return Rv(e,r);case T.ZodIntersection:return Tv(e,r);case T.ZodTuple:return Bv(e,r);case T.ZodRecord:return ru(e,r);case T.ZodLiteral:return Ev(e);case T.ZodEnum:return xv(e);case T.ZodNativeEnum:return Cv(e);case T.ZodNullable:return zv(e,r);case T.ZodOptional:return Uv(e,r);case T.ZodMap:return Ov(e,r);case T.ZodSet:return Vv(e,r);case T.ZodLazy:return()=>e.getter()._def;case T.ZodPromise:return Lv(e,r);case T.ZodNaN:case T.ZodNever:return Nv();case T.ZodEffects:return kv(e,r);case T.ZodAny:return Ne();case T.ZodUnknown:return Gv();case T.ZodDefault:return Iv(e,r);case T.ZodBranded:return Qi(e,r);case T.ZodReadonly:return Wv(e,r);case T.ZodCatch:return bv(e,r);case T.ZodPipeline:return Fv(e,r);case T.ZodFunction:case T.ZodVoid:case T.ZodSymbol:return;default:return(n=>{})()}},Kv=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")};function G(e,t,r=!1){var n;const a=t.seen.get(e);if(t.override){const l=(n=t.override)==null?void 0:n.call(t,e,t,a,r);if(l!==hv)return l}if(a&&!r){const l=Yv(a,t);if(l!==void 0)return l}const o={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,o);const s=Hv(e,e.typeName,t),i=typeof s=="function"?G(s(),t):s;if(i&&Xv(e,t,i),t.postProcess){const l=t.postProcess(i,e,t);return o.jsonSchema=i,l}return o.jsonSchema=i,i}var Yv=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:Kv(t.currentPath,e.path)};case"none":case"seen":return e.path.length<t.currentPath.length&&e.path.every((r,n)=>t.currentPath[n]===r)?(console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),Ne()):t.$refStrategy==="seen"?Ne():void 0}},Xv=(e,t,r)=>(e.description&&(r.description=e.description),r),Qv=e=>{const t=gv(e),r=t.name!==void 0?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([n,a])=>[a._def,{def:a._def,path:[...t.basePath,t.definitionPath,n],jsonSchema:void 0}]))}},ey=(e,t)=>{var r;const n=Qv(t);let a=typeof t=="object"&&t.definitions?Object.entries(t.definitions).reduce((u,[d,m])=>{var p;return{...u,[d]:(p=G(m._def,{...n,currentPath:[...n.basePath,n.definitionPath,d]},!0))!=null?p:Ne()}},{}):void 0;const o=typeof t=="string"?t:t?.nameStrategy==="title"?void 0:t?.name,s=(r=G(e._def,o===void 0?n:{...n,currentPath:[...n.basePath,n.definitionPath,o]},!1))!=null?r:Ne(),i=typeof t=="object"&&t.name!==void 0&&t.nameStrategy==="title"?t.name:void 0;i!==void 0&&(s.title=i);const l=o===void 0?a?{...s,[n.definitionPath]:a}:s:{$ref:[...n.$refStrategy==="relative"?[]:n.basePath,n.definitionPath,o].join("/"),[n.definitionPath]:{...a,[o]:s}};return l.$schema="http://json-schema.org/draft-07/schema#",l},xn=Symbol.for("vercel.ai.schema");function jt(e){let t;return()=>(t==null&&(t=e()),t)}function cr(e,{validate:t}={}){return{[xn]:!0,_type:void 0,get jsonSchema(){return typeof e=="function"&&(e=e()),e},validate:t}}function ty(e){return typeof e=="object"&&e!==null&&xn in e&&e[xn]===!0&&"jsonSchema"in e&&"validate"in e}function dr(e){return e==null?cr({properties:{},additionalProperties:!1}):ty(e)?e:"~standard"in e?ry(e):e()}function ry(e){const t=e["~standard"].vendor;switch(t){case"zod":return yt(e);case"arktype":return br(e,pv);case"effect":return br(e,fv);case"valibot":return br(e,mv);default:return br(e,()=>()=>{throw new Error(`Unsupported standard schema vendor: ${t}`)})}}function br(e,t){return cr(t(e),{validate:async r=>{const n=await e["~standard"].validate(r);return"value"in n?{success:!0,value:n.value}:{success:!1,error:new Xt({value:r,cause:n.issues})}}})}function ny(e,t){var r;const n=(r=void 0)!=null?r:!1;return cr(()=>ey(e,{$refStrategy:n?"root":"none"}),{validate:async a=>{const o=await e.safeParseAsync(a);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}function ay(e,t){var r;const n=(r=void 0)!=null?r:!1;return cr(()=>ii(e,{target:"draft-7",io:"output",reused:n?"ref":"inline"}),{validate:async a=>{const o=await qn(e,a);return o.success?{success:!0,value:o.data}:{success:!1,error:o.error}}})}function oy(e){return"_zod"in e}function yt(e,t){return oy(e)?ay(e):ny(e)}async function Sn({value:e,schema:t}){const r=await ct({value:e,schema:t});if(!r.success)throw Xt.wrap({value:e,cause:r.error});return r.value}async function ct({value:e,schema:t}){const r=dr(t);try{if(r.validate==null)return{success:!0,value:e,rawValue:e};const n=await r.validate(e);return n.success?{success:!0,value:n.value,rawValue:e}:{success:!1,error:Xt.wrap({value:e,cause:n.error}),rawValue:e}}catch(n){return{success:!1,error:Xt.wrap({value:e,cause:n}),rawValue:e}}}async function sy({text:e,schema:t}){try{const r=Xi(e);return t==null?r:Sn({value:r,schema:t})}catch(r){throw Or.isInstance(r)||Xt.isInstance(r)?r:new Or({text:e,cause:r})}}async function dt({text:e,schema:t}){try{const r=Xi(e);return t==null?{success:!0,value:r,rawValue:r}:await ct({value:r,schema:t})}catch(r){return{success:!1,error:Or.isInstance(r)?r:new Or({text:e,cause:r}),rawValue:void 0}}}function iy({stream:e,schema:t}){return e.pipeThrough(new TextDecoderStream).pipeThrough(new Zs).pipeThrough(new TransformStream({async transform({data:r},n){r!=="[DONE]"&&n.enqueue(await dt({text:r,schema:t}))}}))}var uy=()=>globalThis.fetch,Tn=async({url:e,headers:t,body:r,failedResponseHandler:n,successfulResponseHandler:a,abortSignal:o,fetch:s})=>ly({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:n,successfulResponseHandler:a,abortSignal:o,fetch:s}),ly=async({url:e,headers:t={},body:r,successfulResponseHandler:n,failedResponseHandler:a,abortSignal:o,fetch:s=uy()})=>{try{const i=await s(e,{method:"POST",headers:jr(t,`ai-sdk/provider-utils/${Yi}`,Gn()),body:r.content,signal:o}),l=ur(i);if(!i.ok){let u;try{u=await a({response:i,url:e,requestBodyValues:r.values})}catch(d){throw mt(d)||Se.isInstance(d)?d:new Se({message:"Failed to process error response",cause:d,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:r.values})}throw u.value}try{return await n({response:i,url:e,requestBodyValues:r.values})}catch(u){throw u instanceof Error&&(mt(u)||Se.isInstance(u))?u:new Se({message:"Failed to process successful response",cause:u,statusCode:i.status,url:e,responseHeaders:l,requestBodyValues:r.values})}}catch(i){throw Ki({error:i,url:e,requestBodyValues:r.values})}};function cy(e){return{...e,type:"dynamic"}}async function nt(e){return typeof e=="function"&&(e=e()),Promise.resolve(e)}var Qt=({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:n,url:a,requestBodyValues:o})=>{const s=await n.text(),i=ur(n);if(s.trim()==="")return{responseHeaders:i,value:new Se({message:n.statusText,url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,isRetryable:r?.(n)})};try{const l=await sy({text:s,schema:e});return{responseHeaders:i,value:new Se({message:t(l),url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,data:l,isRetryable:r?.(n,l)})}}catch{return{responseHeaders:i,value:new Se({message:n.statusText,url:a,requestBodyValues:o,statusCode:n.status,responseHeaders:i,responseBody:s,isRetryable:r?.(n)})}}},dy=e=>async({response:t})=>{const r=ur(t);if(t.body==null)throw new Bg({});return{responseHeaders:r,value:iy({stream:t.body,schema:e})}},Cr=e=>async({response:t,url:r,requestBodyValues:n})=>{const a=await t.text(),o=await dt({text:a,schema:e}),s=ur(t);if(!o.success)throw new Se({message:"Invalid JSON response",cause:o.error,statusCode:t.status,responseHeaders:s,responseBody:a,url:r,requestBodyValues:n});return{responseHeaders:s,value:o.value,rawValue:o.rawValue}},{btoa:py,atob:fy}=globalThis;function Wn(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=fy(t);return Uint8Array.from(r,n=>n.codePointAt(0))}function En(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return py(t)}function my(e){return e?.replace(/\/$/,"")}function hy(e){return e!=null&&typeof e[Symbol.asyncIterator]=="function"}async function*gy({execute:e,input:t,options:r}){const n=e(t,r);if(hy(n)){let a;for await(const o of n)a=o,yield{type:"preliminary",output:o};yield{type:"final",output:a}}else yield{type:"final",output:await n}}var rn,_o;function vy(){if(_o)return rn;_o=1;var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a=(d,m)=>{for(var p in m)e(d,p,{get:m[p],enumerable:!0})},o=(d,m,p,h)=>{if(m&&typeof m=="object"||typeof m=="function")for(let f of r(m))!n.call(d,f)&&f!==p&&e(d,f,{get:()=>m[f],enumerable:!(h=t(m,f))||h.enumerable});return d},s=d=>o(e({},"__esModule",{value:!0}),d),i={};a(i,{SYMBOL_FOR_REQ_CONTEXT:()=>l,getContext:()=>u}),rn=s(i);const l=Symbol.for("@vercel/request-context");function u(){return globalThis[l]?.get?.()??{}}return rn}var nn,bo;function yy(){if(bo)return nn;bo=1;var e=Object.defineProperty,t=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,n=Object.prototype.hasOwnProperty,a=(m,p)=>{for(var h in p)e(m,h,{get:p[h],enumerable:!0})},o=(m,p,h,f)=>{if(p&&typeof p=="object"||typeof p=="function")for(let y of r(p))!n.call(m,y)&&y!==h&&e(m,y,{get:()=>p[y],enumerable:!(f=t(p,y))||f.enumerable});return m},s=m=>o(e({},"__esModule",{value:!0}),m),i={};a(i,{getContext:()=>l.getContext,getVercelOidcToken:()=>u,getVercelOidcTokenSync:()=>d}),nn=s(i);var l=vy();async function u(){return""}function d(){return""}return nn}var nu=yy(),_y="vercel.ai.gateway.error",an=Symbol.for(_y),wo,Io,Pe=class au extends(Io=Error,wo=an,Io){constructor({message:t,statusCode:r=500,cause:n}){super(t),this[wo]=!0,this.statusCode=r,this.cause=n}static isInstance(t){return au.hasMarker(t)}static hasMarker(t){return typeof t=="object"&&t!==null&&an in t&&t[an]===!0}},ou="GatewayAuthenticationError",by=`vercel.ai.gateway.error.${ou}`,ko=Symbol.for(by),xo,So,Hn=class su extends(So=Pe,xo=ko,So){constructor({message:t="Authentication failed",statusCode:r=401,cause:n}={}){super({message:t,statusCode:r,cause:n}),this[xo]=!0,this.name=ou,this.type="authentication_error"}static isInstance(t){return Pe.hasMarker(t)&&ko in t}static createContextualError({apiKeyProvided:t,oidcTokenProvided:r,message:n="Authentication failed",statusCode:a=401,cause:o}){let s;return t?s=`AI Gateway authentication failed: Invalid API key.

Create a new API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys

Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.`:r?s=`AI Gateway authentication failed: Invalid OIDC token.

Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.

Alternatively, use an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys`:s=`AI Gateway authentication failed: No authentication provided.

Option 1 - API key:
Create an API key: https://vercel.com/d?to=%2F%5Bteam%5D%2F%7E%2Fai%2Fapi-keys
Provide via 'apiKey' option or 'AI_GATEWAY_API_KEY' environment variable.

Option 2 - OIDC token:
Run 'npx vercel link' to link your project, then 'vc env pull' to fetch the token.`,new su({message:s,statusCode:a,cause:o})}},iu="GatewayInvalidRequestError",wy=`vercel.ai.gateway.error.${iu}`,To=Symbol.for(wy),Eo,$o,Iy=class extends($o=Pe,Eo=To,$o){constructor({message:e="Invalid request",statusCode:t=400,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[Eo]=!0,this.name=iu,this.type="invalid_request_error"}static isInstance(e){return Pe.hasMarker(e)&&To in e}},uu="GatewayRateLimitError",ky=`vercel.ai.gateway.error.${uu}`,Ao=Symbol.for(ky),Oo,Co,xy=class extends(Co=Pe,Oo=Ao,Co){constructor({message:e="Rate limit exceeded",statusCode:t=429,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[Oo]=!0,this.name=uu,this.type="rate_limit_exceeded"}static isInstance(e){return Pe.hasMarker(e)&&Ao in e}},lu="GatewayModelNotFoundError",Sy=`vercel.ai.gateway.error.${lu}`,No=Symbol.for(Sy),Ty=jt(()=>yt(g({modelId:c()}))),Po,Ro,cu=class extends(Ro=Pe,Po=No,Ro){constructor({message:e="Model not found",statusCode:t=404,modelId:r,cause:n}={}){super({message:e,statusCode:t,cause:n}),this[Po]=!0,this.name=lu,this.type="model_not_found",this.modelId=r}static isInstance(e){return Pe.hasMarker(e)&&No in e}},du="GatewayInternalServerError",Ey=`vercel.ai.gateway.error.${du}`,Mo=Symbol.for(Ey),zo,Zo,jo=class extends(Zo=Pe,zo=Mo,Zo){constructor({message:e="Internal server error",statusCode:t=500,cause:r}={}){super({message:e,statusCode:t,cause:r}),this[zo]=!0,this.name=du,this.type="internal_server_error"}static isInstance(e){return Pe.hasMarker(e)&&Mo in e}},pu="GatewayResponseError",$y=`vercel.ai.gateway.error.${pu}`,Do=Symbol.for($y),qo,Uo,Ay=class extends(Uo=Pe,qo=Do,Uo){constructor({message:e="Invalid response from Gateway",statusCode:t=502,response:r,validationError:n,cause:a}={}){super({message:e,statusCode:t,cause:a}),this[qo]=!0,this.name=pu,this.type="response_error",this.response=r,this.validationError=n}static isInstance(e){return Pe.hasMarker(e)&&Do in e}};async function Fo({response:e,statusCode:t,defaultMessage:r="Gateway request failed",cause:n,authMethod:a}){const o=await ct({value:e,schema:Oy});if(!o.success)return new Ay({message:`Invalid error response format: ${r}`,statusCode:t,response:e,validationError:o.error,cause:n});const s=o.value,i=s.error.type,l=s.error.message;switch(i){case"authentication_error":return Hn.createContextualError({apiKeyProvided:a==="api-key",oidcTokenProvided:a==="oidc",statusCode:t,cause:n});case"invalid_request_error":return new Iy({message:l,statusCode:t,cause:n});case"rate_limit_exceeded":return new xy({message:l,statusCode:t,cause:n});case"model_not_found":{const u=await ct({value:s.error.param,schema:Ty});return new cu({message:l,statusCode:t,modelId:u.success?u.value.modelId:void 0,cause:n})}case"internal_server_error":return new jo({message:l,statusCode:t,cause:n});default:return new jo({message:l,statusCode:t,cause:n})}}var Oy=jt(()=>yt(g({error:g({message:c(),type:c().nullish(),param:Ve().nullish(),code:U([c(),S()]).nullish()})})));function ht(e,t){var r;return Pe.isInstance(e)?e:Se.isInstance(e)?Fo({response:Cy(e),statusCode:(r=e.statusCode)!=null?r:500,defaultMessage:"Gateway request failed",cause:e,authMethod:t}):Fo({response:{},statusCode:500,defaultMessage:e instanceof Error?`Gateway request failed: ${e.message}`:"Unknown Gateway error",cause:e,authMethod:t})}function Cy(e){if(e.data!==void 0)return e.data;if(e.responseBody!=null)try{return JSON.parse(e.responseBody)}catch{return e.responseBody}return{}}var fu="ai-gateway-auth-method";async function er(e){const t=await ct({value:e[fu],schema:Ny});return t.success?t.value:void 0}var Ny=jt(()=>yt(U([x("api-key"),x("oidc")]))),Lo=class{constructor(e){this.config=e}async getAvailableModels(){try{const{value:e}=await go({url:`${this.config.baseURL}/config`,headers:await nt(this.config.headers()),successfulResponseHandler:Cr(Py),failedResponseHandler:Qt({errorSchema:We(),errorToMessage:t=>t}),fetch:this.config.fetch});return e}catch(e){throw await ht(e)}}async getCredits(){try{const e=new URL(this.config.baseURL),{value:t}=await go({url:`${e.origin}/v1/credits`,headers:await nt(this.config.headers()),successfulResponseHandler:Cr(Ry),failedResponseHandler:Qt({errorSchema:We(),errorToMessage:r=>r}),fetch:this.config.fetch});return t}catch(e){throw await ht(e)}}},Py=jt(()=>yt(g({models:C(g({id:c(),name:c(),description:c().nullish(),pricing:g({input:c(),output:c(),input_cache_read:c().nullish(),input_cache_write:c().nullish()}).transform(({input:e,output:t,input_cache_read:r,input_cache_write:n})=>({input:e,output:t,...r?{cachedInputTokens:r}:{},...n?{cacheCreationInputTokens:n}:{}})).nullish(),specification:g({specificationVersion:x("v3"),provider:c(),modelId:c()}),modelType:oe(["language","embedding","image"]).nullish()}))}))),Ry=jt(()=>yt(g({balance:c(),total_used:c()}).transform(({balance:e,total_used:t})=>({balance:e,totalUsed:t})))),My=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3",this.supportedUrls={"*/*":[/.*/]}}get provider(){return this.config.provider}async getArgs(e){const{abortSignal:t,...r}=e;return{args:this.maybeEncodeFileParts(r),warnings:[]}}async doGenerate(e){const{args:t,warnings:r}=await this.getArgs(e),{abortSignal:n}=e,a=await nt(this.config.headers());try{const{responseHeaders:o,value:s,rawValue:i}=await Tn({url:this.getUrl(),headers:In(a,e.headers,this.getModelConfigHeaders(this.modelId,!1),await nt(this.config.o11yHeaders)),body:t,successfulResponseHandler:Cr(We()),failedResponseHandler:Qt({errorSchema:We(),errorToMessage:l=>l}),...n&&{abortSignal:n},fetch:this.config.fetch});return{...s,request:{body:t},response:{headers:o,body:i},warnings:r}}catch(o){throw await ht(o,await er(a))}}async doStream(e){const{args:t,warnings:r}=await this.getArgs(e),{abortSignal:n}=e,a=await nt(this.config.headers());try{const{value:o,responseHeaders:s}=await Tn({url:this.getUrl(),headers:In(a,e.headers,this.getModelConfigHeaders(this.modelId,!0),await nt(this.config.o11yHeaders)),body:t,successfulResponseHandler:dy(We()),failedResponseHandler:Qt({errorSchema:We(),errorToMessage:i=>i}),...n&&{abortSignal:n},fetch:this.config.fetch});return{stream:o.pipeThrough(new TransformStream({start(i){r.length>0&&i.enqueue({type:"stream-start",warnings:r})},transform(i,l){if(i.success){const u=i.value;if(u.type==="raw"&&!e.includeRawChunks)return;u.type==="response-metadata"&&u.timestamp&&typeof u.timestamp=="string"&&(u.timestamp=new Date(u.timestamp)),l.enqueue(u)}else l.error(i.error)}})),request:{body:t},response:{headers:s}}}catch(o){throw await ht(o,await er(a))}}isFilePart(e){return e&&typeof e=="object"&&"type"in e&&e.type==="file"}maybeEncodeFileParts(e){for(const t of e.prompt)for(const r of t.content)if(this.isFilePart(r)){const n=r;if(n.data instanceof Uint8Array){const a=Uint8Array.from(n.data),o=Buffer.from(a).toString("base64");n.data=new URL(`data:${n.mediaType||"application/octet-stream"};base64,${o}`)}}return e}getUrl(){return`${this.config.baseURL}/language-model`}getModelConfigHeaders(e,t){return{"ai-language-model-specification-version":"2","ai-language-model-id":e,"ai-language-model-streaming":String(t)}}},zy=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v3",this.maxEmbeddingsPerCall=2048,this.supportsParallelCalls=!0}get provider(){return this.config.provider}async doEmbed({values:e,headers:t,abortSignal:r,providerOptions:n}){var a;const o=await nt(this.config.headers());try{const{responseHeaders:s,value:i,rawValue:l}=await Tn({url:this.getUrl(),headers:In(o,t??{},this.getModelConfigHeaders(),await nt(this.config.o11yHeaders)),body:{input:e.length===1?e[0]:e,...n?{providerOptions:n}:{}},successfulResponseHandler:Cr(Zy),failedResponseHandler:Qt({errorSchema:We(),errorToMessage:u=>u}),...r&&{abortSignal:r},fetch:this.config.fetch});return{embeddings:i.embeddings,usage:(a=i.usage)!=null?a:void 0,providerMetadata:i.providerMetadata,response:{headers:s,body:l}}}catch(s){throw await ht(s,await er(o))}}getUrl(){return`${this.config.baseURL}/embedding-model`}getModelConfigHeaders(){return{"ai-embedding-model-specification-version":"2","ai-model-id":this.modelId}}},Zy=jt(()=>yt(g({embeddings:C(C(S())),usage:g({tokens:S()}).nullish(),providerMetadata:ge(c(),ge(c(),Ve())).optional()})));async function jy(){var e;return(e=nu.getContext().headers)==null?void 0:e["x-vercel-id"]}var Dy="2.0.0-beta.37",qy="0.0.1";function Uy(e={}){var t,r;let n=null,a=null;const o=(t=e.metadataCacheRefreshMillis)!=null?t:1e3*60*5;let s=0;const i=(r=my(e.baseURL))!=null?r:"https://ai-gateway.vercel.sh/v1/ai",l=async()=>{const f=await Ly(e);if(f)return jr({Authorization:`Bearer ${f.token}`,"ai-gateway-protocol-version":qy,[fu]:f.authMethod,...e.headers},`ai-sdk/gateway/${Dy}`);throw Hn.createContextualError({apiKeyProvided:!1,oidcTokenProvided:!1,statusCode:401})},u=()=>{const f=kr({settingValue:void 0,environmentVariableName:"VERCEL_DEPLOYMENT_ID"}),y=kr({settingValue:void 0,environmentVariableName:"VERCEL_ENV"}),_=kr({settingValue:void 0,environmentVariableName:"VERCEL_REGION"});return async()=>{const b=await jy();return{...f&&{"ai-o11y-deployment-id":f},...y&&{"ai-o11y-environment":y},..._&&{"ai-o11y-region":_},...b&&{"ai-o11y-request-id":b}}}},d=f=>new My(f,{provider:"gateway",baseURL:i,headers:l,fetch:e.fetch,o11yHeaders:u()}),m=async()=>{var f,y,_;const b=(_=(y=(f=e._internal)==null?void 0:f.currentDate)==null?void 0:y.call(f).getTime())!=null?_:Date.now();return(!n||b-s>o)&&(s=b,n=new Lo({baseURL:i,headers:l,fetch:e.fetch}).getAvailableModels().then(I=>(a=I,I)).catch(async I=>{throw await ht(I,await er(await l()))})),a?Promise.resolve(a):n},p=async()=>new Lo({baseURL:i,headers:l,fetch:e.fetch}).getCredits().catch(async f=>{throw await ht(f,await er(await l()))}),h=function(f){if(new.target)throw new Error("The Gateway Provider model function cannot be called with the new keyword.");return d(f)};return h.getAvailableModels=m,h.getCredits=p,h.imageModel=f=>{throw new Yg({modelId:f,modelType:"imageModel"})},h.languageModel=d,h.textEmbeddingModel=f=>new zy(f,{provider:"gateway",baseURL:i,headers:l,fetch:e.fetch,o11yHeaders:u()}),h}var Fy=Uy();async function Ly(e){const t=kr({settingValue:e.apiKey,environmentVariableName:"AI_GATEWAY_API_KEY"});if(t)return{token:t,authMethod:"api-key"};try{return{token:await nu.getVercelOidcToken(),authMethod:"oidc"}}catch{return null}}var Vy=typeof globalThis=="object"?globalThis:typeof self=="object"?self:typeof window=="object"?window:typeof global=="object"?global:{},ft="1.9.0",Vo=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function By(e){var t=new Set([e]),r=new Set,n=e.match(Vo);if(!n)return function(){return!1};var a={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(a.prerelease!=null)return function(l){return l===e};function o(i){return r.add(i),!1}function s(i){return t.add(i),!0}return function(l){if(t.has(l))return!0;if(r.has(l))return!1;var u=l.match(Vo);if(!u)return o(l);var d={major:+u[1],minor:+u[2],patch:+u[3],prerelease:u[4]};return d.prerelease!=null||a.major!==d.major?o(l):a.major===0?a.minor===d.minor&&a.patch<=d.patch?s(l):o(l):a.minor<=d.minor?s(l):o(l)}}var Jy=By(ft),Gy=ft.split(".")[0],tr=Symbol.for("opentelemetry.js.api."+Gy),rr=Vy;function Kn(e,t,r,n){var a;n===void 0&&(n=!1);var o=rr[tr]=(a=rr[tr])!==null&&a!==void 0?a:{version:ft};if(!n&&o[e]){var s=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return r.error(s.stack||s.message),!1}if(o.version!==ft){var s=new Error("@opentelemetry/api: Registration of version v"+o.version+" for "+e+" does not match previously registered API v"+ft);return r.error(s.stack||s.message),!1}return o[e]=t,r.debug("@opentelemetry/api: Registered a global for "+e+" v"+ft+"."),!0}function nr(e){var t,r,n=(t=rr[tr])===null||t===void 0?void 0:t.version;if(!(!n||!Jy(n)))return(r=rr[tr])===null||r===void 0?void 0:r[e]}function Yn(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+ft+".");var r=rr[tr];r&&delete r[e]}var Wy=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},Hy=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},Ky=(function(){function e(t){this._namespace=t.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Ft("debug",this._namespace,t)},e.prototype.error=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Ft("error",this._namespace,t)},e.prototype.info=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Ft("info",this._namespace,t)},e.prototype.warn=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Ft("warn",this._namespace,t)},e.prototype.verbose=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return Ft("verbose",this._namespace,t)},e})();function Ft(e,t,r){var n=nr("diag");if(n)return r.unshift(t),n[e].apply(n,Hy([],Wy(r),!1))}var Oe;(function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"})(Oe||(Oe={}));function Yy(e,t){e<Oe.NONE?e=Oe.NONE:e>Oe.ALL&&(e=Oe.ALL),t=t||{};function r(n,a){var o=t[n];return typeof o=="function"&&e>=a?o.bind(t):function(){}}return{error:r("error",Oe.ERROR),warn:r("warn",Oe.WARN),info:r("info",Oe.INFO),debug:r("debug",Oe.DEBUG),verbose:r("verbose",Oe.VERBOSE)}}var Xy=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},Qy=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},e_="diag",Nr=(function(){function e(){function t(a){return function(){for(var o=[],s=0;s<arguments.length;s++)o[s]=arguments[s];var i=nr("diag");if(i)return i[a].apply(i,Qy([],Xy(o),!1))}}var r=this,n=function(a,o){var s,i,l;if(o===void 0&&(o={logLevel:Oe.INFO}),a===r){var u=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return r.error((s=u.stack)!==null&&s!==void 0?s:u.message),!1}typeof o=="number"&&(o={logLevel:o});var d=nr("diag"),m=Yy((i=o.logLevel)!==null&&i!==void 0?i:Oe.INFO,a);if(d&&!o.suppressOverrideMessage){var p=(l=new Error().stack)!==null&&l!==void 0?l:"<failed to generate stacktrace>";d.warn("Current logger will be overwritten from "+p),m.warn("Current logger will overwrite one already registered from "+p)}return Kn("diag",m,r,!0)};r.setLogger=n,r.disable=function(){Yn(e_,r)},r.createComponentLogger=function(a){return new Ky(a)},r.verbose=t("verbose"),r.debug=t("debug"),r.info=t("info"),r.warn=t("warn"),r.error=t("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e})();function t_(e){return Symbol.for(e)}var r_=(function(){function e(t){var r=this;r._currentContext=t?new Map(t):new Map,r.getValue=function(n){return r._currentContext.get(n)},r.setValue=function(n,a){var o=new e(r._currentContext);return o._currentContext.set(n,a),o},r.deleteValue=function(n){var a=new e(r._currentContext);return a._currentContext.delete(n),a}}return e})(),n_=new r_,a_=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},o_=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},s_=(function(){function e(){}return e.prototype.active=function(){return n_},e.prototype.with=function(t,r,n){for(var a=[],o=3;o<arguments.length;o++)a[o-3]=arguments[o];return r.call.apply(r,o_([n],a_(a),!1))},e.prototype.bind=function(t,r){return r},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e})(),i_=function(e,t){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),a,o=[],s;try{for(;(t===void 0||t-- >0)&&!(a=n.next()).done;)o.push(a.value)}catch(i){s={error:i}}finally{try{a&&!a.done&&(r=n.return)&&r.call(n)}finally{if(s)throw s.error}}return o},u_=function(e,t,r){if(r||arguments.length===2)for(var n=0,a=t.length,o;n<a;n++)(o||!(n in t))&&(o||(o=Array.prototype.slice.call(t,0,n)),o[n]=t[n]);return e.concat(o||Array.prototype.slice.call(t))},on="context",l_=new s_,mu=(function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(t){return Kn(on,t,Nr.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(t,r,n){for(var a,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return(a=this._getContextManager()).with.apply(a,u_([t,r,n],i_(o),!1))},e.prototype.bind=function(t,r){return this._getContextManager().bind(t,r)},e.prototype._getContextManager=function(){return nr(on)||l_},e.prototype.disable=function(){this._getContextManager().disable(),Yn(on,Nr.instance())},e})(),$n;(function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"})($n||($n={}));var hu="0000000000000000",gu="00000000000000000000000000000000",c_={traceId:gu,spanId:hu,traceFlags:$n.NONE},Gt=(function(){function e(t){t===void 0&&(t=c_),this._spanContext=t}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(t,r){return this},e.prototype.setAttributes=function(t){return this},e.prototype.addEvent=function(t,r){return this},e.prototype.addLink=function(t){return this},e.prototype.addLinks=function(t){return this},e.prototype.setStatus=function(t){return this},e.prototype.updateName=function(t){return this},e.prototype.end=function(t){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(t,r){},e})(),Xn=t_("OpenTelemetry Context Key SPAN");function Qn(e){return e.getValue(Xn)||void 0}function d_(){return Qn(mu.getInstance().active())}function ea(e,t){return e.setValue(Xn,t)}function p_(e){return e.deleteValue(Xn)}function f_(e,t){return ea(e,new Gt(t))}function vu(e){var t;return(t=Qn(e))===null||t===void 0?void 0:t.spanContext()}var m_=/^([0-9a-f]{32})$/i,h_=/^[0-9a-f]{16}$/i;function g_(e){return m_.test(e)&&e!==gu}function v_(e){return h_.test(e)&&e!==hu}function yu(e){return g_(e.traceId)&&v_(e.spanId)}function y_(e){return new Gt(e)}var sn=mu.getInstance(),_u=(function(){function e(){}return e.prototype.startSpan=function(t,r,n){n===void 0&&(n=sn.active());var a=!!r?.root;if(a)return new Gt;var o=n&&vu(n);return __(o)&&yu(o)?new Gt(o):new Gt},e.prototype.startActiveSpan=function(t,r,n,a){var o,s,i;if(!(arguments.length<2)){arguments.length===2?i=r:arguments.length===3?(o=r,i=n):(o=r,s=n,i=a);var l=s??sn.active(),u=this.startSpan(t,o,l),d=ea(l,u);return sn.with(d,i,void 0,u)}},e})();function __(e){return typeof e=="object"&&typeof e.spanId=="string"&&typeof e.traceId=="string"&&typeof e.traceFlags=="number"}var b_=new _u,w_=(function(){function e(t,r,n,a){this._provider=t,this.name=r,this.version=n,this.options=a}return e.prototype.startSpan=function(t,r,n){return this._getTracer().startSpan(t,r,n)},e.prototype.startActiveSpan=function(t,r,n,a){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var t=this._provider.getDelegateTracer(this.name,this.version,this.options);return t?(this._delegate=t,this._delegate):b_},e})(),I_=(function(){function e(){}return e.prototype.getTracer=function(t,r,n){return new _u},e})(),k_=new I_,Bo=(function(){function e(){}return e.prototype.getTracer=function(t,r,n){var a;return(a=this.getDelegateTracer(t,r,n))!==null&&a!==void 0?a:new w_(this,t,r,n)},e.prototype.getDelegate=function(){var t;return(t=this._delegate)!==null&&t!==void 0?t:k_},e.prototype.setDelegate=function(t){this._delegate=t},e.prototype.getDelegateTracer=function(t,r,n){var a;return(a=this._delegate)===null||a===void 0?void 0:a.getTracer(t,r,n)},e})(),Pr;(function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"})(Pr||(Pr={}));var un="trace",x_=(function(){function e(){this._proxyTracerProvider=new Bo,this.wrapSpanContext=y_,this.isSpanContextValid=yu,this.deleteSpan=p_,this.getSpan=Qn,this.getActiveSpan=d_,this.getSpanContext=vu,this.setSpan=ea,this.setSpanContext=f_}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(t){var r=Kn(un,this._proxyTracerProvider,Nr.instance());return r&&this._proxyTracerProvider.setDelegate(t),r},e.prototype.getTracerProvider=function(){return nr(un)||this._proxyTracerProvider},e.prototype.getTracer=function(t,r){return this.getTracerProvider().getTracer(t,r)},e.prototype.disable=function(){Yn(un,Nr.instance()),this._proxyTracerProvider=new Bo},e})(),S_=x_.getInstance(),T_=Object.defineProperty,E_=(e,t)=>{for(var r in t)T_(e,r,{get:t[r],enumerable:!0})},bu="AI_NoOutputSpecifiedError",wu=`vercel.ai.error.${bu}`,$_=Symbol.for(wu),Iu,A_=class extends D{constructor({message:e="No output specified."}={}){super({name:bu,message:e}),this[Iu]=!0}static isInstance(e){return D.hasMarker(e,wu)}};Iu=$_;function O_(e){const t="AI SDK Warning:";switch(e.type){case"unsupported-setting":{let r=`${t} The "${e.setting}" setting is not supported by this model`;return e.details&&(r+=` - ${e.details}`),r}case"unsupported-tool":{const r="name"in e.tool?e.tool.name:"unknown tool";let n=`${t} The tool "${r}" is not supported by this model`;return e.details&&(n+=` - ${e.details}`),n}case"other":return`${t} ${e.message}`;default:return`${t} ${JSON.stringify(e,null,2)}`}}var C_="AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.",Jo=!1,N_=e=>{if(e.length===0)return;const t=globalThis.AI_SDK_LOG_WARNINGS;if(t!==!1){if(typeof t=="function"){t(e);return}Jo||(Jo=!0,console.info(C_));for(const r of e)console.warn(O_(r))}},ku="AI_InvalidArgumentError",xu=`vercel.ai.error.${ku}`,P_=Symbol.for(xu),Su,Ge=class extends D{constructor({parameter:e,value:t,message:r}){super({name:ku,message:`Invalid argument for parameter ${e}: ${r}`}),this[Su]=!0,this.parameter=e,this.value=t}static isInstance(e){return D.hasMarker(e,xu)}};Su=P_;var Tu="AI_InvalidToolInputError",Eu=`vercel.ai.error.${Tu}`,R_=Symbol.for(Eu),$u,ta=class extends D{constructor({toolInput:e,toolName:t,cause:r,message:n=`Invalid input for tool ${t}: ${Zt(r)}`}){super({name:Tu,message:n,cause:r}),this[$u]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return D.hasMarker(e,Eu)}};$u=R_;var Au="AI_NoObjectGeneratedError",Ou=`vercel.ai.error.${Au}`,M_=Symbol.for(Ou),Cu,Go=class extends D{constructor({message:e="No object generated.",cause:t,text:r,response:n,usage:a,finishReason:o}){super({name:Au,message:e,cause:t}),this[Cu]=!0,this.text=r,this.response=n,this.usage=a,this.finishReason=o}static isInstance(e){return D.hasMarker(e,Ou)}};Cu=M_;var Nu="AI_NoOutputGeneratedError",Pu=`vercel.ai.error.${Nu}`,z_=Symbol.for(Pu),Ru,Z_=class extends D{constructor({message:e="No output generated.",cause:t}={}){super({name:Nu,message:e,cause:t}),this[Ru]=!0}static isInstance(e){return D.hasMarker(e,Pu)}};Ru=z_;var Mu="AI_NoSuchToolError",zu=`vercel.ai.error.${Mu}`,j_=Symbol.for(zu),Zu,An=class extends D{constructor({toolName:e,availableTools:t=void 0,message:r=`Model tried to call unavailable tool '${e}'. ${t===void 0?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:Mu,message:r}),this[Zu]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return D.hasMarker(e,zu)}};Zu=j_;var ju="AI_ToolCallRepairError",Du=`vercel.ai.error.${ju}`,D_=Symbol.for(Du),qu,q_=class extends D{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${Zt(e)}`}){super({name:ju,message:r,cause:e}),this[qu]=!0,this.originalError=t}static isInstance(e){return D.hasMarker(e,Du)}};qu=D_;var U_=class extends D{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},Uu="AI_InvalidMessageRoleError",Fu=`vercel.ai.error.${Uu}`,F_=Symbol.for(Fu),Lu,L_=class extends D{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:Uu,message:t}),this[Lu]=!0,this.role=e}static isInstance(e){return D.hasMarker(e,Fu)}};Lu=F_;var Vu="AI_MessageConversionError",Bu=`vercel.ai.error.${Vu}`,V_=Symbol.for(Bu),Ju,B_=class extends D{constructor({originalMessage:e,message:t}){super({name:Vu,message:t}),this[Ju]=!0,this.originalMessage=e}static isInstance(e){return D.hasMarker(e,Bu)}};Ju=V_;var Gu="AI_DownloadError",Wu=`vercel.ai.error.${Gu}`,J_=Symbol.for(Wu),Hu,ln=class extends D{constructor({url:e,statusCode:t,statusText:r,cause:n,message:a=n==null?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${n}`}){super({name:Gu,message:a,cause:n}),this[Hu]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return D.hasMarker(e,Wu)}};Hu=J_;var Ku="AI_RetryError",Yu=`vercel.ai.error.${Ku}`,G_=Symbol.for(Yu),Xu,Wo=class extends D{constructor({message:e,reason:t,errors:r}){super({name:Ku,message:e}),this[Xu]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return D.hasMarker(e,Yu)}};Xu=G_;function W_(e){return new Proxy(e,{get(t,r){return r==="specificationVersion"?"v3":t[r]}})}function Qu(e){if(typeof e!="string"){if(e.specificationVersion!=="v3"&&e.specificationVersion!=="v2"){const t=e;throw new U_({version:t.specificationVersion,provider:t.provider,modelId:t.modelId})}return e.specificationVersion==="v2"?W_(e):e}return H_().languageModel(e)}function H_(){var e;return(e=globalThis.AI_SDK_DEFAULT_PROVIDER)!=null?e:Fy}var K_=[{mediaType:"image/gif",bytesPrefix:[71,73,70]},{mediaType:"image/png",bytesPrefix:[137,80,78,71]},{mediaType:"image/jpeg",bytesPrefix:[255,216]},{mediaType:"image/webp",bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:"image/bmp",bytesPrefix:[66,77]},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0]},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42]},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],Y_=e=>{const t=typeof e=="string"?Wn(e):e,r=(t[6]&127)<<21|(t[7]&127)<<14|(t[8]&127)<<7|t[9]&127;return t.slice(r+10)};function X_(e){return typeof e=="string"&&e.startsWith("SUQz")||typeof e!="string"&&e.length>10&&e[0]===73&&e[1]===68&&e[2]===51?Y_(e):e}function Q_({data:e,signatures:t}){const r=X_(e),n=typeof r=="string"?Wn(r.substring(0,Math.min(r.length,24))):r;for(const a of t)if(n.length>=a.bytesPrefix.length&&a.bytesPrefix.every((o,s)=>o===null||n[s]===o))return a.mediaType}var eb="6.0.0-beta.68",tb=async({url:e})=>{var t;const r=e.toString();try{const n=await fetch(r,{headers:jr({},`ai-sdk/${eb}`,Gn())});if(!n.ok)throw new ln({url:r,statusCode:n.status,statusText:n.statusText});return{data:new Uint8Array(await n.arrayBuffer()),mediaType:(t=n.headers.get("content-type"))!=null?t:void 0}}catch(n){throw ln.isInstance(n)?n:new ln({url:r,cause:n})}},rb=(e=tb)=>t=>Promise.all(t.map(async r=>r.isUrlSupportedByModel?null:e(r)));function nb(e){try{const[t,r]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:r}}catch{return{mediaType:void 0,base64Content:void 0}}}var el=U([c(),Er(Uint8Array),Er(ArrayBuffer),om(e=>{var t,r;return(r=(t=globalThis.Buffer)==null?void 0:t.isBuffer(e))!=null?r:!1},{message:"Must be a Buffer"})]);function tl(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if(typeof e=="string")try{e=new URL(e)}catch{}if(e instanceof URL&&e.protocol==="data:"){const{mediaType:t,base64Content:r}=nb(e.toString());if(t==null||r==null)throw new D({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:r,mediaType:t}}return{data:e,mediaType:void 0}}function ab(e){return typeof e=="string"?e:e instanceof ArrayBuffer?En(new Uint8Array(e)):En(e)}async function ob({prompt:e,supportedUrls:t,download:r=rb()}){const n=await ib(e.messages,r,t),a=[...e.system!=null?[{role:"system",content:e.system}]:[],...e.messages.map(s=>sb({message:s,downloadedAssets:n}))],o=[];for(const s of a){if(s.role!=="tool"){o.push(s);continue}const i=o.at(-1);i?.role==="tool"?i.content.push(...s.content):o.push(s)}return o}function sb({message:e,downloadedAssets:t}){const r=e.role;switch(r){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":return typeof e.content=="string"?{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions}:{role:"user",content:e.content.map(n=>ub(n,t)).filter(n=>n.type!=="text"||n.text!==""),providerOptions:e.providerOptions};case"assistant":return typeof e.content=="string"?{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions}:{role:"assistant",content:e.content.filter(n=>n.type!=="text"||n.text!==""||n.providerOptions!=null).filter(n=>n.type!=="tool-approval-request").map(n=>{const a=n.providerOptions;switch(n.type){case"file":{const{data:o,mediaType:s}=tl(n.data);return{type:"file",data:o,filename:n.filename,mediaType:s??n.mediaType,providerOptions:a}}case"reasoning":return{type:"reasoning",text:n.text,providerOptions:a};case"text":return{type:"text",text:n.text,providerOptions:a};case"tool-call":return{type:"tool-call",toolCallId:n.toolCallId,toolName:n.toolName,input:n.input,providerExecuted:n.providerExecuted,providerOptions:a};case"tool-result":return{type:"tool-result",toolCallId:n.toolCallId,toolName:n.toolName,output:Ho(n.output),providerOptions:a}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.filter(n=>n.type!=="tool-approval-response").map(n=>({type:"tool-result",toolCallId:n.toolCallId,toolName:n.toolName,output:Ho(n.output),providerOptions:n.providerOptions})),providerOptions:e.providerOptions};default:{const n=r;throw new L_({role:n})}}}async function ib(e,t,r){const n=e.filter(o=>o.role==="user").map(o=>o.content).filter(o=>Array.isArray(o)).flat().filter(o=>o.type==="image"||o.type==="file").map(o=>{var s;const i=(s=o.mediaType)!=null?s:o.type==="image"?"image/*":void 0;let l=o.type==="image"?o.image:o.data;if(typeof l=="string")try{l=new URL(l)}catch{}return{mediaType:i,data:l}}).filter(o=>o.data instanceof URL).map(o=>({url:o.data,isUrlSupportedByModel:o.mediaType!=null&&iv({url:o.data.toString(),mediaType:o.mediaType,supportedUrls:r})})),a=await t(n);return Object.fromEntries(a.map((o,s)=>o==null?null:[n[s].url.toString(),{data:o.data,mediaType:o.mediaType}]).filter(o=>o!=null))}function ub(e,t){var r;if(e.type==="text")return{type:"text",text:e.text,providerOptions:e.providerOptions};let n;const a=e.type;switch(a){case"image":n=e.image;break;case"file":n=e.data;break;default:throw new Error(`Unsupported part type: ${a}`)}const{data:o,mediaType:s}=tl(n);let i=s??e.mediaType,l=o;if(l instanceof URL){const u=t[l.toString()];u&&(l=u.data,i??(i=u.mediaType))}switch(a){case"image":return(l instanceof Uint8Array||typeof l=="string")&&(i=(r=Q_({data:l,signatures:K_}))!=null?r:i),{type:"file",mediaType:i??"image/*",filename:void 0,data:l,providerOptions:e.providerOptions};case"file":{if(i==null)throw new Error("Media type is missing for file part");return{type:"file",mediaType:i,filename:e.filename,data:l,providerOptions:e.providerOptions}}}}function Ho(e){return e.type!=="content"?e:{type:"content",value:e.value.map(t=>t.type!=="media"?t:t.mediaType.startsWith("image/")?{type:"image-data",data:t.data,mediaType:t.mediaType}:{type:"file-data",data:t.data,mediaType:t.mediaType})}}function Nt({output:e,tool:t,errorMode:r}){return r==="text"?{type:"error-text",value:Zt(e)}:r==="json"?{type:"error-json",value:Ko(e)}:t?.toModelOutput?t.toModelOutput(e):typeof e=="string"?{type:"text",value:e}:{type:"json",value:Ko(e)}}function Ko(e){return e===void 0?null:e}function lb({maxOutputTokens:e,temperature:t,topP:r,topK:n,presencePenalty:a,frequencyPenalty:o,seed:s,stopSequences:i}){if(e!=null){if(!Number.isInteger(e))throw new Ge({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new Ge({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(t!=null&&typeof t!="number")throw new Ge({parameter:"temperature",value:t,message:"temperature must be a number"});if(r!=null&&typeof r!="number")throw new Ge({parameter:"topP",value:r,message:"topP must be a number"});if(n!=null&&typeof n!="number")throw new Ge({parameter:"topK",value:n,message:"topK must be a number"});if(a!=null&&typeof a!="number")throw new Ge({parameter:"presencePenalty",value:a,message:"presencePenalty must be a number"});if(o!=null&&typeof o!="number")throw new Ge({parameter:"frequencyPenalty",value:o,message:"frequencyPenalty must be a number"});if(s!=null&&!Number.isInteger(s))throw new Ge({parameter:"seed",value:s,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:r,topK:n,presencePenalty:a,frequencyPenalty:o,stopSequences:i,seed:s}}function cb(e){return e!=null&&Object.keys(e).length>0}async function db({tools:e,toolChoice:t,activeTools:r}){if(!cb(e))return{tools:void 0,toolChoice:void 0};const n=r!=null?Object.entries(e).filter(([o])=>r.includes(o)):Object.entries(e),a=[];for(const[o,s]of n){const i=s.type;switch(i){case void 0:case"dynamic":case"function":a.push({type:"function",name:o,description:s.description,inputSchema:await dr(s.inputSchema).jsonSchema,providerOptions:s.providerOptions});break;case"provider-defined":a.push({type:"provider-defined",name:o,id:s.id,args:s.args});break;default:{const l=i;throw new Error(`Unsupported tool type: ${l}`)}}}return{tools:a,toolChoice:t==null?{type:"auto"}:typeof t=="string"?{type:t}:{type:"tool",toolName:t.toolName}}}var ar=hi(()=>U([Rf(),c(),S(),ce(),ge(c(),ar),C(ar)])),re=ge(c(),ge(c(),ar)),rl=g({type:x("text"),text:c(),providerOptions:re.optional()}),pb=g({type:x("image"),image:U([el,Er(URL)]),mediaType:c().optional(),providerOptions:re.optional()}),nl=g({type:x("file"),data:U([el,Er(URL)]),filename:c().optional(),mediaType:c(),providerOptions:re.optional()}),fb=g({type:x("reasoning"),text:c(),providerOptions:re.optional()}),mb=g({type:x("tool-call"),toolCallId:c(),toolName:c(),input:Ve(),providerOptions:re.optional(),providerExecuted:ce().optional()}),hb=Ee("type",[g({type:x("text"),value:c(),providerOptions:re.optional()}),g({type:x("json"),value:ar,providerOptions:re.optional()}),g({type:x("execution-denied"),reason:c().optional(),providerOptions:re.optional()}),g({type:x("error-text"),value:c(),providerOptions:re.optional()}),g({type:x("error-json"),value:ar,providerOptions:re.optional()}),g({type:x("content"),value:C(U([g({type:x("text"),text:c(),providerOptions:re.optional()}),g({type:x("media"),data:c(),mediaType:c()}),g({type:x("file-data"),data:c(),mediaType:c(),filename:c().optional(),providerOptions:re.optional()}),g({type:x("file-url"),url:c(),providerOptions:re.optional()}),g({type:x("file-id"),fileId:U([c(),ge(c(),c())]),providerOptions:re.optional()}),g({type:x("image-data"),data:c(),mediaType:c(),providerOptions:re.optional()}),g({type:x("image-url"),url:c(),providerOptions:re.optional()}),g({type:x("image-file-id"),fileId:U([c(),ge(c(),c())]),providerOptions:re.optional()}),g({type:x("custom"),providerOptions:re.optional()})]))})]),al=g({type:x("tool-result"),toolCallId:c(),toolName:c(),output:hb,providerOptions:re.optional()}),gb=g({type:x("tool-approval-request"),approvalId:c(),toolCallId:c()}),vb=g({type:x("tool-approval-response"),approvalId:c(),approved:ce(),reason:c().optional()}),yb=g({role:x("system"),content:c(),providerOptions:re.optional()}),_b=g({role:x("user"),content:U([c(),C(U([rl,pb,nl]))]),providerOptions:re.optional()}),bb=g({role:x("assistant"),content:U([c(),C(U([rl,nl,fb,mb,al,gb]))]),providerOptions:re.optional()}),wb=g({role:x("tool"),content:C(U([al,vb])),providerOptions:re.optional()}),Ib=U([yb,_b,bb,wb]);async function kb(e){if(e.prompt==null&&e.messages==null)throw new St({prompt:e,message:"prompt or messages must be defined"});if(e.prompt!=null&&e.messages!=null)throw new St({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(e.system!=null&&typeof e.system!="string")throw new St({prompt:e,message:"system must be a string"});let t;if(e.prompt!=null&&typeof e.prompt=="string")t=[{role:"user",content:e.prompt}];else if(e.prompt!=null&&Array.isArray(e.prompt))t=e.prompt;else if(e.messages!=null)t=e.messages;else throw new St({prompt:e,message:"prompt or messages must be defined"});if(t.length===0)throw new St({prompt:e,message:"messages must not be empty"});const r=await ct({value:t,schema:C(Ib)});if(!r.success)throw new St({prompt:e,message:"The messages must be a ModelMessage[]. If you have passed a UIMessage[], you can use convertToModelMessages to convert them.",cause:r.error});return{messages:t,system:e.system}}function xb(e){return Hn.isInstance(e)||cu.isInstance(e)?new D({name:"GatewayError",message:"Vercel AI Gateway access failed. If you want to use AI SDK providers directly, use the providers, e.g. @ai-sdk/openai, or register a different global default provider.",cause:e}):e}function On({operationId:e,telemetry:t}){return{"operation.name":`${e}${t?.functionId!=null?` ${t.functionId}`:""}`,"resource.name":t?.functionId,"ai.operationId":e,"ai.telemetry.functionId":t?.functionId}}function Sb({model:e,settings:t,telemetry:r,headers:n}){var a;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((o,[s,i])=>(o[`ai.settings.${s}`]=i,o),{}),...Object.entries((a=r?.metadata)!=null?a:{}).reduce((o,[s,i])=>(o[`ai.telemetry.metadata.${s}`]=i,o),{}),...Object.entries(n??{}).reduce((o,[s,i])=>(i!==void 0&&(o[`ai.request.headers.${s}`]=i),o),{})}}var Tb={startSpan(){return wr},startActiveSpan(e,t,r,n){if(typeof t=="function")return t(wr);if(typeof r=="function")return r(wr);if(typeof n=="function")return n(wr)}},wr={spanContext(){return Eb},setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording(){return!1},recordException(){return this}},Eb={traceId:"",spanId:"",traceFlags:0};function $b({isEnabled:e=!1,tracer:t}={}){return e?t||S_.getTracer("ai"):Tb}async function Cn({name:e,tracer:t,attributes:r,fn:n,endWhenDone:a=!0}){return t.startActiveSpan(e,{attributes:await r},async o=>{try{const s=await n(o);return a&&o.end(),s}catch(s){try{ol(o,s)}finally{o.end()}throw s}})}function ol(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:Pr.ERROR,message:t.message})):e.setStatus({code:Pr.ERROR})}async function Ot({telemetry:e,attributes:t}){if(e?.isEnabled!==!0)return{};const r={};for(const[n,a]of Object.entries(t))if(a!=null){if(typeof a=="object"&&"input"in a&&typeof a.input=="function"){if(e?.recordInputs===!1)continue;const o=await a.input();o!=null&&(r[n]=o);continue}if(typeof a=="object"&&"output"in a&&typeof a.output=="function"){if(e?.recordOutputs===!1)continue;const o=await a.output();o!=null&&(r[n]=o);continue}r[n]=a}return r}function Ab(e){return JSON.stringify(e.map(t=>({...t,content:typeof t.content=="string"?t.content:t.content.map(r=>r.type==="file"?{...r,data:r.data instanceof Uint8Array?ab(r.data):r.data}:r)})))}function Ob(e,t){return{inputTokens:Lt(e.inputTokens,t.inputTokens),outputTokens:Lt(e.outputTokens,t.outputTokens),totalTokens:Lt(e.totalTokens,t.totalTokens),reasoningTokens:Lt(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:Lt(e.cachedInputTokens,t.cachedInputTokens)}}function Lt(e,t){return e==null&&t==null?void 0:(e??0)+(t??0)}function Yo(e){return e===void 0?[]:Array.isArray(e)?e:[e]}function Cb({error:e,exponentialBackoffDelay:t}){const r=e.responseHeaders;if(!r)return t;let n;const a=r["retry-after-ms"];if(a){const s=parseFloat(a);Number.isNaN(s)||(n=s)}const o=r["retry-after"];if(o&&n===void 0){const s=parseFloat(o);Number.isNaN(s)?n=Date.parse(o)-Date.now():n=s*1e3}return n!=null&&!Number.isNaN(n)&&0<=n&&(n<60*1e3||n<t)?n:t}var Nb=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2,abortSignal:n}={})=>async a=>sl(a,{maxRetries:e,delayInMs:t,backoffFactor:r,abortSignal:n});async function sl(e,{maxRetries:t,delayInMs:r,backoffFactor:n,abortSignal:a},o=[]){try{return await e()}catch(s){if(mt(s)||t===0)throw s;const i=Hi(s),l=[...o,s],u=l.length;if(u>t)throw new Wo({message:`Failed after ${u} attempts. Last error: ${i}`,reason:"maxRetriesExceeded",errors:l});if(s instanceof Error&&Se.isInstance(s)&&s.isRetryable===!0&&u<=t)return await rv(Cb({error:s,exponentialBackoffDelay:r}),{abortSignal:a}),sl(e,{maxRetries:t,delayInMs:n*r,backoffFactor:n,abortSignal:a},l);throw u===1?s:new Wo({message:`Failed after ${u} attempts with non-retryable error: '${i}'`,reason:"errorNotRetryable",errors:l})}}function Pb({maxRetries:e,abortSignal:t}){if(e!=null){if(!Number.isInteger(e))throw new Ge({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new Ge({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}const r=e??2;return{maxRetries:r,retry:Nb({maxRetries:r,abortSignal:t})}}function Rb({messages:e}){const t=e.at(-1);if(t?.role!="tool")return{approvedToolApprovals:[],deniedToolApprovals:[]};const r={};for(const l of e)if(l.role==="assistant"&&typeof l.content!="string"){const u=l.content;for(const d of u)d.type==="tool-call"&&(r[d.toolCallId]=d)}const n={};for(const l of e)if(l.role==="assistant"&&typeof l.content!="string"){const u=l.content;for(const d of u)d.type==="tool-approval-request"&&(n[d.approvalId]=d)}const a={};for(const l of t.content)l.type==="tool-result"&&(a[l.toolCallId]=l);const o=[],s=[],i=t.content.filter(l=>l.type==="tool-approval-response");for(const l of i){const u=n[l.approvalId];if(a[u.toolCallId]!=null)continue;const d={approvalRequest:u,approvalResponse:l,toolCall:r[u.toolCallId]};l.approved?o.push(d):s.push(d)}return{approvedToolApprovals:o,deniedToolApprovals:s}}async function il({toolCall:e,tools:t,tracer:r,telemetry:n,messages:a,abortSignal:o,experimental_context:s,onPreliminaryToolResult:i}){const{toolName:l,toolCallId:u,input:d}=e,m=t?.[l];if(m?.execute!=null)return Cn({name:"ai.toolCall",attributes:Ot({telemetry:n,attributes:{...On({operationId:"ai.toolCall",telemetry:n}),"ai.toolCall.name":l,"ai.toolCall.id":u,"ai.toolCall.args":{output:()=>JSON.stringify(d)}}}),tracer:r,fn:async p=>{let h;try{const f=gy({execute:m.execute.bind(m),input:d,options:{toolCallId:u,messages:a,abortSignal:o,experimental_context:s}});for await(const y of f)y.type==="preliminary"?i?.({...e,type:"tool-result",output:y.output,preliminary:!0}):h=y.output}catch(f){return ol(p,f),{type:"tool-error",toolCallId:u,toolName:l,input:d,error:f,dynamic:m.type==="dynamic"}}try{p.setAttributes(await Ot({telemetry:n,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(h)}}}))}catch{}return{type:"tool-result",toolCallId:u,toolName:l,input:d,output:h,dynamic:m.type==="dynamic"}}})}var Mb=class{constructor({data:e,mediaType:t}){const r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mediaType=t}get base64(){return this.base64Data==null&&(this.base64Data=En(this.uint8ArrayData)),this.base64Data}get uint8Array(){return this.uint8ArrayData==null&&(this.uint8ArrayData=Wn(this.base64Data)),this.uint8ArrayData}},zb=class extends Mb{constructor(e){super(e),this.type="file"}};async function Zb({tool:e,toolCall:t,messages:r,experimental_context:n}){return e.needsApproval==null?!1:typeof e.needsApproval=="boolean"?e.needsApproval:await e.needsApproval(t.input,{toolCallId:t.toolCallId,messages:r,experimental_context:n})}async function jb({toolCall:e,tools:t,repairToolCall:r,system:n,messages:a}){try{if(t==null){if(e.providerExecuted&&e.dynamic)return await ul(e);throw new An({toolName:e.toolName})}try{return await Xo({toolCall:e,tools:t})}catch(o){if(r==null||!(An.isInstance(o)||ta.isInstance(o)))throw o;let s=null;try{s=await r({toolCall:e,tools:t,inputSchema:async({toolName:i})=>{const{inputSchema:l}=t[i];return await dr(l).jsonSchema},system:n,messages:a,error:o})}catch(i){throw new q_({cause:i,originalError:o})}if(s==null)throw o;return await Xo({toolCall:s,tools:t})}}catch(o){const s=await dt({text:e.input}),i=s.success?s.value:e.input;return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:i,dynamic:!0,invalid:!0,error:o}}}async function ul(e){const t=e.input.trim()===""?{success:!0,value:{}}:await dt({text:e.input});if(t.success===!1)throw new ta({toolName:e.toolName,toolInput:e.input,cause:t.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:t.value,providerExecuted:!0,dynamic:!0,providerMetadata:e.providerMetadata}}async function Xo({toolCall:e,tools:t}){const r=e.toolName,n=t[r];if(n==null){if(e.providerExecuted&&e.dynamic)return await ul(e);throw new An({toolName:e.toolName,availableTools:Object.keys(t)})}const a=dr(n.inputSchema),o=e.input.trim()===""?await ct({value:{},schema:a}):await dt({text:e.input,schema:a});if(o.success===!1)throw new ta({toolName:r,toolInput:e.input,cause:o.error});return n.type==="dynamic"?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:o.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0}:{type:"tool-call",toolCallId:e.toolCallId,toolName:r,input:o.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}var Db=class{constructor({content:e,finishReason:t,usage:r,warnings:n,request:a,response:o,providerMetadata:s}){this.content=e,this.finishReason=t,this.usage=r,this.warnings=n,this.request=a,this.response=o,this.providerMetadata=s}get text(){return this.content.filter(e=>e.type==="text").map(e=>e.text).join("")}get reasoning(){return this.content.filter(e=>e.type==="reasoning")}get reasoningText(){return this.reasoning.length===0?void 0:this.reasoning.map(e=>e.text).join("")}get files(){return this.content.filter(e=>e.type==="file").map(e=>e.file)}get sources(){return this.content.filter(e=>e.type==="source")}get toolCalls(){return this.content.filter(e=>e.type==="tool-call")}get staticToolCalls(){return this.toolCalls.filter(e=>e.dynamic!==!0)}get dynamicToolCalls(){return this.toolCalls.filter(e=>e.dynamic===!0)}get toolResults(){return this.content.filter(e=>e.type==="tool-result")}get staticToolResults(){return this.toolResults.filter(e=>e.dynamic!==!0)}get dynamicToolResults(){return this.toolResults.filter(e=>e.dynamic===!0)}};function ll(e){return({steps:t})=>t.length===e}async function qb({stopConditions:e,steps:t}){return(await Promise.all(e.map(r=>r({steps:t})))).some(r=>r)}function Qo({content:e,tools:t}){const r=[],n=e.filter(o=>o.type!=="source").filter(o=>(o.type!=="tool-result"||o.providerExecuted)&&(o.type!=="tool-error"||o.providerExecuted)).filter(o=>o.type!=="text"||o.text.length>0).map(o=>{switch(o.type){case"text":return{type:"text",text:o.text,providerOptions:o.providerMetadata};case"reasoning":return{type:"reasoning",text:o.text,providerOptions:o.providerMetadata};case"file":return{type:"file",data:o.file.base64,mediaType:o.file.mediaType,providerOptions:o.providerMetadata};case"tool-call":return{type:"tool-call",toolCallId:o.toolCallId,toolName:o.toolName,input:o.input,providerExecuted:o.providerExecuted,providerOptions:o.providerMetadata};case"tool-result":return{type:"tool-result",toolCallId:o.toolCallId,toolName:o.toolName,output:Nt({tool:t?.[o.toolName],output:o.output,errorMode:"none"}),providerExecuted:!0,providerOptions:o.providerMetadata};case"tool-error":return{type:"tool-result",toolCallId:o.toolCallId,toolName:o.toolName,output:Nt({tool:t?.[o.toolName],output:o.error,errorMode:"json"}),providerOptions:o.providerMetadata};case"tool-approval-request":return{type:"tool-approval-request",approvalId:o.approvalId,toolCallId:o.toolCall.toolCallId}}});n.length>0&&r.push({role:"assistant",content:n});const a=e.filter(o=>o.type==="tool-result"||o.type==="tool-error").filter(o=>!o.providerExecuted).map(o=>({type:"tool-result",toolCallId:o.toolCallId,toolName:o.toolName,output:Nt({tool:t?.[o.toolName],output:o.type==="tool-result"?o.output:o.error,errorMode:o.type==="tool-error"?"text":"none"})}));return a.length>0&&r.push({role:"tool",content:a}),r}lr({prefix:"aitxt",size:24});function Dr(e,t){const r=new Headers(e??{});for(const[n,a]of Object.entries(t))r.has(n)||r.set(n,a);return r}function Ub({status:e,statusText:t,headers:r,textStream:n}){return new Response(n.pipeThrough(new TextEncoderStream),{status:e??200,statusText:t,headers:Dr(r,{"content-type":"text/plain; charset=utf-8"})})}function cl({response:e,status:t,statusText:r,headers:n,stream:a}){e.writeHead(t??200,r,n);const o=a.getReader();(async()=>{try{for(;;){const{done:i,value:l}=await o.read();if(i)break;e.write(l)||await new Promise(d=>{e.once("drain",d)})}}catch(i){throw i}finally{e.end()}})()}function Fb({response:e,status:t,statusText:r,headers:n,textStream:a}){cl({response:e,status:t,statusText:r,headers:Object.fromEntries(Dr(n,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:a.pipeThrough(new TextEncoderStream)})}var dl=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue(`data: [DONE]

`)}})}},pl={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"};function Lb({status:e,statusText:t,headers:r,stream:n,consumeSseStream:a}){let o=n.pipeThrough(new dl);if(a){const[s,i]=o.tee();o=s,a({stream:i})}return new Response(o.pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:Dr(r,pl)})}function Vb({originalMessages:e,responseMessageId:t}){if(e==null)return;const r=e[e.length-1];return r?.role==="assistant"?r.id:typeof t=="function"?t():t}function Bb(e){return e.type.startsWith("data-")}function fl(e,t){if(e===void 0&&t===void 0)return;if(e===void 0)return t;if(t===void 0)return e;const r={...e};for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const a=t[n];if(a===void 0)continue;const o=n in e?e[n]:void 0,s=a!==null&&typeof a=="object"&&!Array.isArray(a)&&!(a instanceof Date)&&!(a instanceof RegExp),i=o!=null&&typeof o=="object"&&!Array.isArray(o)&&!(o instanceof Date)&&!(o instanceof RegExp);s&&i?r[n]=fl(o,a):r[n]=a}return r}function Jb(e){const t=["ROOT"];let r=-1,n=null;function a(l,u,d){switch(l){case'"':{r=u,t.pop(),t.push(d),t.push("INSIDE_STRING");break}case"f":case"t":case"n":{r=u,n=u,t.pop(),t.push(d),t.push("INSIDE_LITERAL");break}case"-":{t.pop(),t.push(d),t.push("INSIDE_NUMBER");break}case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=u,t.pop(),t.push(d),t.push("INSIDE_NUMBER");break}case"{":{r=u,t.pop(),t.push(d),t.push("INSIDE_OBJECT_START");break}case"[":{r=u,t.pop(),t.push(d),t.push("INSIDE_ARRAY_START");break}}}function o(l,u){switch(l){case",":{t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break}case"}":{r=u,t.pop();break}}}function s(l,u){switch(l){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=u,t.pop();break}}}for(let l=0;l<e.length;l++){const u=e[l];switch(t[t.length-1]){case"ROOT":a(u,l,"FINISH");break;case"INSIDE_OBJECT_START":{switch(u){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}case"}":{r=l,t.pop();break}}break}case"INSIDE_OBJECT_AFTER_COMMA":{switch(u){case'"':{t.pop(),t.push("INSIDE_OBJECT_KEY");break}}break}case"INSIDE_OBJECT_KEY":{switch(u){case'"':{t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY");break}}break}case"INSIDE_OBJECT_AFTER_KEY":{switch(u){case":":{t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE");break}}break}case"INSIDE_OBJECT_BEFORE_VALUE":{a(u,l,"INSIDE_OBJECT_AFTER_VALUE");break}case"INSIDE_OBJECT_AFTER_VALUE":{o(u,l);break}case"INSIDE_STRING":{switch(u){case'"':{t.pop(),r=l;break}case"\\":{t.push("INSIDE_STRING_ESCAPE");break}default:r=l}break}case"INSIDE_ARRAY_START":{switch(u){case"]":{r=l,t.pop();break}default:{r=l,a(u,l,"INSIDE_ARRAY_AFTER_VALUE");break}}break}case"INSIDE_ARRAY_AFTER_VALUE":{switch(u){case",":{t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break}case"]":{r=l,t.pop();break}default:{r=l;break}}break}case"INSIDE_ARRAY_AFTER_COMMA":{a(u,l,"INSIDE_ARRAY_AFTER_VALUE");break}case"INSIDE_STRING_ESCAPE":{t.pop(),r=l;break}case"INSIDE_NUMBER":{switch(u){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{r=l;break}case"e":case"E":case"-":case".":break;case",":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(u,l),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&o(u,l);break}case"}":{t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&o(u,l);break}case"]":{t.pop(),t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(u,l);break}default:{t.pop();break}}break}case"INSIDE_LITERAL":{const m=e.substring(n,l+1);!"false".startsWith(m)&&!"true".startsWith(m)&&!"null".startsWith(m)?(t.pop(),t[t.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?o(u,l):t[t.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&s(u,l)):r=l;break}}}let i=e.slice(0,r+1);for(let l=t.length-1;l>=0;l--)switch(t[l]){case"INSIDE_STRING":{i+='"';break}case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":{i+="}";break}case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":{i+="]";break}case"INSIDE_LITERAL":{const d=e.substring(n,e.length);"true".startsWith(d)?i+="true".slice(d.length):"false".startsWith(d)?i+="false".slice(d.length):"null".startsWith(d)&&(i+="null".slice(d.length))}}return i}async function ml(e){if(e===void 0)return{value:void 0,state:"undefined-input"};let t=await dt({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await dt({text:Jb(e)}),t.success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function cn(e){return e.type.startsWith("data-")}function dn(e){return e.type==="text"}function pn(e){return e.type==="file"}function es(e){return e.type==="reasoning"}function Nn(e){return e.type.startsWith("tool-")}function hl(e){return e.type==="dynamic-tool"}function Bt(e){return Nn(e)||hl(e)}function Pn(e){return e.type.split("-").slice(1).join("-")}function fn(e){return hl(e)?e.toolName:Pn(e)}function gl({lastMessage:e,messageId:t}){return{message:e?.role==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function vl({stream:e,messageMetadataSchema:t,dataPartSchemas:r,runUpdateMessageJob:n,onError:a,onToolCall:o,onData:s}){return e.pipeThrough(new TransformStream({async transform(i,l){await n(async({state:u,write:d})=>{var m,p,h,f;function y(v){const $=u.message.parts.filter(Bt).find(P=>P.toolCallId===v);if($==null)throw new Error(`no tool invocation found for tool call ${v}`);return $}function _(v){var A;const $=u.message.parts.find(j=>Nn(j)&&j.toolCallId===v.toolCallId),P=v,E=$;$!=null?($.state=v.state,E.input=P.input,E.output=P.output,E.errorText=P.errorText,E.rawInput=P.rawInput,E.preliminary=P.preliminary,E.providerExecuted=(A=P.providerExecuted)!=null?A:$.providerExecuted,P.providerMetadata!=null&&$.state==="input-available"&&($.callProviderMetadata=P.providerMetadata)):u.message.parts.push({type:`tool-${v.toolName}`,toolCallId:v.toolCallId,state:v.state,input:P.input,output:P.output,rawInput:P.rawInput,errorText:P.errorText,providerExecuted:P.providerExecuted,preliminary:P.preliminary,...P.providerMetadata!=null?{callProviderMetadata:P.providerMetadata}:{}})}function b(v){var A,$;const P=u.message.parts.find(Z=>Z.type==="dynamic-tool"&&Z.toolCallId===v.toolCallId),E=v,j=P;P!=null?(P.state=v.state,j.toolName=v.toolName,j.input=E.input,j.output=E.output,j.errorText=E.errorText,j.rawInput=(A=E.rawInput)!=null?A:j.rawInput,j.preliminary=E.preliminary,j.providerExecuted=($=E.providerExecuted)!=null?$:P.providerExecuted,E.providerMetadata!=null&&P.state==="input-available"&&(P.callProviderMetadata=E.providerMetadata)):u.message.parts.push({type:"dynamic-tool",toolName:v.toolName,toolCallId:v.toolCallId,state:v.state,input:E.input,output:E.output,errorText:E.errorText,preliminary:E.preliminary,providerExecuted:E.providerExecuted,...E.providerMetadata!=null?{callProviderMetadata:E.providerMetadata}:{}})}async function I(v){if(v!=null){const A=u.message.metadata!=null?fl(u.message.metadata,v):v;t!=null&&await Sn({value:A,schema:t}),u.message.metadata=A}}switch(i.type){case"text-start":{const v={type:"text",text:"",providerMetadata:i.providerMetadata,state:"streaming"};u.activeTextParts[i.id]=v,u.message.parts.push(v),d();break}case"text-delta":{const v=u.activeTextParts[i.id];v.text+=i.delta,v.providerMetadata=(m=i.providerMetadata)!=null?m:v.providerMetadata,d();break}case"text-end":{const v=u.activeTextParts[i.id];v.state="done",v.providerMetadata=(p=i.providerMetadata)!=null?p:v.providerMetadata,delete u.activeTextParts[i.id],d();break}case"reasoning-start":{const v={type:"reasoning",text:"",providerMetadata:i.providerMetadata,state:"streaming"};u.activeReasoningParts[i.id]=v,u.message.parts.push(v),d();break}case"reasoning-delta":{const v=u.activeReasoningParts[i.id];v.text+=i.delta,v.providerMetadata=(h=i.providerMetadata)!=null?h:v.providerMetadata,d();break}case"reasoning-end":{const v=u.activeReasoningParts[i.id];v.providerMetadata=(f=i.providerMetadata)!=null?f:v.providerMetadata,v.state="done",delete u.activeReasoningParts[i.id],d();break}case"file":{u.message.parts.push({type:"file",mediaType:i.mediaType,url:i.url}),d();break}case"source-url":{u.message.parts.push({type:"source-url",sourceId:i.sourceId,url:i.url,title:i.title,providerMetadata:i.providerMetadata}),d();break}case"source-document":{u.message.parts.push({type:"source-document",sourceId:i.sourceId,mediaType:i.mediaType,title:i.title,filename:i.filename,providerMetadata:i.providerMetadata}),d();break}case"tool-input-start":{const v=u.message.parts.filter(Nn);u.partialToolCalls[i.toolCallId]={text:"",toolName:i.toolName,index:v.length,dynamic:i.dynamic},i.dynamic?b({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0,providerExecuted:i.providerExecuted}):_({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0,providerExecuted:i.providerExecuted}),d();break}case"tool-input-delta":{const v=u.partialToolCalls[i.toolCallId];v.text+=i.inputTextDelta;const{value:A}=await ml(v.text);v.dynamic?b({toolCallId:i.toolCallId,toolName:v.toolName,state:"input-streaming",input:A}):_({toolCallId:i.toolCallId,toolName:v.toolName,state:"input-streaming",input:A}),d();break}case"tool-input-available":{i.dynamic?b({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}):_({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}),d(),o&&!i.providerExecuted&&await o({toolCall:i});break}case"tool-input-error":{i.dynamic?b({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:i.input,errorText:i.errorText,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}):_({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:void 0,rawInput:i.input,errorText:i.errorText,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}),d();break}case"tool-approval-request":{const v=y(i.toolCallId);v.state="approval-requested",v.approval={id:i.approvalId},d();break}case"tool-output-denied":{const v=y(i.toolCallId);v.state="output-denied",d();break}case"tool-output-available":{const v=y(i.toolCallId);v.type==="dynamic-tool"?b({toolCallId:i.toolCallId,toolName:v.toolName,state:"output-available",input:v.input,output:i.output,preliminary:i.preliminary,providerExecuted:i.providerExecuted}):_({toolCallId:i.toolCallId,toolName:Pn(v),state:"output-available",input:v.input,output:i.output,providerExecuted:i.providerExecuted,preliminary:i.preliminary}),d();break}case"tool-output-error":{const v=y(i.toolCallId);v.type==="dynamic-tool"?b({toolCallId:i.toolCallId,toolName:v.toolName,state:"output-error",input:v.input,errorText:i.errorText,providerExecuted:i.providerExecuted}):_({toolCallId:i.toolCallId,toolName:Pn(v),state:"output-error",input:v.input,rawInput:v.rawInput,errorText:i.errorText,providerExecuted:i.providerExecuted}),d();break}case"start-step":{u.message.parts.push({type:"step-start"});break}case"finish-step":{u.activeTextParts={},u.activeReasoningParts={};break}case"start":{i.messageId!=null&&(u.message.id=i.messageId),await I(i.messageMetadata),(i.messageId!=null||i.messageMetadata!=null)&&d();break}case"finish":{await I(i.messageMetadata),i.messageMetadata!=null&&d();break}case"message-metadata":{await I(i.messageMetadata),i.messageMetadata!=null&&d();break}case"error":{a?.(new Error(i.errorText));break}default:if(Bb(i)){r?.[i.type]!=null&&await Sn({value:i.data,schema:r[i.type]});const v=i;if(v.transient){s?.(v);break}const A=v.id!=null?u.message.parts.find($=>v.type===$.type&&v.id===$.id):void 0;A!=null?A.data=v.data:u.message.parts.push(v),s?.(v),d()}}l.enqueue(i)})}}))}function Gb({messageId:e,originalMessages:t=[],onFinish:r,onError:n,stream:a}){let o=t?.[t.length-1];o?.role!=="assistant"?o=void 0:e=o.id;let s=!1;const i=a.pipeThrough(new TransformStream({transform(p,h){if(p.type==="start"){const f=p;f.messageId==null&&e!=null&&(f.messageId=e)}p.type==="abort"&&(s=!0),h.enqueue(p)}}));if(r==null)return i;const l=gl({lastMessage:o?structuredClone(o):void 0,messageId:e??""}),u=async p=>{await p({state:l,write:()=>{}})};let d=!1;const m=async()=>{if(d||!r)return;d=!0;const p=l.message.id===o?.id;await r({isAborted:s,isContinuation:p,responseMessage:l.message,messages:[...p?t.slice(0,-1):t,l.message]})};return vl({stream:i,runUpdateMessageJob:u,onError:n}).pipeThrough(new TransformStream({transform(p,h){h.enqueue(p)},async cancel(){await m()},async flush(){await m()}}))}function Wb({response:e,status:t,statusText:r,headers:n,stream:a,consumeSseStream:o}){let s=a.pipeThrough(new dl);if(o){const[i,l]=s.tee();s=i,o({stream:l})}cl({response:e,status:t,statusText:r,headers:Object.fromEntries(Dr(n,pl).entries()),stream:s.pipeThrough(new TextEncoderStream)})}function Jt(e){const t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=function(){const r=this.getReader();let n=!1;async function a(o){var s;n=!0;try{o&&await((s=r.cancel)==null?void 0:s.call(r))}finally{try{r.releaseLock()}catch{}}}return{async next(){if(n)return{done:!0,value:void 0};const{done:o,value:s}=await r.read();return o?(await a(!0),{done:!0,value:void 0}):{done:!1,value:s}},async return(){return await a(!0),{done:!0,value:void 0}},async throw(o){throw await a(!0),o}}},t}async function yl({stream:e,onError:t}){const r=e.getReader();try{for(;;){const{done:n}=await r.read();if(n)break}}catch(n){t?.(n)}finally{r.releaseLock()}}function ts(){let e,t;return{promise:new Promise((n,a)=>{e=n,t=a}),resolve:e,reject:t}}function Hb(){let e=[],t=null,r=!1,n=ts();const a=()=>{r=!0,n.resolve(),e.forEach(s=>s.cancel()),e=[],t?.close()},o=async()=>{if(r&&e.length===0){t?.close();return}if(e.length===0)return n=ts(),await n.promise,o();try{const{value:s,done:i}=await e[0].read();i?(e.shift(),e.length===0&&r?t?.close():await o()):t?.enqueue(s)}catch(s){t?.error(s),e.shift(),a()}};return{stream:new ReadableStream({start(s){t=s},pull:o,async cancel(){for(const s of e)await s.cancel();e=[],r=!0}}),addStream:s=>{if(r)throw new Error("Cannot add inner stream: outer stream is closed");e.push(s.getReader()),n.resolve()},close:()=>{r=!0,n.resolve(),e.length===0&&t?.close()},terminate:a}}var Ir=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get promise(){return this._promise?this._promise:(this._promise=new Promise((e,t)=>{this.status.type==="resolved"?e(this.status.value):this.status.type==="rejected"&&t(this.status.error),this._resolve=e,this._reject=t}),this._promise)}resolve(e){var t;this.status={type:"resolved",value:e},this._promise&&((t=this._resolve)==null||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this._promise&&((t=this._reject)==null||t.call(this,e))}};function Kb(){var e,t;return(t=(e=globalThis?.performance)==null?void 0:e.now())!=null?t:Date.now()}function Yb({tools:e,generatorStream:t,tracer:r,telemetry:n,system:a,messages:o,abortSignal:s,repairToolCall:i,experimental_context:l,generateId:u}){let d=null;const m=new ReadableStream({start(I){d=I}}),p=new Set,h=new Map;let f=!1,y;function _(){f&&p.size===0&&(y!=null&&d.enqueue(y),d.close())}const b=new TransformStream({async transform(I,v){const A=I.type;switch(A){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":{v.enqueue(I);break}case"file":{v.enqueue({type:"file",file:new zb({data:I.data,mediaType:I.mediaType})});break}case"finish":{y={type:"finish",finishReason:I.finishReason,usage:I.usage,providerMetadata:I.providerMetadata};break}case"tool-call":{try{const $=await jb({toolCall:I,tools:e,repairToolCall:i,system:a,messages:o});if(v.enqueue($),$.invalid){d.enqueue({type:"tool-error",toolCallId:$.toolCallId,toolName:$.toolName,input:$.input,error:Hi($.error),dynamic:!0});break}const P=e?.[$.toolName];if(P==null)break;if(P.onInputAvailable!=null&&await P.onInputAvailable({input:$.input,toolCallId:$.toolCallId,messages:o,abortSignal:s,experimental_context:l}),await Zb({tool:P,toolCall:$,messages:o,experimental_context:l})){d.enqueue({type:"tool-approval-request",approvalId:u(),toolCall:$});break}if(h.set($.toolCallId,$.input),P.execute!=null&&$.providerExecuted!==!0){const E=u();p.add(E),il({toolCall:$,tools:e,tracer:r,telemetry:n,messages:o,abortSignal:s,experimental_context:l,onPreliminaryToolResult:j=>{d.enqueue(j)}}).then(j=>{d.enqueue(j),p.delete(E),_()})}}catch($){d.enqueue({type:"error",error:$})}break}case"tool-result":{const $=I.toolName;I.isError?d.enqueue({type:"tool-error",toolCallId:I.toolCallId,toolName:$,input:h.get(I.toolCallId),providerExecuted:I.providerExecuted,error:I.result,dynamic:I.dynamic}):v.enqueue({type:"tool-result",toolCallId:I.toolCallId,toolName:$,input:h.get(I.toolCallId),output:I.result,providerExecuted:I.providerExecuted,dynamic:I.dynamic});break}default:{const $=A;throw new Error(`Unhandled chunk type: ${$}`)}}},flush(){f=!0,_()}});return new ReadableStream({async start(I){return Promise.all([t.pipeThrough(b).pipeTo(new WritableStream({write(v){I.enqueue(v)},close(){}})),m.pipeTo(new WritableStream({write(v){I.enqueue(v)},close(){I.close()}}))])}})}var Xb=lr({prefix:"aitxt",size:24});function Qb({model:e,tools:t,toolChoice:r,system:n,prompt:a,messages:o,maxRetries:s,abortSignal:i,headers:l,stopWhen:u=ll(1),experimental_output:d,experimental_telemetry:m,prepareStep:p,providerOptions:h,experimental_activeTools:f,activeTools:y=f,experimental_repairToolCall:_,experimental_transform:b,experimental_download:I,includeRawChunks:v=!1,onChunk:A,onError:$=({error:Y})=>{console.error(Y)},onFinish:P,onAbort:E,onStepFinish:j,experimental_context:Z,_internal:{now:K=Kb,generateId:q=Xb,currentDate:ye=()=>new Date}={},...ae}){return new tw({model:Qu(e),telemetry:m,headers:l,settings:ae,maxRetries:s,abortSignal:i,system:n,prompt:a,messages:o,tools:t,toolChoice:r,transforms:Yo(b),activeTools:y,repairToolCall:_,stopConditions:Yo(u),output:d,providerOptions:h,prepareStep:p,includeRawChunks:v,onChunk:A,onError:$,onFinish:P,onAbort:E,onStepFinish:j,now:K,currentDate:ye,generateId:q,experimental_context:Z,download:I})}function ew(e){if(!e)return new TransformStream({transform(s,i){i.enqueue({part:s,partialOutput:void 0})}});let t,r="",n="",a="";function o({controller:s,partialOutput:i=void 0}){s.enqueue({part:{type:"text-delta",id:t,text:n},partialOutput:i}),n=""}return new TransformStream({async transform(s,i){if(s.type==="finish-step"&&n.length>0&&o({controller:i}),s.type!=="text-delta"&&s.type!=="text-start"&&s.type!=="text-end"){i.enqueue({part:s,partialOutput:void 0});return}if(t==null)t=s.id;else if(s.id!==t){i.enqueue({part:s,partialOutput:void 0});return}if(s.type==="text-start"){i.enqueue({part:s,partialOutput:void 0});return}if(s.type==="text-end"){n.length>0&&o({controller:i}),i.enqueue({part:s,partialOutput:void 0});return}r+=s.text,n+=s.text;const l=await e.parsePartial({text:r});if(l!=null){const u=JSON.stringify(l.partial);u!==a&&(o({controller:i,partialOutput:l.partial}),a=u)}}})}var tw=class{constructor({model:e,telemetry:t,headers:r,settings:n,maxRetries:a,abortSignal:o,system:s,prompt:i,messages:l,tools:u,toolChoice:d,transforms:m,activeTools:p,repairToolCall:h,stopConditions:f,output:y,providerOptions:_,prepareStep:b,includeRawChunks:I,now:v,currentDate:A,generateId:$,onChunk:P,onError:E,onFinish:j,onAbort:Z,onStepFinish:K,experimental_context:q,download:ye}){this._totalUsage=new Ir,this._finishReason=new Ir,this._steps=new Ir,this.output=y,this.includeRawChunks=I,this.tools=u;let ae,Y=[];const z=[];let Q,W,je={},Ye=[];const ve=[];let Xe,ee={},pe={};const w=new TransformStream({async transform(ie,ue){var fe,B,Me,_t;ue.enqueue(ie);const{part:O}=ie;if((O.type==="text-delta"||O.type==="reasoning-delta"||O.type==="source"||O.type==="tool-call"||O.type==="tool-result"||O.type==="tool-input-start"||O.type==="tool-input-delta"||O.type==="raw")&&await P?.({chunk:O}),O.type==="error"&&await E({error:xb(O.error)}),O.type==="text-start"&&(ee[O.id]={type:"text",text:"",providerMetadata:O.providerMetadata},Y.push(ee[O.id])),O.type==="text-delta"){const F=ee[O.id];if(F==null){ue.enqueue({part:{type:"error",error:`text part ${O.id} not found`},partialOutput:void 0});return}F.text+=O.text,F.providerMetadata=(fe=O.providerMetadata)!=null?fe:F.providerMetadata}if(O.type==="text-end"){const F=ee[O.id];if(F==null){ue.enqueue({part:{type:"error",error:`text part ${O.id} not found`},partialOutput:void 0});return}F.providerMetadata=(B=O.providerMetadata)!=null?B:F.providerMetadata,delete ee[O.id]}if(O.type==="reasoning-start"&&(pe[O.id]={type:"reasoning",text:"",providerMetadata:O.providerMetadata},Y.push(pe[O.id])),O.type==="reasoning-delta"){const F=pe[O.id];if(F==null){ue.enqueue({part:{type:"error",error:`reasoning part ${O.id} not found`},partialOutput:void 0});return}F.text+=O.text,F.providerMetadata=(Me=O.providerMetadata)!=null?Me:F.providerMetadata}if(O.type==="reasoning-end"){const F=pe[O.id];if(F==null){ue.enqueue({part:{type:"error",error:`reasoning part ${O.id} not found`},partialOutput:void 0});return}F.providerMetadata=(_t=O.providerMetadata)!=null?_t:F.providerMetadata,delete pe[O.id]}if(O.type==="file"&&Y.push({type:"file",file:O.file}),O.type==="source"&&Y.push(O),O.type==="tool-call"&&Y.push(O),O.type==="tool-result"&&!O.preliminary&&Y.push(O),O.type==="tool-approval-request"&&Y.push(O),O.type==="tool-error"&&Y.push(O),O.type==="start-step"&&(Y=[],pe={},ee={},je=O.request,Ye=O.warnings),O.type==="finish-step"){const F=Qo({content:Y,tools:u}),ot=new Db({content:Y,finishReason:O.finishReason,usage:O.usage,warnings:Ye,request:je,response:{...O.response,messages:[...z,...F]},providerMetadata:O.providerMetadata});await K?.(ot),N_(Ye),ve.push(ot),z.push(...F),ae.resolve()}O.type==="finish"&&(W=O.totalUsage,Q=O.finishReason)},async flush(ie){try{if(ve.length===0){const Me=new Z_({message:"No output generated. Check the stream for errors."});Ae._finishReason.reject(Me),Ae._totalUsage.reject(Me),Ae._steps.reject(Me);return}const ue=Q??"unknown",fe=W??{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0};Ae._finishReason.resolve(ue),Ae._totalUsage.resolve(fe),Ae._steps.resolve(ve);const B=ve[ve.length-1];await j?.({finishReason:ue,totalUsage:fe,usage:B.usage,content:B.content,text:B.text,reasoningText:B.reasoningText,reasoning:B.reasoning,files:B.files,sources:B.sources,toolCalls:B.toolCalls,staticToolCalls:B.staticToolCalls,dynamicToolCalls:B.dynamicToolCalls,toolResults:B.toolResults,staticToolResults:B.staticToolResults,dynamicToolResults:B.dynamicToolResults,request:B.request,response:B.response,warnings:B.warnings,providerMetadata:B.providerMetadata,steps:ve}),Xe.setAttributes(await Ot({telemetry:t,attributes:{"ai.response.finishReason":ue,"ai.response.text":{output:()=>B.text},"ai.response.toolCalls":{output:()=>{var Me;return(Me=B.toolCalls)!=null&&Me.length?JSON.stringify(B.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(B.providerMetadata),"ai.usage.inputTokens":fe.inputTokens,"ai.usage.outputTokens":fe.outputTokens,"ai.usage.totalTokens":fe.totalTokens,"ai.usage.reasoningTokens":fe.reasoningTokens,"ai.usage.cachedInputTokens":fe.cachedInputTokens}}))}catch(ue){ie.error(ue)}finally{Xe.end()}}}),M=Hb();this.addStream=M.addStream,this.closeStream=M.close;const Re=M.stream.getReader();let se=new ReadableStream({async start(ie){ie.enqueue({type:"start"})},async pull(ie){function ue(){Z?.({steps:ve}),ie.enqueue({type:"abort"}),ie.close()}try{const{done:fe,value:B}=await Re.read();if(fe){ie.close();return}if(o?.aborted){ue();return}ie.enqueue(B)}catch(fe){mt(fe)&&o?.aborted?ue():ie.error(fe)}},cancel(ie){return M.stream.cancel(ie)}});for(const ie of m)se=se.pipeThrough(ie({tools:u,stopStream(){M.terminate()}}));this.baseStream=se.pipeThrough(ew(y)).pipeThrough(w);const{maxRetries:be,retry:bl}=Pb({maxRetries:a,abortSignal:o}),pr=$b(t),Qe=lb(n),na=Sb({model:e,telemetry:t,headers:r,settings:{...Qe,maxRetries:be}}),Ae=this;Cn({name:"ai.streamText",attributes:Ot({telemetry:t,attributes:{...On({operationId:"ai.streamText",telemetry:t}),...na,"ai.prompt":{input:()=>JSON.stringify({system:s,prompt:i,messages:l})}}}),tracer:pr,endWhenDone:!1,fn:async ie=>{Xe=ie;const ue=await kb({system:s,prompt:i,messages:l}),fe=ue.messages,B=[],{approvedToolApprovals:Me,deniedToolApprovals:_t}=Rb({messages:fe});if(_t.length>0||Me.length>0){let F;const ot=new ReadableStream({start(bt){F=bt}});Ae.addStream(ot);try{for(const me of _t)F?.enqueue({type:"tool-output-denied",toolCallId:me.toolCall.toolCallId,toolName:me.toolCall.toolName});const bt=[];await Promise.all(Me.map(async me=>{const wt=await il({toolCall:me.toolCall,tools:u,tracer:pr,telemetry:t,messages:fe,abortSignal:o,experimental_context:q,onPreliminaryToolResult:fr=>{F?.enqueue(fr)}});wt!=null&&(F?.enqueue(wt),bt.push(wt))})),B.push({role:"tool",content:[...bt.map(me=>({type:"tool-result",toolCallId:me.toolCallId,toolName:me.toolName,output:Nt({tool:u?.[me.toolName],output:me.type==="tool-result"?me.output:me.error,errorMode:me.type==="tool-error"?"json":"none"})})),..._t.map(me=>({type:"tool-result",toolCallId:me.toolCall.toolCallId,toolName:me.toolCall.toolName,output:{type:"execution-denied",reason:me.approvalResponse.reason}}))]})}finally{F?.close()}}z.push(...B);async function O({currentStep:F,responseMessages:ot,usage:bt}){var me,wt,fr,aa,oa;const sa=Ae.includeRawChunks;ae=new Ir;const Dt=[...fe,...ot],Be=await b?.({model:e,steps:ve,stepNumber:ve.length,messages:Dt}),It=Qu((me=Be?.model)!=null?me:e),ia=await ob({prompt:{system:(wt=Be?.system)!=null?wt:ue.system,messages:(fr=Be?.messages)!=null?fr:Dt},supportedUrls:await It.supportedUrls,download:ye}),{toolChoice:Ur,tools:Fr}=await db({tools:u,toolChoice:(aa=Be?.toolChoice)!=null?aa:d,activeTools:(oa=Be?.activeTools)!=null?oa:p}),{result:{stream:wl,response:ua,request:la},doStreamSpan:kt,startTimestampMs:ca}=await bl(()=>Cn({name:"ai.streamText.doStream",attributes:Ot({telemetry:t,attributes:{...On({operationId:"ai.streamText.doStream",telemetry:t}),...na,"ai.model.provider":It.provider,"ai.model.id":It.modelId,"ai.prompt.messages":{input:()=>Ab(ia)},"ai.prompt.tools":{input:()=>Fr?.map(R=>JSON.stringify(R))},"ai.prompt.toolChoice":{input:()=>Ur!=null?JSON.stringify(Ur):void 0},"gen_ai.system":It.provider,"gen_ai.request.model":It.modelId,"gen_ai.request.frequency_penalty":Qe.frequencyPenalty,"gen_ai.request.max_tokens":Qe.maxOutputTokens,"gen_ai.request.presence_penalty":Qe.presencePenalty,"gen_ai.request.stop_sequences":Qe.stopSequences,"gen_ai.request.temperature":Qe.temperature,"gen_ai.request.top_k":Qe.topK,"gen_ai.request.top_p":Qe.topP}}),tracer:pr,endWhenDone:!1,fn:async R=>({startTimestampMs:v(),doStreamSpan:R,result:await It.doStream({...Qe,tools:Fr,toolChoice:Ur,responseFormat:await y?.responseFormat,prompt:ia,providerOptions:_,abortSignal:o,headers:r,includeRawChunks:sa})})})),Il=Yb({tools:u,generatorStream:wl,tracer:pr,telemetry:t,system:s,messages:Dt,repairToolCall:h,abortSignal:o,experimental_context:q,generateId:$}),kl=la??{},mr=[],Lr=[];let Vr;const Br={};let xt="unknown",De={inputTokens:void 0,outputTokens:void 0,totalTokens:void 0},Jr,da=!0,Je={id:$(),timestamp:A(),modelId:e.modelId},pa="";Ae.addStream(Il.pipeThrough(new TransformStream({async transform(R,_e){var qt,Ut,hr,et,fa;if(R.type==="stream-start"){Vr=R.warnings;return}if(da){const Ie=v()-ca;da=!1,kt.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":Ie}),kt.setAttributes({"ai.response.msToFirstChunk":Ie}),_e.enqueue({type:"start-step",request:kl,warnings:Vr??[]})}const ma=R.type;switch(ma){case"tool-approval-request":case"text-start":case"text-end":{_e.enqueue(R);break}case"text-delta":{R.delta.length>0&&(_e.enqueue({type:"text-delta",id:R.id,text:R.delta,providerMetadata:R.providerMetadata}),pa+=R.delta);break}case"reasoning-start":case"reasoning-end":{_e.enqueue(R);break}case"reasoning-delta":{_e.enqueue({type:"reasoning-delta",id:R.id,text:R.delta,providerMetadata:R.providerMetadata});break}case"tool-call":{_e.enqueue(R),mr.push(R);break}case"tool-result":{_e.enqueue(R),R.preliminary||Lr.push(R);break}case"tool-error":{_e.enqueue(R),Lr.push(R);break}case"response-metadata":{Je={id:(qt=R.id)!=null?qt:Je.id,timestamp:(Ut=R.timestamp)!=null?Ut:Je.timestamp,modelId:(hr=R.modelId)!=null?hr:Je.modelId};break}case"finish":{De=R.usage,xt=R.finishReason,Jr=R.providerMetadata;const Ie=v()-ca;kt.addEvent("ai.stream.finish"),kt.setAttributes({"ai.response.msToFinish":Ie,"ai.response.avgOutputTokensPerSecond":1e3*((et=De.outputTokens)!=null?et:0)/Ie});break}case"file":{_e.enqueue(R);break}case"source":{_e.enqueue(R);break}case"tool-input-start":{Br[R.id]=R.toolName;const Ie=u?.[R.toolName];Ie?.onInputStart!=null&&await Ie.onInputStart({toolCallId:R.id,messages:Dt,abortSignal:o,experimental_context:q}),_e.enqueue({...R,dynamic:(fa=R.dynamic)!=null?fa:Ie?.type==="dynamic"});break}case"tool-input-end":{delete Br[R.id],_e.enqueue(R);break}case"tool-input-delta":{const Ie=Br[R.id],Gr=u?.[Ie];Gr?.onInputDelta!=null&&await Gr.onInputDelta({inputTextDelta:R.delta,toolCallId:R.id,messages:Dt,abortSignal:o,experimental_context:q}),_e.enqueue(R);break}case"error":{_e.enqueue(R),xt="error";break}case"raw":{sa&&_e.enqueue(R);break}default:{const Ie=ma;throw new Error(`Unknown chunk type: ${Ie}`)}}},async flush(R){const _e=mr.length>0?JSON.stringify(mr):void 0;try{kt.setAttributes(await Ot({telemetry:t,attributes:{"ai.response.finishReason":xt,"ai.response.text":{output:()=>pa},"ai.response.toolCalls":{output:()=>_e},"ai.response.id":Je.id,"ai.response.model":Je.modelId,"ai.response.timestamp":Je.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(Jr),"ai.usage.inputTokens":De.inputTokens,"ai.usage.outputTokens":De.outputTokens,"ai.usage.totalTokens":De.totalTokens,"ai.usage.reasoningTokens":De.reasoningTokens,"ai.usage.cachedInputTokens":De.cachedInputTokens,"gen_ai.response.finish_reasons":[xt],"gen_ai.response.id":Je.id,"gen_ai.response.model":Je.modelId,"gen_ai.usage.input_tokens":De.inputTokens,"gen_ai.usage.output_tokens":De.outputTokens}}))}catch{}finally{kt.end()}R.enqueue({type:"finish-step",finishReason:xt,usage:De,providerMetadata:Jr,response:{...Je,headers:ua?.headers}});const qt=Ob(bt,De);await ae.promise;const Ut=mr.filter(et=>et.providerExecuted!==!0),hr=Lr.filter(et=>et.providerExecuted!==!0);if(Ut.length>0&&hr.length===Ut.length&&!await qb({stopConditions:f,steps:ve})){ot.push(...Qo({content:ve[ve.length-1].content,tools:u}));try{await O({currentStep:F+1,responseMessages:ot,usage:qt})}catch(et){R.enqueue({type:"error",error:et}),Ae.closeStream()}}else R.enqueue({type:"finish",finishReason:xt,totalUsage:qt}),Ae.closeStream()}})))}await O({currentStep:0,responseMessages:B,usage:{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0}})}}).catch(ie=>{Ae.addStream(new ReadableStream({start(ue){ue.enqueue({type:"error",error:ie}),ue.close()}})),Ae.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(e=>e[e.length-1])}get content(){return this.finalStep.then(e=>e.content)}get warnings(){return this.finalStep.then(e=>e.warnings)}get providerMetadata(){return this.finalStep.then(e=>e.providerMetadata)}get text(){return this.finalStep.then(e=>e.text)}get reasoningText(){return this.finalStep.then(e=>e.reasoningText)}get reasoning(){return this.finalStep.then(e=>e.reasoning)}get sources(){return this.finalStep.then(e=>e.sources)}get files(){return this.finalStep.then(e=>e.files)}get toolCalls(){return this.finalStep.then(e=>e.toolCalls)}get staticToolCalls(){return this.finalStep.then(e=>e.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(e=>e.dynamicToolCalls)}get toolResults(){return this.finalStep.then(e=>e.toolResults)}get staticToolResults(){return this.finalStep.then(e=>e.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(e=>e.dynamicToolResults)}get usage(){return this.finalStep.then(e=>e.usage)}get request(){return this.finalStep.then(e=>e.request)}get response(){return this.finalStep.then(e=>e.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}teeStream(){const[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return Jt(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){e.type==="text-delta"&&t.enqueue(e.text)}})))}get fullStream(){return Jt(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await yl({stream:this.fullStream,onError:e?.onError})}catch(r){(t=e?.onError)==null||t.call(e,r)}}get experimental_partialOutputStream(){if(this.output==null)throw new A_;return Jt(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){e!=null&&t.enqueue(e)}})))}toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:n,sendReasoning:a=!0,sendSources:o=!1,sendStart:s=!0,sendFinish:i=!0,onError:l=Zt}={}){const u=t!=null?Vb({originalMessages:e,responseMessageId:t}):void 0,d=p=>{var h;const f=(h=this.tools)==null?void 0:h[p.toolName];return f==null?p.dynamic:f?.type==="dynamic"?!0:void 0},m=this.fullStream.pipeThrough(new TransformStream({transform:async(p,h)=>{const f=n?.({part:p}),y=p.type;switch(y){case"text-start":{h.enqueue({type:"text-start",id:p.id,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"text-delta":{h.enqueue({type:"text-delta",id:p.id,delta:p.text,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"text-end":{h.enqueue({type:"text-end",id:p.id,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"reasoning-start":{h.enqueue({type:"reasoning-start",id:p.id,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"reasoning-delta":{a&&h.enqueue({type:"reasoning-delta",id:p.id,delta:p.text,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"reasoning-end":{h.enqueue({type:"reasoning-end",id:p.id,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"file":{h.enqueue({type:"file",mediaType:p.file.mediaType,url:`data:${p.file.mediaType};base64,${p.file.base64}`});break}case"source":{o&&p.sourceType==="url"&&h.enqueue({type:"source-url",sourceId:p.id,url:p.url,title:p.title,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}}),o&&p.sourceType==="document"&&h.enqueue({type:"source-document",sourceId:p.id,mediaType:p.mediaType,title:p.title,filename:p.filename,...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{}});break}case"tool-input-start":{const _=d(p);h.enqueue({type:"tool-input-start",toolCallId:p.id,toolName:p.toolName,...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},..._!=null?{dynamic:_}:{}});break}case"tool-input-delta":{h.enqueue({type:"tool-input-delta",toolCallId:p.id,inputTextDelta:p.delta});break}case"tool-call":{const _=d(p);p.invalid?h.enqueue({type:"tool-input-error",toolCallId:p.toolCallId,toolName:p.toolName,input:p.input,...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{},..._!=null?{dynamic:_}:{},errorText:l(p.error)}):h.enqueue({type:"tool-input-available",toolCallId:p.toolCallId,toolName:p.toolName,input:p.input,...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},...p.providerMetadata!=null?{providerMetadata:p.providerMetadata}:{},..._!=null?{dynamic:_}:{}});break}case"tool-approval-request":{h.enqueue({type:"tool-approval-request",approvalId:p.approvalId,toolCallId:p.toolCall.toolCallId});break}case"tool-result":{const _=d(p);h.enqueue({type:"tool-output-available",toolCallId:p.toolCallId,output:p.output,...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},...p.preliminary!=null?{preliminary:p.preliminary}:{},..._!=null?{dynamic:_}:{}});break}case"tool-error":{const _=d(p);h.enqueue({type:"tool-output-error",toolCallId:p.toolCallId,errorText:l(p.error),...p.providerExecuted!=null?{providerExecuted:p.providerExecuted}:{},..._!=null?{dynamic:_}:{}});break}case"tool-output-denied":{h.enqueue({type:"tool-output-denied",toolCallId:p.toolCallId});break}case"error":{h.enqueue({type:"error",errorText:l(p.error)});break}case"start-step":{h.enqueue({type:"start-step"});break}case"finish-step":{h.enqueue({type:"finish-step"});break}case"start":{s&&h.enqueue({type:"start",...f!=null?{messageMetadata:f}:{},...u!=null?{messageId:u}:{}});break}case"finish":{i&&h.enqueue({type:"finish",...f!=null?{messageMetadata:f}:{}});break}case"abort":{h.enqueue(p);break}case"tool-input-end":break;case"raw":break;default:{const _=y;throw new Error(`Unknown chunk type: ${_}`)}}f!=null&&y!=="start"&&y!=="finish"&&h.enqueue({type:"message-metadata",messageMetadata:f})}}));return Jt(Gb({stream:m,messageId:u??t?.(),originalMessages:e,onFinish:r,onError:l}))}pipeUIMessageStreamToResponse(e,{originalMessages:t,generateMessageId:r,onFinish:n,messageMetadata:a,sendReasoning:o,sendSources:s,sendFinish:i,sendStart:l,onError:u,...d}={}){Wb({response:e,stream:this.toUIMessageStream({originalMessages:t,generateMessageId:r,onFinish:n,messageMetadata:a,sendReasoning:o,sendSources:s,sendFinish:i,sendStart:l,onError:u}),...d})}pipeTextStreamToResponse(e,t){Fb({response:e,textStream:this.textStream,...t})}toUIMessageStreamResponse({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:n,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:i,onError:l,...u}={}){return Lb({stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:r,messageMetadata:n,sendReasoning:a,sendSources:o,sendFinish:s,sendStart:i,onError:l}),...u})}toTextStreamResponse(e){return Ub({textStream:this.textStream,...e})}};function rw({message:e,stream:t,onError:r,terminateOnError:n=!1}){var a;let o,s=!1;const i=new ReadableStream({start(d){o=d}}),l=gl({messageId:(a=e?.id)!=null?a:"",lastMessage:e}),u=d=>{r?.(d),!s&&n&&(s=!0,o?.error(d))};return yl({stream:vl({stream:t,runUpdateMessageJob(d){return d({state:l,write:()=>{o?.enqueue(structuredClone(l.message))}})},onError:u}),onError:u}).finally(()=>{s||o?.close()}),Jt(i)}function nw(e,t){const r=[];t?.ignoreIncompleteToolCalls&&(e=e.map(n=>({...n,parts:n.parts.filter(a=>!Bt(a)||a.state!=="input-streaming"&&a.state!=="input-available")})));for(const n of e)switch(n.role){case"system":{const a=n.parts.filter(s=>s.type==="text"),o=a.reduce((s,i)=>i.providerMetadata!=null?{...s,...i.providerMetadata}:s,{});r.push({role:"system",content:a.map(s=>s.text).join(""),...Object.keys(o).length>0?{providerOptions:o}:{}});break}case"user":{r.push({role:"user",content:n.parts.map(a=>{var o;if(dn(a))return{type:"text",text:a.text,...a.providerMetadata!=null?{providerOptions:a.providerMetadata}:{}};if(pn(a))return{type:"file",mediaType:a.mediaType,filename:a.filename,data:a.url,...a.providerMetadata!=null?{providerOptions:a.providerMetadata}:{}};if(cn(a))return(o=t?.convertDataPart)==null?void 0:o.call(t,a)}).filter(sv)});break}case"assistant":{if(n.parts!=null){let a=function(){var s,i,l;if(o.length===0)return;const u=[];for(const m of o)if(dn(m))u.push({type:"text",text:m.text,...m.providerMetadata!=null?{providerOptions:m.providerMetadata}:{}});else if(pn(m))u.push({type:"file",mediaType:m.mediaType,filename:m.filename,data:m.url});else if(es(m))u.push({type:"reasoning",text:m.text,providerOptions:m.providerMetadata});else if(Bt(m)){const p=fn(m);m.state!=="input-streaming"&&(u.push({type:"tool-call",toolCallId:m.toolCallId,toolName:p,input:m.state==="output-error"?(s=m.input)!=null?s:"rawInput"in m?m.rawInput:void 0:m.input,providerExecuted:m.providerExecuted,...m.callProviderMetadata!=null?{providerOptions:m.callProviderMetadata}:{}}),m.approval!=null&&u.push({type:"tool-approval-request",approvalId:m.approval.id,toolCallId:m.toolCallId}),m.providerExecuted===!0&&(m.state==="output-available"||m.state==="output-error")&&u.push({type:"tool-result",toolCallId:m.toolCallId,toolName:p,output:Nt({output:m.state==="output-error"?m.errorText:m.output,tool:(i=t?.tools)==null?void 0:i[p],errorMode:m.state==="output-error"?"json":"none"})}))}else if(cn(m)){const p=(l=t?.convertDataPart)==null?void 0:l.call(t,m);p!=null&&u.push(p)}else{const p=m;throw new Error(`Unsupported part: ${p}`)}r.push({role:"assistant",content:u});const d=o.filter(m=>Bt(m)&&m.providerExecuted!==!0);d.length>0&&r.push({role:"tool",content:d.flatMap(m=>{var p,h,f;const y=[];switch(((p=m.approval)==null?void 0:p.approved)!=null&&y.push({type:"tool-approval-response",approvalId:m.approval.id,approved:m.approval.approved,reason:m.approval.reason}),m.state){case"output-denied":{y.push({type:"tool-result",toolCallId:m.toolCallId,toolName:fn(m),output:{type:"error-text",value:(h=m.approval.reason)!=null?h:"Tool execution denied."}});break}case"output-error":case"output-available":{const _=fn(m);y.push({type:"tool-result",toolCallId:m.toolCallId,toolName:_,output:Nt({output:m.state==="output-error"?m.errorText:m.output,tool:(f=t?.tools)==null?void 0:f[_],errorMode:m.state==="output-error"?"text":"none"})});break}}return y})}),o=[]},o=[];for(const s of n.parts)dn(s)||es(s)||pn(s)||Bt(s)||cn(s)?o.push(s):s.type==="step-start"&&a();a();break}break}default:{const a=n.role;throw new B_({originalMessage:n,message:`Unsupported role: ${a}`})}}return r}lr({prefix:"aiobj",size:24});lr({prefix:"aiobj",size:24});var aw={};E_(aw,{object:()=>sw,text:()=>ow});var ow=()=>({type:"text",responseFormat:Promise.resolve({type:"text"}),async parsePartial({text:e}){return{partial:e}},async parseOutput({text:e}){return e}}),sw=({schema:e})=>{const t=dr(e);return{type:"object",responseFormat:nt(t.jsonSchema).then(r=>({type:"json",schema:r})),async parsePartial({text:r}){const n=await ml(r);switch(n.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:n.value};default:{const a=n.state;throw new Error(`Unsupported parse state: ${a}`)}}},async parseOutput({text:r},n){const a=await dt({text:r});if(!a.success)throw new Go({message:"No object generated: could not parse the response.",cause:a.error,text:r,response:n.response,usage:n.usage,finishReason:n.finishReason});const o=await ct({value:a.value,schema:t});if(!o.success)throw new Go({message:"No object generated: response did not match schema.",cause:o.error,text:r,response:n.response,usage:n.usage,finishReason:n.finishReason});return o.value}}},iw=$t({name:c(),version:c()}),ra=$t({_meta:le(g({}).loose())}),or=ra,uw=g({method:c(),params:le(ra)}),lw=$t({experimental:le(g({}).loose()),logging:le(g({}).loose()),prompts:le($t({listChanged:le(ce())})),resources:le($t({subscribe:le(ce()),listChanged:le(ce())})),tools:le($t({listChanged:le(ce())}))});or.extend({protocolVersion:c(),capabilities:lw,serverInfo:iw,instructions:le(c())});var cw=or.extend({nextCursor:le(c())}),dw=g({name:c(),description:le(c()),inputSchema:g({type:x("object"),properties:le(g({}).loose())}).loose()}).loose();cw.extend({tools:C(dw)});var pw=g({type:x("text"),text:c()}).loose(),fw=g({type:x("image"),data:ci(),mimeType:c()}).loose(),_l=g({uri:c(),mimeType:le(c())}).loose(),mw=_l.extend({text:c()}),hw=_l.extend({blob:ci()}),gw=g({type:x("resource"),resource:U([mw,hw])}).loose();or.extend({content:C(U([pw,fw,gw])),isError:ce().default(!1).optional()}).or(or.extend({toolResult:Ve()}));var qr="2.0",vw=g({jsonrpc:x(qr),id:U([c(),S().int()])}).merge(uw).strict(),yw=g({jsonrpc:x(qr),id:U([c(),S().int()]),result:or}).strict(),_w=g({jsonrpc:x(qr),id:U([c(),S().int()]),error:g({code:S().int(),message:c(),data:le(Ve())})}).strict(),bw=g({jsonrpc:x(qr)}).merge(g({method:c(),params:le(ra)})).strict();U([vw,bw,yw,_w]);const mn="openai-api-key";class ww{sdk;log;state={messages:[],hasApiKey:!1,status:"idle"};apiKey="";isStreaming=!1;constructor(){this.sdk=new xl,this.log=this.sdk.logs.createChannel("service")}async init(){this.log.info("Starting initialization...");const t=Date.now();this.sdk.init(),this.log.debug("SDK initialized"),this.log.debug("Loading API key from storage...");const r=Date.now();await this.loadApiKey(),this.log.debug(`API key load completed in ${Date.now()-r}ms`),this.sdk.plugin.onMessage(({fromModuleId:n,message:a})=>(this.log.debug(`Received message from ${n}: ${JSON.stringify(a)}`),this.handleCommand(a))),this.log.info(`Initialized and listening for commands (total: ${Date.now()-t}ms)`)}async loadApiKey(){try{this.log.debug("Calling sdk.storage.getSecret...");const t=Date.now(),r=await this.sdk.storage.getSecret(mn);this.log.debug(`sdk.storage.getSecret completed in ${Date.now()-t}ms`),r&&(this.apiKey=r,this.state.hasApiKey=!0,this.log.info("Loaded API key from secure storage"))}catch(t){this.log.error(`Failed to load API key: ${t}`)}}async handleCommand(t){const r=Sl(t);if(!r.success)throw this.log.error(`Invalid command: ${r.error}`),new Error(r.error);const n=r.data;switch(n.type){case"getState":return this.handleGetState();case"setApiKey":return this.handleSetApiKey(n.apiKey);case"sendChatMessage":return this.handleSendChatMessage(n.text);case"clearMessages":return this.handleClearMessages();case"clearApiKey":return this.handleClearApiKey()}}handleGetState(){return{...this.state}}async handleSetApiKey(t){try{return await this.sdk.storage.setSecret(mn,t),this.apiKey=t,this.state.hasApiKey=!0,this.broadcastState(),this.log.info("API key saved to secure storage"),{success:!0}}catch(r){throw this.log.error(`Failed to save API key: ${r}`),r}}handleSendChatMessage(t){if(!this.apiKey)throw new Error("API key not set");if(this.isStreaming)throw new Error("Already streaming");const r={id:Date.now().toString(),role:"user",parts:[{type:"text",text:t}]};return this.state.messages=[...this.state.messages,r],this.state.status="streaming",this.isStreaming=!0,this.broadcastState(),this.doStreaming(),{success:!0}}async doStreaming(){try{const t=Ci({apiKey:this.apiKey}),r=nw(this.state.messages),n=await this.sdk.llm.listTools();this.log.debug(`Fetched ${n.length} tools from registry`);const a={};for(const i of n)a[i.name]=cy({description:i.description,inputSchema:cr(i.parameters),execute:async l=>{this.log.debug(`Executing tool ${i.id} with args:`,JSON.stringify(l));const u=await this.sdk.llm.executeTool(i.id,l);return this.log.debug(`Tool ${i.id} returned:`,JSON.stringify(u)),u}});const o=Qb({model:t("gpt-4o"),system:"You are Signalscope Assistant, an AI helper. You have access to tools that can help you answer questions.",messages:r,tools:a,stopWhen:ll(20)});let s=null;for await(const i of rw({stream:o.toUIMessageStream()})){s||(s=Date.now().toString()+"-ai");const l={id:s,role:"assistant",parts:i.parts.map(d=>({type:"text",text:d.type==="text"?d.text:""}))},u=this.state.messages.findIndex(d=>d.id===s);u>=0?this.state.messages=[...this.state.messages.slice(0,u),l,...this.state.messages.slice(u+1)]:this.state.messages=[...this.state.messages,l],this.broadcastState()}this.state.status="idle",this.isStreaming=!1,this.broadcastState()}catch(t){this.log.error(`Streaming error: ${t}`);const r={id:(Date.now()+2).toString(),role:"assistant",parts:[{type:"text",text:"Sorry, I encountered an error. Please try again."}]};this.state.messages=[...this.state.messages,r],this.state.status="idle",this.isStreaming=!1,this.broadcastState()}}handleClearMessages(){return this.state.messages=[],this.broadcastState(),{success:!0}}async handleClearApiKey(){try{return await this.sdk.storage.deleteSecret(mn),this.apiKey="",this.state.hasApiKey=!1,this.broadcastState(),this.log.info("API key cleared from secure storage"),{success:!0}}catch(t){throw this.log.error(`Failed to clear API key: ${t}`),t}}broadcastState(){const t={type:"stateChanged",state:{...this.state}};this.sdk.plugin.sendBroadcast(t).catch(r=>{this.log.error(`Failed to broadcast state: ${r}`)})}}const Iw=new ww;Iw.init();
